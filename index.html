<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Very Beautiful - Interactive Experience | John Heineman & Francesco Mariano</title>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GCCSPG1H28"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-GCCSPG1H28');
    </script>
    <!-- End Google Analytics -->

    <!-- PDF.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

    <!-- PWA Configuration -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ff6b6b">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Very Beautiful">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="mobile-web-app-capable" content="yes">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #ff6b6b, #feca57);
            --secondary-gradient: linear-gradient(135deg, #48dbfb, #0fbcf9);
            --dark-bg: #1a1a2e;
            --darker-bg: #16213e;
            --card-bg: rgba(255, 255, 255, 0.05);
            --border-color: rgba(255, 255, 255, 0.1);
            --text-primary: #ffffff;
            --text-secondary: #b8b8b8;
            --accent-yellow: #feca57;
            --accent-red: #ff6b6b;
            --accent-blue: #48dbfb;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, var(--dark-bg) 0%, var(--darker-bg) 100%);
            color: var(--text-primary);
            overflow-x: hidden;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Navigation */
        nav {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem;
            z-index: 1000;
            border-bottom: 2px solid rgba(255, 107, 107, 0.3);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(90deg, #ff6b6b, #feca57, #48dbfb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            cursor: pointer;
            z-index: 1001;
            user-select: none;
        }

        /* Hamburger Menu Button */
        .menu-toggle {
            display: none;
            background: transparent;
            border: 2px solid var(--accent-red);
            color: #fff;
            padding: 0.6rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
            z-index: 1001;
        }

        .menu-toggle:hover {
            background: var(--primary-gradient);
            border-color: transparent;
            transform: scale(1.05);
        }

        .menu-toggle.active {
            background: var(--primary-gradient);
        }

        /* Navigation Links Container */
        .nav-links {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            transition: all 0.3s ease;
        }

        .nav-btn {
            background: transparent;
            color: #fff;
            border: 1px solid var(--border-color);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85rem;
            white-space: nowrap;
        }

        .nav-btn:hover, .nav-btn.active {
            background: var(--primary-gradient);
            border-color: transparent;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }

        /* Menu collassato (mobile) */
        @media (max-width: 1024px) {
            .menu-toggle {
                display: block;
            }
            
            .nav-links {
                position: fixed;
                top: 70px;
                right: -100%;
                width: 280px;
                max-height: calc(100vh - 70px);
                background: rgba(26, 26, 46, 0.98);
                backdrop-filter: blur(20px);
                flex-direction: column;
                padding: 1.5rem;
                border-left: 2px solid rgba(255, 107, 107, 0.3);
                box-shadow: -4px 0 20px rgba(0, 0, 0, 0.5);
                overflow-y: auto;
                transition: right 0.3s ease;
                z-index: 1002;
            }
            
            .nav-links.active {
                right: 0;
            }
            
            .nav-btn {
                width: 100%;
                text-align: left;
                padding: 0.8rem 1.2rem;
                font-size: 0.95rem;
            }
            
            /* Overlay quando menu aperto */
            .menu-overlay {
                display: none;
                position: fixed;
                top: 70px;
                left: 0;
                width: 100%;
                height: calc(100vh - 70px);
                background: rgba(0, 0, 0, 0.7);
                z-index: 999;
            }
            
            .menu-overlay.active {
                display: block;
            }
        }

        /* Desktop - menu sempre visibile */
        @media (min-width: 1025px) {
            .menu-toggle {
                display: none !important;
            }
            
            .nav-links {
                position: static;
                width: auto;
                flex-direction: row;
            }
        }

        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 6rem 1.5rem 3rem;
        }

        /* Section Styling */
        .section {
            display: none;
            animation: fadeIn 0.5s ease-out;
            min-height: 70vh;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(30px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        /* Card Styling */
        .card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 15px;
            padding: 2.5rem;
            margin: 2rem 0;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        .card h2 {
            color: var(--accent-yellow);
            margin-bottom: 1.5rem;
            font-size: 2rem;
            font-weight: 700;
        }

        .card h3 {
            color: var(--accent-blue);
            margin: 2rem 0 1rem;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .card h4 {
            color: var(--accent-red);
            margin: 1.5rem 0 0.8rem;
            font-size: 1.2rem;
        }

        .card p {
            color: var(--text-secondary);
            line-height: 1.8;
            margin-bottom: 1rem;
        }

        /* Hero Section */
        .hero {
            text-align: center;
            padding: 4rem 0;
            position: relative;
        }

        .hero h1 {
            font-size: clamp(2.5rem, 6vw, 4rem);
            margin-bottom: 1.5rem;
            background: linear-gradient(90deg, #ff6b6b, #feca57, #48dbfb, #ff6b6b);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradient 3s linear infinite;
            font-weight: 800;
            letter-spacing: -1px;
        }

        @keyframes gradient {
            to { background-position: 200% center; }
        }

        .hero-subtitle {
            font-size: clamp(1rem, 3vw, 1.3rem);
            color: var(--text-secondary);
            max-width: 700px;
            margin: 0 auto 2rem;
            line-height: 1.7;
        }

        .hero-meta {
            font-size: 0.95rem;
            color: #888;
            font-style: italic;
            margin-top: 1rem;
        }

        /* Video Container */
        .video-container {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            border-radius: 15px;
            margin: 2rem 0;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 0;
        }

        /* Audio Player */
        .audio-player-container {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border: 1px solid var(--border-color);
        }

        .audio-player-container h4 {
            color: var(--accent-blue);
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .audio-player {
            width: 100%;
            margin-top: 0.5rem;
            border-radius: 10px;
            outline: none;
        }

        .audio-player::-webkit-media-controls-panel {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.2), rgba(254, 202, 87, 0.2));
        }

        .audio-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        /* Gallery */
        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .gallery-item {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s;
            border: 2px solid var(--border-color);
            aspect-ratio: 16/9;
        }

        .gallery-item:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.3);
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .gallery-caption {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.9));
            padding: 2rem 1rem 1rem;
            color: white;
            font-size: 0.9rem;
            transform: translateY(100%);
            transition: transform 0.3s;
        }

        .gallery-item:hover .gallery-caption {
            transform: translateY(0);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            max-width: 90%;
            max-height: 90%;
            border-radius: 10px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
        }

        .modal-close {
            position: absolute;
            top: 2rem;
            right: 2rem;
            font-size: 3rem;
            color: white;
            cursor: pointer;
            z-index: 2001;
            background: rgba(255, 107, 107, 0.8);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }

        /* Info Grid */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .info-box {
            background: rgba(255, 107, 107, 0.1);
            padding: 1.5rem;
            border-radius: 12px;
            border-left: 4px solid var(--accent-red);
            transition: all 0.3s;
        }

        .info-box strong {
            color: var(--accent-yellow);
            display: block;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .info-box p {
            font-size: 0.95rem;
            margin: 0;
        }

        .clickable-box {
            cursor: pointer;
        }

        .clickable-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(255, 107, 107, 0.4);
            background: rgba(255, 107, 107, 0.15);
            border-left-width: 6px;
        }

        .clickable-box:active {
            transform: translateY(-2px);
        }

        /* Interactive System Boxes - Styled Differently */
        .interactive-system-box {
            cursor: pointer;
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.15), rgba(254, 202, 87, 0.15));
            border: 2px solid rgba(255, 107, 107, 0.3);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .interactive-system-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        .interactive-system-box:hover::before {
            left: 100%;
        }

        .interactive-system-box:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.5);
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.25), rgba(254, 202, 87, 0.25));
            border-color: rgba(255, 107, 107, 0.6);
            border-left-width: 8px;
        }

        .interactive-system-box strong {
            font-size: 1.2rem;
            color: var(--accent-yellow);
            text-shadow: 0 0 10px rgba(254, 202, 87, 0.5);
        }

        .interactive-system-box::after {
            content: '→';
            position: absolute;
            right: 1.5rem;
            bottom: 1rem;
            font-size: 2rem;
            color: var(--accent-red);
            opacity: 0;
            transition: all 0.3s;
        }

        .interactive-system-box:hover::after {
            opacity: 1;
            right: 1rem;
        }

        /* Timeline */
        .timeline {
            position: relative;
            padding: 2rem 0;
        }

        .timeline-item {
            display: flex;
            gap: 2rem;
            margin: 2rem 0;
            position: relative;
        }

        .timeline-year {
            flex-shrink: 0;
            width: 100px;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent-yellow);
        }

        .timeline-content {
            flex: 1;
            padding: 1.5rem;
            background: rgba(72, 219, 251, 0.1);
            border-radius: 10px;
            border-left: 3px solid var(--accent-blue);
        }

        /* Buttons */
        .btn {
            background: var(--primary-gradient);
            color: #fff;
            border: none;
            padding: 0.9rem 2rem;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
            display: inline-block;
            text-decoration: none;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(255, 107, 107, 0.5);
        }

        .btn-secondary {
            background: var(--secondary-gradient);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Recording Button */
        .btn-record {
            background: linear-gradient(135deg, #ff6b6b, #c0392b);
        }

        .btn-record.recording {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            animation: recordPulse 1.5s ease-in-out infinite;
        }

        @keyframes recordPulse {
            0%, 100% { box-shadow: 0 4px 15px rgba(231, 76, 60, 0.5); }
            50% { box-shadow: 0 4px 25px rgba(231, 76, 60, 0.8); }
        }

        /* Interactive Lab */
        .lab-container {
            background: rgba(0, 0, 0, 0.3);
            padding: 2rem;
            border-radius: 15px;
            margin: 2rem 0;
            border: 2px solid rgba(72, 219, 251, 0.2);
        }

        .text-input {
            width: 100%;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: #fff;
            font-size: 1rem;
            resize: vertical;
            min-height: 120px;
            font-family: inherit;
            margin-bottom: 1rem;
        }

        .text-input:focus {
            outline: none;
            border-color: var(--accent-yellow);
            box-shadow: 0 0 15px rgba(254, 202, 87, 0.3);
        }

        .output-box {
            background: rgba(0, 0, 0, 0.5);
            padding: 1.5rem;
            border-radius: 10px;
            min-height: 150px;
            border: 1px solid rgba(72, 219, 251, 0.3);
            line-height: 1.8;
            font-size: 1.1rem;
            margin-top: 1rem;
        }

        canvas {
            width: 100%;
            height: 200px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            border: 1px solid var(--border-color);
            margin: 1rem 0;
        }

        .controls {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
            margin: 1rem 0;
        }

        .status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem 1.2rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .status.active {
            background: rgba(72, 219, 251, 0.2);
            border: 1px solid rgba(72, 219, 251, 0.5);
            animation: pulse 2s infinite;
        }

        .status.recording {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid rgba(231, 76, 60, 0.5);
            animation: recordPulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .loading {
            display: inline-block;
            width: 18px;
            height: 18px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--accent-yellow);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Performance Mode */
        .live-text {
            font-size: clamp(1.8rem, 4vw, 3rem);
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 15px;
            padding: 2rem;
            margin: 2rem 0;
            border: 2px solid rgba(255, 107, 107, 0.3);
            font-style: italic;
            text-align: center;
        }

        .video-feed {
            width: 100%;
            max-width: 640px;
            height: auto;
            margin: 1.5rem auto;
            border-radius: 15px;
            border: 2px solid rgba(72, 219, 251, 0.3);
            display: block;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        /* Features Grid */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin: 3rem 0;
        }

        .feature-card {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.1), rgba(254, 202, 87, 0.1));
            padding: 2rem;
            border-radius: 15px;
            border: 1px solid var(--border-color);
            transition: transform 0.3s;
            cursor: pointer;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.2);
        }

        .feature-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .feature-card h3 {
            color: var(--accent-yellow);
            margin-bottom: 1rem;
        }

        /* Bio Section */
        .bio-container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 3rem;
            align-items: start;
            margin: 2rem 0;
        }

        .bio-image {
            width: 100%;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            border: 3px solid var(--border-color);
        }

        .bio-text h3 {
            color: var(--accent-yellow);
            margin-bottom: 1rem;
        }

        .bio-text ul {
            margin: 1rem 0;
            padding-left: 1.5rem;
        }

        .bio-text li {
            margin: 0.5rem 0;
            color: var(--text-secondary);
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 3rem 1rem;
            background: rgba(0, 0, 0, 0.3);
            margin-top: 4rem;
            border-top: 1px solid var(--border-color);
        }

        footer p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Spectrogram Migliorato */
        .spectrogram-wrapper {
            position: relative;
            background: #000;
            border-radius: 10px;
            padding: 50px 10px 40px 60px;
            margin: 1rem 0;
            border: 2px solid var(--border-color);
        }

        .spectrogram {
            width: 100%;
            height: 350px;
            position: relative;
            cursor: pointer;
        }

        #spectrogramCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .freq-labels {
            position: absolute;
            left: 0;
            top: 50px;
            width: 50px;
            height: 350px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            font-size: 0.75rem;
            color: #888;
        }

        .freq-label {
            text-align: right;
            padding-right: 8px;
        }

        .time-labels {
            position: absolute;
            bottom: 0;
            left: 60px;
            right: 10px;
            height: 30px;
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: #888;
            align-items: flex-start;
            padding-top: 8px;
        }

        .amplitude-legend {
            position: absolute;
            top: 10px;
            right: 20px;
            width: 200px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .amplitude-legend-title {
            font-size: 0.8rem;
            color: var(--accent-yellow);
            margin-bottom: 8px;
            font-weight: bold;
        }

        .amplitude-gradient {
            height: 20px;
            background: linear-gradient(to right, 
                rgb(26, 0, 51),
                rgb(51, 0, 102),
                rgb(204, 0, 102),
                rgb(255, 51, 0),
                rgb(255, 204, 0),
                rgb(255, 255, 153)
            );
            border-radius: 4px;
            margin-bottom: 5px;
        }

        .amplitude-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.7rem;
            color: #888;
        }

        .spectral-info {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }

        .spectral-info-box {
            text-align: center;
            padding: 0.8rem;
            background: rgba(72, 219, 251, 0.1);
            border-radius: 8px;
        }

        .spectral-info-label {
            font-size: 0.85rem;
            color: #888;
            margin-bottom: 0.5rem;
        }

        .spectral-info-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent-yellow);
        }

        .notation-box {
            background: rgba(0, 0, 0, 0.6);
            padding: 1.5rem;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 1.2rem;
            text-align: center;
            margin: 1rem 0;
            border: 2px solid rgba(254, 202, 87, 0.3);
        }

        /* Alert Box for Recording Status */
        .alert-box {
            background: rgba(72, 219, 251, 0.2);
            border: 2px solid rgba(72, 219, 251, 0.5);
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
            font-size: 0.9rem;
        }

        .alert-box.warning {
            background: rgba(255, 193, 7, 0.2);
            border-color: rgba(255, 193, 7, 0.5);
        }

        .alert-box.error {
            background: rgba(231, 76, 60, 0.2);
            border-color: rgba(231, 76, 60, 0.5);
        }

        /* NUOVO: Preset Sensitivity Controls */
        .sensitivity-presets {
            display: flex;
            gap: 0.8rem;
            margin: 1rem 0;
            flex-wrap: wrap;
            padding: 1rem;
            background: rgba(72, 219, 251, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(72, 219, 251, 0.2);
        }

        .preset-label {
            font-size: 0.9rem;
            color: var(--accent-blue);
            font-weight: 600;
            align-self: center;
            margin-right: 0.5rem;
        }

        .preset-btn {
            background: rgba(72, 219, 251, 0.1);
            color: #fff;
            border: 2px solid rgba(72, 219, 251, 0.3);
            padding: 0.6rem 1.2rem;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .preset-btn:hover {
            background: rgba(72, 219, 251, 0.2);
            border-color: rgba(72, 219, 251, 0.6);
            transform: translateY(-2px);
        }

        .preset-btn.active {
            background: var(--secondary-gradient);
            border-color: transparent;
            box-shadow: 0 4px 15px rgba(72, 219, 251, 0.4);
        }

        .preset-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .card {
                padding: 1.5rem;
            }

            .bio-container {
                grid-template-columns: 1fr;
                gap: 2rem;
            }

            .timeline-item {
                flex-direction: column;
                gap: 1rem;
            }

            .timeline-year {
                width: auto;
            }

            .gallery {
                grid-template-columns: 1fr;
            }

            .modal-close {
                top: 1rem;
                right: 1rem;
                width: 40px;
                height: 40px;
                font-size: 2rem;
            }

            .spectrogram-wrapper {
                padding: 40px 5px 35px 45px;
            }

            .spectrogram {
                height: 250px;
            }

            .freq-labels {
                width: 40px;
                top: 40px;
                height: 250px;
            }

            .amplitude-legend {
                width: 150px;
                top: 5px;
                right: 10px;
                padding: 8px;
            }

            .spectral-info {
                grid-template-columns: 1fr;
            }

            .sensitivity-presets {
                flex-direction: column;
            }

            .preset-btn {
                width: 100%;
            }
        }

        .event-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(254, 202, 87, 0.4);
            background: rgba(254, 202, 87, 0.15);
            border-left-width: 6px;
        }

        /* Touch-specific optimizations */
        @media (hover: none) {
            .btn:hover,
            .nav-btn:hover,
            .clickable-box:hover,
            .feature-card:hover,
            .gallery-item:hover {
                transform: none;
            }

            .btn:active,
            .nav-btn:active {
                transform: scale(0.95);
            }
        }

        /* Markov Order Selector Buttons */
        .markov-order-btn {
            padding: 0.8rem 1rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid #dee2e6;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            color: #495057;
            transition: all 0.3s ease;
            text-align: center;
            line-height: 1.4;
        }

        .markov-order-btn:hover {
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .markov-order-btn.active {
            background: linear-gradient(135deg, #48dbfb 0%, #0abde3 100%);
            border-color: #0abde3;
            color: white;
            box-shadow: 0 4px 16px rgba(72, 219, 251, 0.4);
        }

        .markov-order-btn.active:hover {
            background: linear-gradient(135deg, #0abde3 0%, #48dbfb 100%);
            transform: translateY(-2px);
        }

        .markov-order-btn small {
            display: block;
            margin-top: 0.2rem;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <div class="logo" id="logoBtn">VERY BEAUTIFUL</div>
            
            <!-- Hamburger Menu Button -->
            <button class="menu-toggle" id="menuToggle" aria-label="Toggle menu">
                <span id="menuIcon">☰</span>
            </button>
            
            <div class="nav-links" id="navLinks">
                <button class="nav-btn active" data-section="home">Home</button>
                <button class="nav-btn" data-section="opera">The Work</button>
                <button class="nav-btn" data-section="audio">Audio</button>
                <button class="nav-btn" data-section="media">Media</button>
                <button class="nav-btn" data-section="lab">Laboratory</button>
                <button class="nav-btn" data-section="docs">Documentation</button>
                <button class="nav-btn" data-section="tech">Technical</button>
                <button class="nav-btn" data-section="airpiece">🇮🇹 Air Piece</button>
                <button class="nav-btn" data-section="airpiece-en">🇬🇧 Air Piece</button>
            </div>
        </div>
        
        <!-- Overlay per chiudere menu -->
        <div class="menu-overlay" id="menuOverlay"></div>
    </nav>

    <!-- Main Container -->
    <div class="container">
        <!-- HOME SECTION -->
        <section id="home" class="section active">
            <div class="hero">
                <h1>Very Beautiful</h1>
                <p class="hero-subtitle">
                    An interactive audiovisual experience exploring the interplay between sound, text, memory, and movement through generative algorithms and real-time analysis.
                </p>
                <p class="hero-meta">
                    John Heineman • Francesco Mariano <br>
                    Max/MSP • Markov Chains • Computer Vision
                </p>
            </div>

            <!-- Featured Image -->
            <div class="card">
                <h2>An Interactive Expansion of John Heineman's Work 'Very Beautiful'</h2>
                <div style="text-align: center; margin: 2rem 0;">
                    <img src="images/text.jpg" 
                         alt="Text generation via Markov chains" 
                         style="width: 100%; max-width: 900px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5); border: 3px solid var(--border-color); cursor: pointer;"
                         class="modal-trigger" data-src="images/text.jpg">
                    <p style="margin-top: 1rem; color: var(--text-secondary); font-style: italic;">
                        "I remember?" - Algorithmic text generation through third-order Markov chains
                    </p>
                </div>
            </div>

            <!-- Key Features -->
            <div class="card">
                <h2>✨ Key Features</h2>
                <div class="features-grid">
                    <div class="feature-card" data-navigate="audio">
                        <div class="feature-icon">🎵</div>
                        <h3>Spectral Analysis</h3>
                        <p>Real-time audio signal decomposition using bark scale algorithms that modulate visual color and luminance.</p>
                    </div>
                    <div class="feature-card" data-navigate="lab-markov">
                        <div class="feature-icon">🎤</div>
                        <h3>Markov Chains</h3>
                        <p>Algorithmic text generation that fragments and recomposes the original corpus, amplifying memory and oblivion.</p>
                    </div>
                    <div class="feature-card" data-navigate="lab-motion">
                        <div class="feature-icon">🎥</div>
                        <h3>Computer Vision</h3>
                        <p>Analysis of performer movements via webcam, with visibility modulated by sound intensity.</p>
                    </div>
                    <div class="feature-card" data-navigate="opera">
                        <div class="feature-icon">🎼</div>
                        <h3>Dynamic Score</h3>
                        <p>Real-time generated performance instructions creating continuous dialogue between musician and system.</p>
                    </div>
                </div>
            </div>

            <!-- Quick Access -->
            <div class="card">
                <h2>🚀 Start Exploring</h2>
                <div class="info-grid">
                    <div class="info-box clickable-box" data-navigate="opera">
                        <strong>🎭 Discover the Work</strong>
                        <p>Explore the interactive system and its evolution from Air Piece (1970) to Very Beautiful (2024)</p>
                    </div>
                    <div class="info-box clickable-box" data-navigate="audio">
                        <strong>🎧 Listen</strong>
                        <p>Three complete audio tracks: Very Beautiful (Tape), Air Piece, and flute performance</p>
                    </div>
                    <div class="info-box clickable-box" data-navigate="lab">
                        <strong>🧪 Experiment</strong>
                        <p>Use interactive modules: Markov generator, audio analyzer, and performance mode</p>
                    </div>
                    <div class="info-box clickable-box" data-navigate="docs">
                        <strong>📚 Documentation</strong>
                        <p>Access essays, biographies, historical archives, and technical materials</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- OPERA SECTION -->
        <section id="opera" class="section">
            <div class="card">
                <h2>🎭 Very Beautiful</h2>
                <h3>Interactive Audiovisual Installation</h3>
                
                <p><strong>Author:</strong> Francesco Mariano</p>
                <p><strong>Reference Work:</strong> "Very Beautiful" (1973) by John Heineman (Gruppo di Improvvisazione Nuova Consonanza)</p>
                <p><strong>Technologies:</strong> Max/MSP Jitter, Spectral Analysis, Markov Chains (order 3), Computer Vision</p>

                <h3>The Project</h3>
                <p>
                    Very Beautiful is a digital reinterpretation of John Heineman's conceptual work that transforms the original composition into a synesthetic environment where the user becomes co-creator of a unique and unrepeatable audiovisual experience.
                </p>

                <h3>Tripartite Interaction System</h3>
                <p style="color: var(--accent-yellow); font-weight: bold; margin-bottom: 1rem;">🖱️ Click on each box to explore the interactive modules:</p>
                <div class="info-grid">
                    <div class="info-box interactive-system-box" data-navigate="audio">
                        <strong>1. Audio Analysis</strong>
                        <p>Real-time spectral analysis of the flute soloist track. Sound energy is translated into color and luminance modulations through pfft~ and zsa.abs_bark_mel~ 1024 4.</p>
                    </div>
                    <div class="info-box interactive-system-box" data-navigate="lab-markov">
                        <strong>2. Text Generation</strong>
                        <p>Markov Chain-based algorithm that decomposes and recomposes the original text, generating fragments that amplify fragmented memory and broken syntax.</p>
                    </div>
                    <div class="info-box interactive-system-box" data-navigate="lab-motion">
                        <strong>3. Performative Interaction</strong>
                        <p>Webcam capturing performer movements, modulated by audio intensity via jit.rgbtoluma, creating direct links between gesture, sound, and image.</p>
                    </div>
                </div>

                <h3>Dynamic and Generative Score</h3>
                <p>
                    The system also acts as a dynamic score for the soloist. Performative textual instructions such as "EXPLORE SILENCE", "MIDDLE REGISTER", "INTRODUCE WIDE VIBRATO" are generated and triggered by the analysis of the performance itself, transforming execution into continuous dialogue between musician and machine.
                </p>

                <h3>Open and Modular Work</h3>
                <p>
                    The software architecture is designed in a modular and versatile way, easily adaptable to new performative contexts. The interaction source can be reconfigured to analyze collective audience movements, transforming the work from performative experience to participatory installation.
                </p>

                <!-- Video Demo -->
                <h3>Video Documentation</h3>
                <div class="video-container">
                    <iframe src="https://www.youtube.com/embed/-KO_oYgZrn8" allowfullscreen></iframe>
                </div>
            </div>

        </section>

        <!-- AUDIO SECTION -->
        <section id="audio" class="section">
            <div class="card">
                <h2>🎵 Audio Gallery</h2>
                <p>Explore the three complete audio tracks of the project. Each recording represents a different aspect of the work and its historical evolution.</p>

                <div class="audio-grid">
                    <!-- Audio 1 -->
                    <div class="audio-player-container">
                        <h4>🎼 Very Beautiful - Tape Playback for Performance</h4>
                        <p style="color: #888; font-size: 0.9rem; margin-bottom: 1rem;">
                            Original audio track used for live performances. Includes recorded voices and the complete compositional structure of the work.
                        </p>
                        <audio class="audio-player" controls>
                            <source src="audio/Very_Beautiful_Tape_playbac_for_Performance.mp3" type="audio/mpeg">
                            Your browser does not support the audio element.
                        </audio>
                    </div>

                    <!-- Audio 2: Flute Performance -->
                    <div class="audio-player-container">
                        <h4>🎺 Very Beautiful - Flute Performance</h4>
                        <p style="color: #888; font-size: 0.9rem; margin-bottom: 1rem;">
                            Live recording with flute soloist improvisation. Demonstrates interaction between performer and generative system in real-time.
                        </p>
                        <audio class="audio-player" controls>
                            <source src="audio/VB_Flauto.mp3" type="audio/mpeg">
                            Your browser does not support the audio element.
                        </audio>
                    </div>
                </div>

                <h3>🎼 Interactive Timeline - Real-Time Spectrogram Analysis</h3>
                <p>Advanced visualization with frequency labels, time markers, and amplitude legend. Click anywhere on the spectrogram to navigate through the performance.</p>

                <!-- Audio nascosto per lo spettrogramma -->
                <audio id="timelineAudio" style="display: none;" crossorigin="anonymous">
                    <source src="audio/VB_Flauto.mp3" type="audio/mpeg">
                    Your browser does not support the audio element.
                </audio>

                <!-- Spettrogramma LIVE migliorato con etichette -->
                <div class="spectrogram-wrapper" id="spectrogramWrapper">
                    <!-- Etichette Frequenze (asse Y) -->
                    <div class="freq-labels" id="freqLabels">
                    
                        <div class="freq-label">10 kHz</div>
                        <div class="freq-label">5 kHz</div>
                        <div class="freq-label">2 kHz</div>
                        <div class="freq-label">1 kHz</div>
                        <div class="freq-label">500 Hz</div>
                        <div class="freq-label">50 Hz</div>
                    </div>

                    <!-- Canvas Spettrogramma -->
                    <div class="spectrogram" id="spectrogramContainer">
                        <canvas id="spectrogramCanvas"></canvas>
                        <!-- Tooltip interattivo -->
                        <div id="spectrogramTooltip" style="position: absolute; display: none; background: rgba(0,0,0,0.9); color: white; padding: 8px 12px; border-radius: 6px; font-size: 12px; font-family: monospace; pointer-events: none; z-index: 1000; border: 1px solid rgba(255,255,255,0.3); box-shadow: 0 4px 12px rgba(0,0,0,0.5);"></div>
                    </div>

                    <!-- Etichette Tempo (asse X) -->
                    <div class="time-labels" id="timeLabels">
                        <span>0:00</span>
                        <span>2:00</span>
                        <span>4:00</span>
                        <span>6:00</span>
                        <span>8:00</span>
                        <span>10:00</span>
                        <span>11:20</span>
                    </div>

                    <!-- Legenda Ampiezza -->
                    <div class="amplitude-legend">
                        <div class="amplitude-legend-title">Amplitude (dB)</div>
                        <div class="amplitude-gradient"></div>
                        <div class="amplitude-labels">
                            <span>-60</span>
                            <span>-40</span>
                            <span>-20</span>
                            <span>0</span>
                        </div>
                    </div>
                </div>

                <!-- Informazioni Spettrali Real-Time -->
                <div class="spectral-info">
                    <div class="spectral-info-box">
                        <div class="spectral-info-label">Peak Frequency</div>
                        <div class="spectral-info-value" id="peakFreq">-- Hz</div>
                    </div>
                    <div class="spectral-info-box">
                        <div class="spectral-info-label">Spectral Centroid</div>
                        <div class="spectral-info-value" id="centroidFreq">-- Hz</div>
                    </div>
                    <div class="spectral-info-box">
                        <div class="spectral-info-label">RMS Amplitude</div>
                        <div class="spectral-info-value" id="rmsAmplitude">-- dB</div>
                    </div>
                </div>

                <div class="controls">
                    <button class="btn" id="playTimelineBtn">▶ Play</button>
                    <button class="btn btn-secondary" id="resetTimelineBtn">↻ Reset</button>
                    <div class="status" id="timelineStatus">00:00 / 11:20</div>
                </div>

                <h3>Annotated Sound Events - Click to Jump</h3>
                <div class="info-grid">
                    <div class="info-box event-box" data-time="0" style="cursor: pointer; transition: all 0.3s;">
                        <strong>0:00-1:53</strong>
                        <div class="notation-box">◦◦ ≈</div>
                        <p>Key sounds, rustles. Light attacks in mid frequencies (2-4 kHz)</p>
                    </div>
                    <div class="info-box event-box" data-time="113" style="cursor: pointer; transition: all 0.3s;">
                        <strong>1:53-3:46</strong>
                        <div class="notation-box">◦ ↗</div>
                        <p>Flute entries, light attacks. Hints of melodies, rapid ascending scales</p>
                    </div>
                    <div class="info-box event-box" data-time="226" style="cursor: pointer; transition: all 0.3s;">
                        <strong>3:46-5:39</strong>
                        <div class="notation-box">↗ ↗ ▲</div>
                        <p>Glissandi, higher notes. Melodic alternation and scattered notes with contrasting dynamics</p>
                    </div>
                    <div class="info-box event-box" data-time="339" style="cursor: pointer; transition: all 0.3s;">
                        <strong>5:39-7:32</strong>
                        <div class="notation-box">▲ ▲ ⚡</div>
                        <p>Maximum intensity, extended techniques. Full spectrum up to 12-14 kHz, possible multiphonics</p>
                    </div>
                    <div class="info-box event-box" data-time="452" style="cursor: pointer; transition: all 0.3s;">
                        <strong>7:32-9:25</strong>
                        <div class="notation-box">≈ ≈ ≈ ↘</div>
                        <p>Varied dynamics, rustles. Glissandi, breaths, fast ascending scales and arpeggios</p>
                    </div>
                    <div class="info-box event-box" data-time="565" style="cursor: pointer; transition: all 0.3s;">
                        <strong>9:25-11:20</strong>
                        <div class="notation-box">≈ ◦</div>
                        <p>Progressive decrease. Residual sounds, light gestures, atmospheric closure</p>
                    </div>
                </div>

                <div style="margin-top: 2rem; padding: 1.5rem; background: rgba(72, 219, 251, 0.1); border-radius: 10px; border-left: 3px solid #48dbfb;">
                    <strong>📖 Symbolic Legend:</strong><br>
                    ◦ = Articulated sounds | ≈ = Rustles/breaths | ↗↘ = Glissandi | ▲ = High notes | ⚡ = Extended techniques | ~~~ = Breaths/noise
                </div>
            </div>
        </section>

        <!-- AIR PIECE ESSAY SECTION -->
        <section id="airpiece" class="section">
            <div class="card">
                <h1 style="text-align: center; font-size: 2rem; margin-bottom: 3rem; color: var(--accent-purple);">
                    Air Piece. Dall'ecoacustica del paesaggio sonoro alla Fantasia Sonora di Teatro Musicale
                </h1>
                <p style="text-align: center; font-size: 1.2rem; margin-bottom: 3rem;">di Francesco Mariano</p>

                <!-- Introduzione -->
                <div style="background: rgba(72, 219, 251, 0.1); padding: 2rem; border-radius: 10px; border-left: 4px solid #48dbfb; margin-bottom: 3rem;">
                    <p>
                        Air Piece rappresenta un'opera pionieristica di John Heineman che trasforma il paesaggio sonoro dell'aeroporto di Fiumicino di Roma in una visionaria composizione elettroacustica. L'opera anticipa metodologie che sarebbero diventate centrali nell'arte dei dati contemporanea.
                    </p>

                    <h3>Struttura Tripartita</h3>
                    <div class="info-grid">
                        <div class="info-box">
                            <strong>Sezione A (0'00"-3'12")</strong>
                            <p>Documentazione etnomusicologica: registrazione diretta del paesaggio sonoro con motori, turbine, annunci e conversazioni.</p>
                        </div>
                        <div class="info-box">
                            <strong>Sezione B (3'12"-8'30")</strong>
                            <p>Elaborazione algoritmica analogica: elaborazione elettroacustica attraverso loop, delay, filtraggio e creazione di "vortici psichedelici".</p>
                        </div>
                        <div class="info-box">
                            <strong>Sezione C (8'30"-13'08")</strong>
                            <p>Sintesi e meta-commento: predominanza del Synket con dispositivo brechtiano di intervento diretto del compositore.</p>
                        </div>
                    </div>

                    <h3>Innovazione Tecnologica</h3>
                    <p>
                        Utilizzo del <strong>Synket</strong> (sintetizzatore analogico sviluppato da Paul Ketoff a Cinecittà), una delle prime integrazioni sistematiche tra musica concreta e sintesi elettronica. Il dispositivo finale di straniamento anticipa pratiche di media art che sarebbero diventate canoniche nell'era digitale.
                    </p>

                    <h3>Pubblicazione Scientifica</h3>
                    <p>
                        <strong>Saggio musicologico:</strong> "Air Piece: Dall'ecoacustica del paesaggio sonoro alla Fantasia Sonora di Teatro Musicale"<br>
                        <strong>ISBN:</strong> 9780244560393 (2020)<br>
                        <strong>Riconoscimento:</strong> Fondazione Isabella Scelsi, Roma - Archivio John Heineman (Fondo 7)
                    </p>
                </div>

                <!-- Table of Contents -->
                <h2 id="indice">Indice</h2>
                <ul style="list-style: none; padding-left: 0; line-height: 2;">
                    <li><a href="#biografia" style="color: var(--accent-blue);">- Biografia di John Heineman</a> <span style="float: right;">pag. 3</span></li>
                    <li><a href="#panoramica" style="color: var(--accent-blue);">- Breve panoramica sulla nascita della soundscape composition</a> <span style="float: right;">pag. 4</span></li>
                    <li><a href="#fantasia" style="color: var(--accent-blue);">- Dalla soundscape composition alla fantasia sonora di teatro musicale</a></li>
                    <li><a href="#analisi" style="color: var(--accent-blue);">- Analisi di Air Piece di John Heineman</a> <span style="float: right;">pag. 7</span></li>
                </ul>

                <hr style="margin: 3rem 0; border: 1px solid var(--border-color);">

                <!-- Biografia -->
                <h2 id="biografia">Biografia di John Heineman</h2>
                <p>John Heineman (New York 1939) inizia lo studio del trombone presso il Mannes College of Music contemporaneamente allo studio della composizione, che continuerà a Roma perfezionandosi con Goffredo Petrassi. Si diploma alla Columbia University. Nel 1966 termina il corso presso l'Accademia Santa Cecilia, presentando la sua composizione orchestrale "Consequents" che viene eseguita dall'orchestra dell'Accademia di Santa Cecilia.</p>

                <p>E' stato anche allievo di Elias Tanenbaum, Peter Stearns e Boris Porena. "L'apprendistato con Tanenbaum ha travalicato però, per Heineman, i confini dello studio strumentale: allievo di Bohuslav Martinu, Tanenbaum era aggiornato sull'intero fronte dell'avanguardia storica europea (Bartók, Webern...) e sulle tendenze più recenti del jazz (Parker)," [Alessandro Mastropietro]</p>

                <p>Già durante i primi anni di studio presso il Mannes College of Music è affascinato dall'improvvisazione e spesso durante i weekend invitava amici musicisti, Alex Hershenson (tromba) ed Andy Pagano (clarinetto), al college per sessioni di improvvisazioni ricercando particolari atmosfere. Assiste personalmente a concerti di Charlie Parker, Clifford Brown durante la registrazione di "A Night at Birdland Vol. 1", John Coltrane con Thelonius Monk rimanendo fin dall'adolescenza affascinato dall'improvvisazione.</p>

                <p>È tra i fondatori del Gruppo di Improvvisazione Nuova Consonanza col quale svolse attività concertistica fra il 1965 e il 1970 esibendosi in varie città europee incluso un concerto per elettronica ed improvvisazione al 31° Festival di Venezia della musica Contemporanea nel settembre del 1968. Col Gruppo di Improvvisazione Nuova Consonanza registrò diversi LP (trombone e violoncello), ricordiamo Avant Garde vol. II, Gruppe Il Gruppo, The private Sea of Dreams.</p>

                <p>Ha collaborato con il teatro inter-disciplinario Gruppo Altro. È autore, fra gli altri,di due lavori concettuali, Air Piece (1970) e Very, Very Beautiful (1973), che sono considerati emblematici nel loro genere. Dopo aver vissuto a Berlino, in Canada ed a New York, dal 1982 Heineman risiede stabilmente in Italia. Dopo una pausa di alcuni anni dalla musica si è riavvicinato suonando in prima persona prima il flicorno e poi il sax contralto.</p>

                <p>Air Piece venne eseguito a Roma il 15 febbraio 1970, al Berliner Festwochen nel 1973 ed al Manhattan School of Music di New York nel 1974. Sempre nel 1974 viene presentata Very, Very Beautiful, un'opera di John Heineman del 1974 che utilizza simili processi compositivi. Venne eseguito a Roma fra il 29 ed il 31 marzo 1974 in collaborazione con TEAM Roma al Beat 72.</p>

                <p>Tra i vari riconoscimenti, ha ricevuto il Composers Award dalla Broadcast Music Inc. (1965) e un Rome Prize Fellowship presso l'American Academy (1967-69).</p>

                <hr style="margin: 3rem 0; border: 1px solid var(--border-color);">

                <!-- Panoramica -->
                <h2 id="panoramica">Breve panoramica sulla nascita del Paesaggio Sonoro</h2>

                <p>Raymond Murray Schafer definì il soundscape come l'ambiente sonoro che ci circonda e nel quale viviamo così come viene percepito dalle persone che ne sono immerse. Potremmo definire anche il paesaggio sonoro come la colonna sonora della nostra vita, comprendendo nel paesaggio sonoro tutti i suoni che accompagnano la nostra esistenza, da quelli che intercettiamo involontariamente nelle attività quotidiane a quelli ai quali prestiamo maggiore attenzione come un concerto in un teatro.</p>

                <p>Il suono può assumere differenti connotazioni: suono come fenomeno fisico oggettivo e suono come sensazione uditiva. Tra gli organi sensoriali individuiamo nell'udito una doppia natura, udire come fenomeno fisiologico e ascoltare come atto intellettivo psicologico. La capacità di ascoltare è un atto intenzionale e può essere sviluppata. L'ascolto viene mediato dai presupposti storico-socio-culturali dell'individuo nel contesto in cui vive.</p>

                <p>Il paesaggio sonoro è in veloce e continuo mutamento, i suoni si moltiplicano e spesso si standardizzano andando ad annullare caratteristiche tipiche di determinati paesaggi sonori. Possiamo parlare di un effetto di globalizzazione sonora. Aerei, automobili, impianti industriali contribuiscono a compromettere sia il benessere psicofisico dell'uomo che ad annientare le unicità dei luoghi. Presenza invadente di suoni per lo più a basse frequenze e di forte intensità rende sempre più omogeneo il paesaggio sonoro di diversi luoghi, andando ad annullare identità sonore territoriali.</p>

                <hr style="margin: 3rem 0; border: 1px solid var(--border-color);">

                <!-- Dalla soundscape alla fantasia -->
                <h2 id="fantasia">Dalla soundscape composition alla fantasia sonora di teatro musicale</h2>

                <p>Air Piece è una fantasia sonora di teatro musicale con una trama e un proprio sviluppo. Gli eventi sonori che si susseguono andranno a creare episodi di movimento alternati a fasi più tranquille, scene concitate e violente, vortici, momenti più statici, e repentini cambi di scena.</p>

                <p>Possiamo certamente collocare Air Piece nella soundscape composition essendo al tempo stesso una delle prime composizioni di questo genere ed una sua evoluzione anticipandone certi sviluppi. Come ben definito da Murray Shafer, la composizione del paesaggio sonoro esplora ed interpreta il suono degli ambienti.</p>

                <p>In Air Piece l'ambiente sonoro ripreso è fuori dubbio parte di un paesaggio sonoro già rapidamente mutato ed in continua evoluzione. Ci troviamo immersi in un'ambiente sonoro completamente trasfigurato, ci spostiamo all'interno di questo ambiente cogliendone le caratteristiche da differenti punti di ascolto.</p>

                <p>Esposizioni nitide e schiette, riprese sonore immacolate, vere e crude, che si trasformano in sognanti vortici con richiami psichedelici grazie alle tecniche compositive messe in opera dall'Autore. Air Piece induce anche l'ascoltatore a mettere in relazione il paesaggio sonoro presente, quello raccontato e sceneggiato, a quello che non è più, a quello da immaginarsi prima della trasfigurazione sonora che l'ambiente ha subito.</p>

                <p>Possiamo soltanto immaginare come dovessero suonare i luoghi descritti in Air Piece soltanto un decennio prima delle registrazioni (l'aeroporto di Fiumicino fu costruito fra il 1958 ed il 1960). Immaginare i suoni non è facile, e ci vorrebbero studi dedicati e approfonditi sulle capacità delle persone di immaginare suoni e saperli descrivere. Ancor più difficile è immaginare suoni che non si conoscono, anche presumendo (da fonti fotografiche, video o racconti scritti e orali) le sorgenti sonore presenti in un luogo, potremmo provare ad immaginare i suoni ma la mancanza di materiale sonoro certo resta una grossa carenza.</p>

                <p>Quest'analisi di Air Piece evidenzia sia gli aspetti fisici acustici che la capacità di John Heineman di aver creato da questi eventi sonori un'Opera che è sia un documento sonoro che stimola ricerche ecosonologiche che un brano musicale che si evolve dalla rigidità della pura documentazione verso la creazione di una fantasia sonora di teatro musicale.</p>

                <p>Come emergerà dettagliatamente dall'analisi che segue, sono presenti tre sezioni principali all'interno del brano che, richiamando un linguaggio teatrale possiamo riconoscere come scene.</p>

                <p><strong>La prima scena</strong> è in puro stile soundscape composition, con le riprese effettuate nell'arco di alcuni giorni all'interno e nei dintorni della pista dell'aeroporto di Fiumicino. Altre registrazioni vennero effettuate presso l'American Academy di Roma: la voce del bambino che pronuncia "de dah…", la voce di un pilota interpretata dall'artista visuale Jerry Kearns, la voce della prima moglie Lydia Heineman fino alla voce finale dello stesso Heineman. Queste registrazioni sono frutto delle riprese effettuate a partire dalla primavera del 1969 seguite da centinaia di ore di ascolto ed editing in studio.</p>

                <p><strong>Nella seconda scena</strong> il paesaggio sonoro viene elaborato attraverso filtraggi, loop e delay. In quegli anni l'influenza delle correnti sperimentali e psichedeliche era molto forte, questa seconda scena ci trasporta in un "psychedelic trip" con le voci dei piloti in vortici di loop, effetti e distorsioni. Ricordiamo che proprio nel 1970, Timothy Leary, scrittore, psicologo e artista statunitense, promotore dell'uso di sostanze psichedeliche, evade dal carcere per fuggire prima ad Algeri poi in Svizzera. La sua risonanza arrivava forte anche a Roma. Per approfondimenti su Timothy Leary si rimanda comunque ad altre fonti. Le registrazioni di questa sezione B provengono da una grande mole di nastri in archivi riservati ai quali Heineman aveva avuto accesso.</p>

                <p><strong>La terza scena</strong> è in prevalenza elettronica con un intermezzo di voci in loop e suoni di aerei. In questa ultima sezione è stato utilizzato un sintetizzatore analogico valvolare Synket ('Synthesiser-Ketoff') progettato da Paul Ketoff, ingegnere del suono per RCA e attivo a Roma presso Cinecittà Film Studios. Il Synket era di produzione artigianale e praticamente ogni modello commercializzato era un prototipo in quanto in continua evoluzione fra il 1965 ed il 1976.</p>

                <h3>L'interdisciplinarità di Air Piece</h3>

                <p>L'interdisciplinarità di Air Piece ci porta ad evidenziare anche i seguenti binomi che caratterizzano rapporti nel brano:</p>
                <ul>
                    <li>uomo - ambiente</li>
                    <li>uomo - velocità (tecnologia)</li>
                    <li>velocità (tecnologia) - ambiente</li>
                    <li>ambiente - musica</li>
                    <li>musica - tecnologia</li>
                </ul>

                <p>Una netta distinzione suoni concreti-suoni elettronici contrappone le prime scene, esclusivamente composte da riprese ambientali, alla terza quasi esclusivamente elettronica.</p>

                <p>Interessante anche seguire come lo sviluppo della voce umana attraverso le diverse scene faccia emergere il rapporto fra l'uomo e questi cambiamenti, evidenziando come sia l'uomo stesso vittima e causa di una trasformazione sonora. La voce umana è presente nelle diverse scene assumendo aspetti e significati differenti.</p>

                <p>Nella prima scena l'uomo è immerso nella densa grana sonora uniforme, contribuisce a crearla quasi inconsapevolmente, ne è vittima. Nella seconda troviamo una evoluzione verso velocità supersoniche con l'uomo consapevolmente protagonista. Nella terza scena, come i titoli di coda del cinema, troviamo la voce rassicurante dell'Autore che chiude la fantasia di teatro sonoro mentre cala il sipario.</p>

                <hr style="margin: 3rem 0; border: 1px solid var(--border-color);">

                <!-- ANALISI DETTAGLIATA -->
                <h2 id="analisi">Analisi di Air Piece</h2>

                <p>Air Piece è un brano composto da John Heineman nel 1970 effettuando riprese sonore nell'aeroporto di Fiumicino e nei suoi dintorni ed ha una durata di 13'08". Presso lo Studio di Musica Elettronica "G. Rossini" di Pesaro ne è stata fatta una versione Stereofonica dalle originarie registrazioni su quattro tracce, completando le riprese effettuate a Fiumicino con registrazioni di archivio (voci di piloti, torre di controllo e Frecce Tricolori) e l'utilizzo di elettronica.</p>

                <p>Per effettuare l'analisi del brano sono state individuate tre macrosezioni che chiameremo A, B, C. In ogni sezione saranno evidenziate delle sottosezioni (a1,a2,a3,…b1,…). Queste ripartizioni sono state determinate per coerenza di eventi timbrici, evidenziando nel tempo la presenza delle varie differenti sorgenti sonore, individuando gli assemblaggi eseguiti in fase di montatura-composizione, nonché suddivisioni di carattere più soggettivo e suggestivo, riferendo sempre dei chiari parametri evidenziati dalle immagini dello spettrogramma.</p>

                <div class="info-grid" style="margin: 2rem 0;">
                    <div class="info-box">
                        <strong>Sez. A 0'0" - 3'12"</strong>
                        <p>Esposizione dell'ambiente sonoro. Aeroporto di Fiumicino.</p>
                    </div>
                    <div class="info-box">
                        <strong>Sez. B 3'12" - 8'30"</strong>
                        <p>Aerei. Decolli, atterraggi. Piloti, Frecce Tricolori, bang sonico.</p>
                    </div>
                    <div class="info-box">
                        <strong>Sez. C 8'30" - 13'08"</strong>
                        <p>Elettronica, voce dell'autore.</p>
                    </div>
                </div>

                <hr style="margin: 3rem 0; border: 1px solid var(--border-color);">

                <!-- SEZIONE A -->
                <h3 style="color: var(--accent-purple); font-size: 1.5rem;">SEZIONE A - Esposizione dell'ambiente sonoro</h3>

                <p><em>Toniche: motori, turbine, folla all'interno di un aeroporto</em><br>
                <em>Segnali: voce di speaker, pilota</em></p>

                <div style="text-align: center; margin: 2rem 0;">
                    <img src="images/spectrograms/spectrogram_page8_0.png" alt="Spettrogramma - Panoramica Sezione A" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                    <p style="font-style: italic; color: var(--text-secondary); margin-top: 0.5rem;">Vista panoramica della Sezione A - Paesaggio sonoro dell'aeroporto di Fiumicino</p>
                </div>

                <div style="text-align: center; margin: 2rem 0;">
                    <img src="images/spectrograms/spectrogram_page8_1.png" alt="Spettrogramma - Dettaglio Sezione A" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                    <p style="font-style: italic; color: var(--text-secondary); margin-top: 0.5rem;">Dettaglio spettrale - Toniche di motori e turbine con segnali di voci</p>
                </div>

                <h4>a1) Terminal Fiumicino - Time 0.00</h4>
                <p>Il brano inizia con un forte motore di automobile, molto ravvicinato e presente. E' in fase di rapido decadimento e lascia subito spazio all'ambiente circostante. La voce di uno speaker diffusa da altoparlanti diviene più nitida, si evince la pronuncia francese anche se non si riesce ad intenderne il significato. Ci troviamo quindi nell'area dell' aeroporto di Fiumicino il cui paesaggio sonoro, insieme all'ambiente circostante, verrà descritto nella prima parte del brano.</p>

                <div style="text-align: center; margin: 2rem 0;">
                    <img src="images/spectrograms/spectrogram_page9_0.png" alt="Spettrogramma - Motore iniziale molto intenso" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                    <p style="font-style: italic; color: var(--text-secondary); margin-top: 0.5rem;">Il motore iniziale molto intenso - Frequenze fra 43 e 250 Hz con valori fino a -12dB</p>
                </div>

                <p style="background: #f5f5f5; padding: 1rem; border-left: 4px solid var(--accent-blue); margin: 1rem 0;">
                <strong>Nota tecnica:</strong> Il motore iniziale molto intenso mostra frequenze fra 43 e 250 Hz con valori fino a -12dB che decadono rapidamente.
                </p>

                <p><strong>Time 5,845:</strong> Il motore dell'automobile decresce rapidamente e nel medesimo evento sonoro percepiamo delle turbine in lontananza con suoni acuti che procedono in un glissando ascendente fino a 3600Hz con intensità deboli ma comunque ben percettibili (-31 dB).</p>

                <h4>a2) Annunci - Time 12.00</h4>
                <p>Termina il glissando delle turbine e si apre uno spettro più ricco in estensione di frequenza. Ci troviamo all'interno dell'aeroporto e la voce di uno speaker risente chiaramente degli effetti del riverbero tipici di grandi spazi chiusi. A 17,250 riconosciamo una voce, con un accenno ritmico-melodico, ripetuta con un delay di 500 ms (inizia a 17,250 sul canale sx per ripetersi a 17,7500 sul canale dx).</p>

                <p><strong>Time 23.700 - 33.100:</strong> Tre squilli di telefono si susseguono producendo una serie di parziali superiori ben distinguibili dallo spettrogramma. I primi due sul canale sinistro, il terzo, mascherato, anche sul destro. Il rumore di fondo maschera le parziali sotto i 3700 Hz.</p>

                <div style="text-align: center; margin: 2rem 0;">
                    <img src="images/spectrograms/spectrogram_page10_0.png" alt="Spettrogramma - Squilli di telefono" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                    <p style="font-style: italic; color: var(--text-secondary); margin-top: 0.5rem;">Squilli di telefono sul canale sinistro - Il rumore di fondo maschera le parziali sotto i 3700 Hz</p>
                </div>

                <h4>a3) Annunci partenze - Time 33,100 - 1'36" (Solo dal canale destro)</h4>

                <p><em>Voce dello speaker:</em><br>
                "Karachi, Calcutta, Bangkok, Hong Kong e Tokio. Verrà chiamato tre 5 minuti all'uscita numero cinque".<br><br>
                Dal sottofondo una turbina di un motore intorno ai 3000Hz, definiamo queste turbine come delle toniche che ritroveremo sovente nel corso del brano.</p>

                <p>Intanto continua la voce dello speaker:<br>
                46" May i have your attention please",<br>
                49" Jal, Japan Airline inform that flight number 452<br>
                53" to Cairo, Karachi...</p>

                <p>...sentiamo, in primo piano e ravvicinata, la voce di un bambino, quasi a intonare un frammento di melodia. <strong>"Dee dah, dee dah, de dah…de dah…de d…"</strong>. E' completamente inaspettata dagli eventi che si sono fino ad ora susseguiti, e crea un forte distacco dal paesaggio sonoro che si va delineando. E' in primo piano e il suo distacco ci porta lontanissimo.</p>

                <div style="text-align: center; margin: 2rem 0;">
                    <img src="images/spectrograms/spectrogram_page11_0.png" alt="Spettrogramma - Voce del bambino" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                    <p style="font-style: italic; color: var(--text-secondary); margin-top: 0.5rem;">Segnali - La voce del bambino (time 56.700) con le armoniche superiori in chiara evidenza</p>
                </div>

                <p style="background: #f5f5f5; padding: 1rem; border-left: 4px solid var(--accent-blue); margin: 1rem 0;">
                <strong>Segnali:</strong> La voce del bambino (time 56.700) con le armoniche superiori in chiara evidenza.
                </p>

                <p>Nuovi segnali si susseguono: gli annunci continuano con la voce di un altro speaker fino a lasciar spazio a turbine e motori che da toniche diventano soliste in un crescendo che si sviluppa fra 1'06" e 1'36".</p>

                <h4>a4) Turbine e motori a reazione - Time 1'36" - 2'09"</h4>
                <p>Rapido crescendo di turbine e motori a banda larga chiude la sezione A con le toniche sul fondo sempre presenti. L'accensione di un motore avvia un nuovo glissando di turbine che salgono rapidamente di frequenza e intensità terminando improvvisamente con un taglio netto. Il glissando ascendente di turbine e motori, prima di tipo esponenziale poi di tipo logaritmico, con un incremento di intensità che arriva ai -7 dB.</p>

                <div style="text-align: center; margin: 2rem 0;">
                    <img src="images/spectrograms/spectrogram_page12_0.png" alt="Spettrogramma - Glissando turbine e motori" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                    <p style="font-style: italic; color: var(--text-secondary); margin-top: 0.5rem;">Il glissando ascendente di turbine e motori con incremento di intensità fino a -7 dB</p>
                </div>

                <h4>a5) Aerei in volo. Tranquillo. - Time 2'09" - 2'30"</h4>
                <p>Una caduta nel vuoto arriva al termine del lungo crescendo precedente. Restano improvvisamente soltanto i motori, che adesso, con andamento costante, ci sembrano tranquilli e silenziosi. Un breve momento di tranquillità con le sole toniche fino alla comparsa di nuovi segnali. La fase più tranquilla con la tonica dei motori sempre presenti. Un suono molto cupo e stabile con un centro banda intorno ai 170 Hz e un'intensità di -19 dB.</p>

                <div style="text-align: center; margin: 2rem 0;">
                    <img src="images/spectrograms/spectrogram_page12_1.png" alt="Spettrogramma - Fase tranquilla" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                    <p style="font-style: italic; color: var(--text-secondary); margin-top: 0.5rem;">La fase più tranquilla - Suono cupo e stabile con centro banda a 170 Hz e intensità di -19 dB</p>
                </div>

                <h4>a6) Jerry Kearns voce del pilota - Time 2.30 - 3'12"</h4>

                <p>2'32" Messaggio di benvenuto del pilota: <em>"good evening ladies and gentlemen this is your pilot speaking, i trust that your departure from L.A. was a comfortable one"</em>. Nel sottofondo la tonica, motore di aereo in volo, con andamento costante.</p>

                <p>2'38" Comunicazioni radio del pilota: <em>"Ah, we're looking forward to a very pleasant flight tonight, as we check the weather, we see no foreseeable problems as far as turbulence goes"</em></p>

                <p>2'48" <em>"Our flight to Albuquerque should take approximately an hour and a half, to an hour and thirty-five minutes"</em></p>

                <p>2'55" <em>"Ah, we hope you can settle in and relax and enjoy the trip. Please undo your seat belts."</em></p>

                <p>3'01" <em>"I will cut back in later if any interesting sites - ah pass by - ah below us as we continue our journey".</em></p>

                <p style="background: #f5f5f5; padding: 1rem; border-left: 4px solid var(--accent-purple); margin: 1rem 0;">
                Jerry Kearns, artista visuale ed amico di John Heineman registrò questi dialoghi presso l'American Academy. "Kearns spontaneously was able to imitate a typical American mid-western accent (perfect for the piot's intervention on board a plane that I was looking for)" email di Heineman. "That recording helped to shape the direction of the piece, triggering the idea of psychedelic effects - of variable speed, break-up of his speech (use of filters etc.) suggesting various contrapuntal voice-over techniques (the settle-in and relax and enjoy the trip - triggering psychedelic effects idea - the comic-like effect of his voice slowed down to mimic an inebriated pilot)."
                </p>

                <hr style="margin: 3rem 0; border: 1px solid var(--border-color);">

                <!-- SEZIONE B -->
                <h3 style="color: var(--accent-purple); font-size: 1.5rem;">SEZIONE B - In volo. Piloti, torre di controllo, acrobazie, bang sonico</h3>

                <p><em>Toniche: motori, turbine, automobili</em><br>
                <em>Segnali: voci piloti in volo, voci da torre di controllo, voci in loop, bang sonico</em></p>

                <p>Questa sezione è un viaggio onirico dell'uomo in un caleidoscopio di velocità. Le voci dei piloti in volo che si rincorrono in vorticosi canoni lasceranno a poco a poco spazio alle turbine ed ai motori a reazione alternando eventi sonori di quiete ad eventi molto concitati e violenti come i bang della rottura della barriera del suono. Siamo in balia degli eventi che si susseguono, fasi di riposo si alternano a sogni psichedelici che trasportano l'ascoltatore oltre il solito.</p>

                <h4>b1) Time 3'12" - 3'18"</h4>
                <p>Nuovo breve momento di tranquillità con le sole toniche di motori in volo.</p>

                <h4>b2) Segnali. Imitazione a 4 voci - Time 3'18" - 3'39</h4>
                <p>Voci di piloti in loop creano dei vortici in crescendo. Sopra al costante sottofondo dei motori degli aerei, le voci si muovono velocemente creando un movimento vorticoso, un richiamo psichedelico in contrasto con la stabilità dei motori degli aerei in volo.</p>

                <div style="text-align: center; margin: 2rem 0;">
                    <img src="images/spectrograms/spectrogram_page15_0.png" alt="Spettrogramma - Voci in loop" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                    <p style="font-style: italic; color: var(--text-secondary); margin-top: 0.5rem;">Voci di piloti in loop con motori in volo - Vortici vorticosi psichedelici</p>
                </div>

                <div style="text-align: center; margin: 2rem 0;">
                    <img src="images/spectrograms/spectrogram_page15_1.png" alt="Spettrogramma - Dettaglio voci" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                    <p style="font-style: italic; color: var(--text-secondary); margin-top: 0.5rem;">Eventi alternati di toniche e voci - Segnali a banda stretta in glissandi discendenti</p>
                </div>

                <h4>b3-b6) Time 3'39" - 4'23"</h4>
                <p>Si alternano eventi di sole toniche (motori in volo) e riprese delle voci di piloti in loop. L'ultimo episodio di questa alternanza culmina con: <em>"……Settle in and relax and enjoy the trip"</em>. Si notano dallo spettrogramma dei chiari segnali a banda stretta che si muovono in glissandi discendenti (da 4800Hz a 4350Hz).</p>

                <h4>b7) Time 4'23" - 4'33"</h4>
                <p>Toniche di motori in volo molto intense alle basse frequenze.</p>

                <h4>b8) Alfabeto militare - Time 4'33 - 5'24"</h4>

                <p><em>"Roger fox baker baker dog Quinn, you are clear to descend to two thousand feet…and check your finny fox fox one zero one seven point two".</em></p>

                <p>Si susseguono comunicazioni fra piloti e torre di controllo in alfabeto militare. <em>"Give us a call when 3 miles out, over.ah c"</em><br>
                Seconda voce: <em>"…Roger, Fox, Baker, Baker Dog Quinn…"</em></p>

                <p>Si distinguono i segnali della voce dei piloti, che si ripetono in loop e si sovrappongono in canone, con il caratteristico fruscio di fondo a banda larga delle comunicazioni radio.</p>

                <p>5'10" <em>"Check your Finny FOX FOX 1017.2"</em><br>
                <em>"Give us a call when 3 miles out, over".</em></p>

                <p>Al 5'12" una tonica molto intensa mentre continuano le comunicazioni fra piloti e torre di controllo.</p>

                <h4>b9) turbine, motori a reazione - Time 5'24" - 5'46"</h4>
                <p>Forti segnali a banda stretta, in molteplici glissandi discendenti. Segnali di turbine con le toniche dei motori molto intense (-7 dB)</p>

                <div style="text-align: center; margin: 2rem 0;">
                    <img src="images/spectrograms/spectrogram_page18_0.png" alt="Spettrogramma - Turbine e motori a reazione" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                    <p style="font-style: italic; color: var(--text-secondary); margin-top: 0.5rem;">Turbine e motori a reazione - Glissandi discendenti con intensità di -7 dB</p>
                </div>

                <h4>b10) Esibizione delle frecce tricolori dell'Aeronautica Militare - Time 5'46" 6'04"</h4>

                <p>Uno speaker comunica da altoparlanti in luogo aperto: <em>"E' già sul campo la pattuglia italiana"… "…sta per eseguire una virata di tipo Schneider…si portano nuovamente sul campo per eseguire una virata tipo Schneider".</em></p>

                <p style="background: #f5f5f5; padding: 1rem; border-left: 4px solid var(--accent-yellow); margin: 1rem 0;">
                La virata di tipo Schneider è una particolare manovra effettuata da un passaggio del così detto "solista", imprime all'aeroplano un movimento ondulatorio. La manovra viene generalmente effettuata in configurazione di atterraggio ed a velocità prossime a quelle dello stallo. Nella formazione ogni velivolo ha un ruolo ben preciso, che ogni pilota osserverà per la sicurezza e la riuscita dell'evoluzione. (Da notare le analogie fra la terminologia in uso nelle acrobazie aeree e quella musicale. La formazione, il solista, looping, bang sonico, formazione a cardioide).
                </p>

                <p>I rapidissimi passaggi degli aerei creano degli spettri a banda larga che crescono e decrescono rapidamente. Dallo spettrogramma possiamo chiaramente identificare tre passaggi fra 5'55" e 6'04.</p>

                <div style="text-align: center; margin: 2rem 0;">
                    <img src="images/spectrograms/spectrogram_page19_0.png" alt="Spettrogramma - Frecce Tricolori" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                    <p style="font-style: italic; color: var(--text-secondary); margin-top: 0.5rem;">Manovre aeree delle Frecce Tricolori - Spettri a banda larga con tre passaggi identificabili</p>
                </div>

                <div style="text-align: center; margin: 2rem 0;">
                    <img src="images/spectrograms/spectrogram_page19_1.png" alt="Spettrogramma - Virata Schneider" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                    <p style="font-style: italic; color: var(--text-secondary); margin-top: 0.5rem;">Virata di tipo Schneider - Crescendo e decrescendo rapidi dei passaggi aerei</p>
                </div>

                <h4>b11) Bang sonico - Time 6'04" - 6'11"</h4>
                <p><em>"Attenzione, fra poco udremo il bang che si verifica quando avviene il superamento della barriera sonica"</em>. Invece che il bang sonico sentiamo però un boato non troppo intenso e di breve durata.</p>

                <h4>b12) Piloti torre di controllo - Time 6'12" - 6'35"</h4>

                <p>Motori in volo, dialoghi fra torre di controllo e piloti che si sovrappongono:</p>
                <p><em>"..i'll be over in about, ah, 3 minutes, 4 minutes, over"<br>
                "…Able Dog Charlie, Roger, we are standing by waiting your call when reaching Cittavecchia, over"<br>
                "ah, my position is ? ah' ventuno decon, over"<br>
                "Roma approach 119.1, over"<br>
                "Request your altitude, also, over"<br>
                "Altitude 4,500 feet"<br>
                "ah, Fox, Baker, baker, dog"</em></p>

                <h4>b13) Time 6'35" - 7'02"</h4>

                <p><em>"Hanno compiuto il primo looping"</em> - voce di un cronista che commenta le manovre aeree delle frecce tricolori e annuncio di un nuovo bang sonico molto forte in una banda fra 40Hz e 180Hz con intensità fino a -6 dB.</p>

                <p><em>"…jet 84F effetteranno la superamento della barriera del suono"<br>
                "… e fra poco udremo il bang…secondo bang".</em></p>

                <p>Questa fase violenta si chiude col suono di turbine che ci passano vicino velocemente creando brevi glissando discendenti di forte intensità.</p>

                <h4>b14) Time 7'02" - 7'46"</h4>
                <p>Si apre una scena coi soli motori protagonisti. Si tratta di motori di diverso tipo, e rotori di elicotteri. Come si nota chiaramente dallo spettrogramma, il suono dell'elica è descritto da fitte linee verticali a banda larga. Alle basse frequenze sempre le toniche dei motori molto intense.</p>

                <h4>b15) Time 7'46" - 8'29"</h4>

                <p>Si alternano momenti di distensione a episodi con motori di diversi tipo, ma non più aerei supersonici. A 8'03" una voce di donna che ride sul solo canale sinistro e si sviluppa in una risata frammentata, isterica e compulsiva che, mixata ai motori, si evolve in un frammento melodico chiudendo la lunga sezione B.</p>

                <p>La voce sul canale sinistro che chiude la sezione B con un frammento ritmico melodico ripetuto: <strong>"Keep singin' keep singin'"</strong>. Si tratta della voce di Candy Wechsler che ci porta in una fase transitoria proiettandoci, dall'oscura e minacciosa scena che si sta concludendo, alla lucente scena finale.</p>

                <hr style="margin: 3rem 0; border: 1px solid var(--border-color);">

                <!-- SEZIONE C -->
                <h3 style="color: var(--accent-purple); font-size: 1.5rem;">SEZIONE C - Elettronica e voce dell'autore</h3>

                <p>Nella terza scena suoni elettronici lineari, definiti e costanti si contrappongono allo scenario visto nelle prime due scene. Qui sono brevi loop di voci residui della scena precedente in una sorta di breve ostinato. Dopo il lungo viaggio è un ritorno alla realtà. Ritorno che prende forma inizialmente con suoni quasi puri per poi evolversi in spettri più complessi, accompagnato dalla voce dell'autore che ringrazia e accompagna la chiusura del sipario. Un atterraggio su territori più convenzionali. La dimensione che si crea nell'ultima scena ci riaccompagna alla realtà.</p>

                <h4>c1) Synket - Time 8'30" - 10'44"</h4>

                <p>I suoni del Synket aprono lo scenario unendosi al loop della voce che ripete <em>"Keep singin' keep singin'"</em>. Al time 8'53" termina il loop della voce ed anche sul canale destro iniziano i suoni del Sintetizzatore. Una trama sempre più densa di suoni crea linee melodiche e battimenti, intermittenze, accordi e grumi che si evolvono e si intersecano.</p>

                <div style="text-align: center; margin: 2rem 0;">
                    <img src="images/spectrograms/spectrogram_page21_0.png" alt="Spettrogramma - Synket" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                    <p style="font-style: italic; color: var(--text-secondary); margin-top: 0.5rem;">Ingresso del Synket - Suoni elettronici lineari e costanti</p>
                </div>

                <div style="text-align: center; margin: 2rem 0;">
                    <img src="images/spectrograms/spectrogram_page21_1.png" alt="Spettrogramma - Loop voci" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                    <p style="font-style: italic; color: var(--text-secondary); margin-top: 0.5rem;">Loop della voce "Keep singin'" con sintesi elettronica - Trama densa di suoni</p>
                </div>

                <div style="text-align: center; margin: 2rem 0;">
                    <img src="images/spectrograms/spectrogram_page22_0.png" alt="Spettrogramma - Sintesi complessa" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                    <p style="font-style: italic; color: var(--text-secondary); margin-top: 0.5rem;">Linee melodiche e battimenti - Accordi e grumi sonori del sintetizzatore</p>
                </div>

                <h4>c2) You can hear it now - Time 10'44" - 11'13"</h4>
                <p>Una voce di donna ripete in loop <em>"you can hear it now"</em> e quella di un uomo si sovrappone rispondendo <em>"hear what?"</em>.</p>

                <h4>c3) Time 11'13" - 11'35"</h4>
                <p>La voce di donna pronuncia <em>"the Jet"</em> e si apre un sottofondo già visto in precedenza, quello dei motori a reazione. Un dejavu che ci riporta ad un già vissuto, una nuova breve ricaduta onirica.</p>

                <h4>c4) Time 11.35" - 12'23"</h4>
                <p>Una melodia che arriva da lontano scorre anticipando la calata del sipario. Un delay ed un reverbero muovono questa melodia semplice e malinconica in re minore che cresce, si sposta, si rincorre con gli ultimi ricordi dei motori degli aerei. Gli aerei leggeri sembrano girare in armonia con la melodia sullo sfondo, un richiamo al cinema di Fellini.</p>

                <h4>c5) Titoli di coda - Time 12'23" - 13'08"</h4>

                <p>Come i titoli di coda di un'opera visuale entra la voce dell'Autore. E' il commiato dopo questo bel lungo viaggio in cui momenti di lucidità militare si sono alternati a scene oniriche.</p>

                <div style="text-align: center; margin: 2rem 0;">
                    <img src="images/spectrograms/spectrogram_page24_0.png" alt="Spettrogramma - Voce dell'autore" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                    <p style="font-style: italic; color: var(--text-secondary); margin-top: 0.5rem;">Titoli di coda - La voce di John Heineman che ringrazia il pubblico</p>
                </div>

                <blockquote style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem; border-radius: 10px; font-style: italic; margin: 2rem 0;">
                "Good evening ladies and gentlemen, ah, this is your composer speaking, ah, we hope you've enjoyed the composition, ah, as much as the technician and I have enjoyed doing it. I'd like to thank you very much for your participation here tonight ah, would just like to wish you a very good evening and a very pleasant journey ahead, Thank you".
                </blockquote>

                <p style="text-align: center; font-size: 1.2rem; margin-top: 3rem; color: var(--accent-purple);">
                <strong>Un brano che apre a nuovi stili compositivi, mantenendo all'interno chiare matrici di stampo musicale tradizionale che ne fanno una Fantasia sonora di teatro musicale.</strong>
                </p>

            </div>
        </section>

        <!-- AIR PIECE ESSAY SECTION - ENGLISH -->
        <section id="airpiece-en" class="section">
            <div class="card">
                <h1 style="text-align: center; font-size: 2rem; margin-bottom: 3rem; color: var(--accent-purple);">
                    Air Piece. From Soundscape Ecoacoustics to Musical Theater Sound Fantasy
                </h1>
                <p style="text-align: center; font-size: 1.2rem; margin-bottom: 3rem;">by Francesco Mariano</p>

                <!-- Introduction -->
                <div style="background: rgba(72, 219, 251, 0.1); padding: 2rem; border-radius: 10px; border-left: 4px solid #48dbfb; margin-bottom: 3rem;">
                    <p>
                        Air Piece represents a pioneering work by John Heineman that transforms the soundscape of Rome's Fiumicino airport into a visionary electroacoustic composition. The work anticipates methodologies that would become central to contemporary data art.
                    </p>

                    <h3>Tripartite Structure</h3>
                    <div class="info-grid">
                        <div class="info-box">
                            <strong>Section A (0'00"-3'12")</strong>
                            <p>Ethnomusicological documentation: direct recording of the soundscape with engines, turbines, announcements, and conversations.</p>
                        </div>
                        <div class="info-box">
                            <strong>Section B (3'12"-8'30")</strong>
                            <p>Analog algorithmic processing: electroacoustic elaboration through loops, delay, filtering, and creation of "psychedelic vortices".</p>
                        </div>
                        <div class="info-box">
                            <strong>Section C (8'30"-13'08")</strong>
                            <p>Synthesis and meta-commentary: predominance of the Synket with Brechtian device of direct composer intervention.</p>
                        </div>
                    </div>

                    <h3>Technological Innovation</h3>
                    <p>
                        Use of the <strong>Synket</strong> (analog synthesizer developed by Paul Ketoff at Cinecittà), one of the first systematic integrations between musique concrète and electronic synthesis. The final estrangement device anticipates media art practices that would become canonical in the digital era.
                    </p>

                    <h3>Scientific Publication</h3>
                    <p>
                        <strong>Musicological essay:</strong> "Air Piece: From Ecoacoustics of the Soundscape to Sound Fantasy of Musical Theatre"<br>
                        <strong>ISBN:</strong> 9780244560393 (2020)<br>
                        <strong>Recognition:</strong> Fondazione Isabella Scelsi, Rome - John Heineman Archive (Fondo 7)
                    </p>
                </div>

                <!-- Table of Contents -->
                <h2 id="index-en">Table of Contents</h2>
                <ul style="list-style: none; padding-left: 0; line-height: 2;">
                    <li><a href="#biography-en" style="color: var(--accent-blue);">- Biography of John Heineman</a> <span style="float: right;">p. 3</span></li>
                    <li><a href="#overview-en" style="color: var(--accent-blue);">- Brief overview of the birth of soundscape composition</a> <span style="float: right;">p. 4</span></li>
                    <li><a href="#fantasy-en" style="color: var(--accent-blue);">- From soundscape composition to musical theater sound fantasy</a></li>
                    <li><a href="#analysis-en" style="color: var(--accent-blue);">- Analysis of Air Piece by John Heineman</a> <span style="float: right;">p. 7</span></li>
                </ul>

                <hr style="margin: 3rem 0; border: 1px solid var(--border-color);">

                <!-- Biography -->
                <h2 id="biography-en">Biography of John Heineman</h2>
                <p>John Heineman (New York 1939) began studying trombone at Mannes College of Music while simultaneously studying composition, which he would continue in Rome, perfecting his skills with Goffredo Petrassi. He graduated from Columbia University. In 1966, he completed his course at the Accademia di Santa Cecilia, presenting his orchestral composition "Consequents" which was performed by the Orchestra dell'Accademia di Santa Cecilia.</p>

                <p>He was also a student of Elias Tanenbaum, Peter Stearns and Boris Porena. "The apprenticeship with Tanenbaum went beyond, for Heineman, the boundaries of instrumental study: a student of Bohuslav Martinu, Tanenbaum was well-versed in the entire front of the European historical avant-garde (Bartók, Webern...) and the most recent trends in jazz (Parker)," [Alessandro Mastropietro]</p>

                <p>Already during his first years of study at Mannes College of Music, he was fascinated by improvisation and often on weekends would invite musician friends, Alex Hershenson (trumpet) and Andy Pagano (clarinet), to the college for improvisation sessions seeking particular atmospheres. He personally attended concerts by Charlie Parker, Clifford Brown during the recording of "A Night at Birdland Vol. 1", John Coltrane with Thelonious Monk, remaining fascinated by improvisation since adolescence.</p>

                <p>He was among the founders of the Gruppo di Improvvisazione Nuova Consonanza with which he performed concerts between 1965 and 1970, performing in various European cities including a concert for electronics and improvisation at the 31st Venice Festival of Contemporary Music in September 1968. With the Gruppo di Improvvisazione Nuova Consonanza he recorded several LPs (trombone and cello), including Avant Garde vol. II, Gruppe Il Gruppo, The Private Sea of Dreams.</p>

                <p>He collaborated with the inter-disciplinary theater Gruppo Altro. He is the author, among others, of two conceptual works, Air Piece (1970) and Very, Very Beautiful (1973), which are considered emblematic in their genre. After living in Berlin, Canada and New York, since 1982 Heineman has resided permanently in Italy. After a pause of several years from music, he returned to playing first the flugelhorn and then the alto saxophone.</p>

                <p>Air Piece was performed in Rome on February 15, 1970, at the Berliner Festwochen in 1973 and at the Manhattan School of Music in New York in 1974. Also in 1974, Very, Very Beautiful was presented, a 1974 work by John Heineman that uses similar compositional processes. It was performed in Rome between March 29 and 31, 1974 in collaboration with TEAM Roma at Beat 72.</p>

                <p>Among various recognitions, he received the Composers Award from Broadcast Music Inc. (1965) and a Rome Prize Fellowship at the American Academy (1967-69).</p>

                <hr style="margin: 3rem 0; border: 1px solid var(--border-color);">

                <!-- Overview -->
                <h2 id="overview-en">Brief Overview of the Birth of the Soundscape</h2>

                <p>Raymond Murray Schafer defined the soundscape as the sonic environment that surrounds us and in which we live as perceived by the people immersed in it. We could also define the soundscape as the soundtrack of our lives, encompassing in the soundscape all the sounds that accompany our existence, from those we intercept involuntarily in daily activities to those to which we pay more attention such as a concert in a theater.</p>

                <p>Sound can take on different connotations: sound as an objective physical phenomenon and sound as an auditory sensation. Among the sensory organs we identify in hearing a dual nature, hearing as a physiological phenomenon and listening as a psychological intellectual act. The ability to listen is an intentional act and can be developed. Listening is mediated by the individual's historical-socio-cultural presuppositions in the context in which they live.</p>

                <p>The soundscape is in rapid and continuous change, sounds multiply and often standardize, canceling out characteristics typical of certain soundscapes. We can speak of an effect of sonic globalization. Airplanes, automobiles, industrial plants contribute to compromising both the psychophysical well-being of humans and to annihilating the uniqueness of places. The invasive presence of sounds mostly at low frequencies and of strong intensity makes the soundscape of different places increasingly homogeneous, canceling out territorial sonic identities.</p>

                <hr style="margin: 3rem 0; border: 1px solid var(--border-color);">

                <!-- From soundscape to fantasy -->
                <h2 id="fantasy-en">From Soundscape Composition to Musical Theater Sound Fantasy</h2>

                <p>Air Piece is a musical theater sound fantasy with a plot and its own development. The sonic events that follow one another will create episodes of movement alternating with quieter phases, hectic and violent scenes, vortices, more static moments, and sudden scene changes.</p>

                <p>We can certainly place Air Piece within soundscape composition, being at the same time one of the first compositions of this genre and an evolution of it, anticipating certain developments. As well defined by Murray Schafer, soundscape composition explores and interprets the sound of environments.</p>

                <p>In Air Piece, the recorded sonic environment is undoubtedly part of a soundscape that has already rapidly changed and is in continuous evolution. We find ourselves immersed in a completely transfigured sonic environment, moving within this environment capturing its characteristics from different listening points.</p>

                <p>Clear and frank expositions, immaculate sound recordings, true and raw, that transform into dreamy vortices with psychedelic references thanks to the compositional techniques implemented by the Author. Air Piece also induces the listener to relate the present soundscape, the one narrated and staged, to what is no longer, to what must be imagined before the sonic transfiguration that the environment has undergone.</p>

                <p>We can only imagine how the places described in Air Piece must have sounded just a decade before the recordings (Fiumicino airport was built between 1958 and 1960). Imagining sounds is not easy, and it would require dedicated and in-depth studies on people's ability to imagine sounds and describe them. Even more difficult is imagining sounds that one does not know, even assuming (from photographic sources, videos or written and oral accounts) the sound sources present in a place, we could try to imagine the sounds but the lack of certain sound material remains a major deficiency.</p>

                <p>This analysis of Air Piece highlights both the physical acoustic aspects and John Heineman's ability to have created from these sonic events a Work that is both a sonic document stimulating ecosonological research and a musical piece that evolves from the rigidity of pure documentation towards the creation of a musical theater sound fantasy.</p>

                <p>As will emerge in detail from the following analysis, there are three main sections within the piece that, recalling theatrical language, we can recognize as scenes.</p>

                <p><strong>The first scene</strong> is in pure soundscape composition style, with recordings made over several days inside and around the runway at Fiumicino airport. Other recordings were made at the American Academy in Rome: the voice of the child pronouncing "de dah...", the voice of a pilot interpreted by visual artist Jerry Kearns, the voice of his first wife Lydia Heineman up to the final voice of Heineman himself. These recordings are the result of recordings made starting from the spring of 1969 followed by hundreds of hours of listening and editing in the studio.</p>

                <p><strong>In the second scene</strong> the soundscape is processed through filtering, loops and delay. In those years the influence of experimental and psychedelic currents was very strong, this second scene transports us into a "psychedelic trip" with pilots' voices in vortices of loops, effects and distortions. We remember that precisely in 1970, Timothy Leary, American writer, psychologist and artist, promoter of the use of psychedelic substances, escaped from prison to flee first to Algiers then to Switzerland. His resonance arrived strongly even in Rome. For more information on Timothy Leary, however, refer to other sources. The recordings of this section B come from a large amount of tapes in restricted archives to which Heineman had gained access.</p>

                <p><strong>The third scene</strong> is predominantly electronic with an interlude of looped voices and airplane sounds. In this last section an analog tube synthesizer Synket ('Synthesiser-Ketoff') designed by Paul Ketoff, sound engineer for RCA and active in Rome at Cinecittà Film Studios, was used. The Synket was artisanally produced and practically every commercialized model was a prototype as it was in continuous evolution between 1965 and 1976.</p>

                <h3>The Interdisciplinarity of Air Piece</h3>

                <p>The interdisciplinarity of Air Piece leads us to highlight also the following binomials that characterize relationships in the piece:</p>
                <ul>
                    <li>man - environment</li>
                    <li>man - speed (technology)</li>
                    <li>speed (technology) - environment</li>
                    <li>environment - music</li>
                    <li>music - technology</li>
                </ul>

                <p>A clear distinction between concrete sounds and electronic sounds contrasts the first scenes, exclusively composed of environmental recordings, with the third almost exclusively electronic.</p>

                <p>Also interesting to follow how the development of the human voice through the different scenes brings out the relationship between man and these changes, highlighting how man himself is both victim and cause of a sonic transformation. The human voice is present in the different scenes taking on different aspects and meanings.</p>

                <p>In the first scene man is immersed in the dense uniform sonic grain, contributes to creating it almost unconsciously, is a victim of it. In the second we find an evolution towards supersonic speeds with man consciously protagonist. In the third scene, like film credits, we find the reassuring voice of the Author who closes the sound theater fantasy as the curtain falls.</p>

                <hr style="margin: 3rem 0; border: 1px solid var(--border-color);">

                <!-- DETAILED ANALYSIS -->
                <h2 id="analysis-en">Analysis of Air Piece</h2>

                <p>Air Piece is a piece composed by John Heineman in 1970 making sound recordings at Fiumicino airport and in its surroundings and has a duration of 13'08". At the Electronic Music Studio "G. Rossini" in Pesaro, a Stereophonic version was made from the original four-track recordings, completing the recordings made at Fiumicino with archival recordings (voices of pilots, control tower and Frecce Tricolori) and the use of electronics.</p>

                <p>To carry out the analysis of the piece, three macrosections have been identified which we will call A, B, C. In each section, subsections will be highlighted (a1, a2, a3,...b1,...). These divisions were determined for coherence of timbral events, highlighting over time the presence of various different sound sources, identifying the assemblages performed in the editing-composition phase, as well as divisions of a more subjective and suggestive character, always referring to clear parameters highlighted by the spectrogram images.</p>

                <div class="info-grid" style="margin: 2rem 0;">
                    <div class="info-box">
                        <strong>Sec. A 0'0" - 3'12"</strong>
                        <p>Exposition of the sonic environment. Fiumicino Airport.</p>
                    </div>
                    <div class="info-box">
                        <strong>Sec. B 3'12" - 8'30"</strong>
                        <p>Airplanes. Takeoffs, landings. Pilots, Frecce Tricolori, sonic boom.</p>
                    </div>
                    <div class="info-box">
                        <strong>Sec. C 8'30" - 13'08"</strong>
                        <p>Electronics, author's voice.</p>
                    </div>
                </div>

                <hr style="margin: 3rem 0; border: 1px solid var(--border-color);">

                <!-- SECTION A -->
                <h3 style="color: var(--accent-purple); font-size: 1.5rem;">SECTION A - Exposition of the Sonic Environment</h3>

                <p><em>Tonics: engines, turbines, crowd inside an airport</em><br>
                <em>Signals: speaker voice, pilot</em></p>

                <div style="text-align: center; margin: 2rem 0;">
                    <img src="images/spectrograms/spectrogram_page8_0.png" alt="Spectrogram - Section A Overview" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                    <p style="font-style: italic; color: var(--text-secondary); margin-top: 0.5rem;">Panoramic view of Section A - Soundscape of Fiumicino airport</p>
                </div>

                <div style="text-align: center; margin: 2rem 0;">
                    <img src="images/spectrograms/spectrogram_page8_1.png" alt="Spectrogram - Section A Detail" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                    <p style="font-style: italic; color: var(--text-secondary); margin-top: 0.5rem;">Spectral detail - Engine and turbine tonics with voice signals</p>
                </div>

                <h4>a1) Fiumicino Terminal - Time 0.00</h4>
                <p>The piece begins with a loud car engine, very close and present. It is in rapid decay and immediately gives way to the surrounding environment. The voice of a speaker broadcast from loudspeakers becomes clearer, French pronunciation can be discerned although the meaning cannot be understood. We are therefore in the area of Fiumicino airport whose soundscape, together with the surrounding environment, will be described in the first part of the piece.</p>

                <div style="text-align: center; margin: 2rem 0;">
                    <img src="images/spectrograms/spectrogram_page9_0.png" alt="Spectrogram - Very intense initial engine" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                    <p style="font-style: italic; color: var(--text-secondary); margin-top: 0.5rem;">The very intense initial engine - Frequencies between 43 and 250 Hz with values up to -12dB</p>
                </div>

                <p style="background: #f5f5f5; padding: 1rem; border-left: 4px solid var(--accent-blue); margin: 1rem 0;">
                <strong>Technical note:</strong> The very intense initial engine shows frequencies between 43 and 250 Hz with values up to -12dB that decay rapidly.
                </p>

                <p><strong>Time 5.845:</strong> The car engine decreases rapidly and in the same sonic event we perceive turbines in the distance with high-pitched sounds proceeding in an ascending glissando up to 3600Hz with weak but still clearly perceptible intensities (-31 dB).</p>

                <h4>a2) Announcements - Time 12.00</h4>
                <p>The glissando of the turbines ends and a richer spectrum in frequency range opens up. We are inside the airport and the voice of a speaker clearly shows the effects of reverberation typical of large enclosed spaces. At 17.250 we recognize a voice, with a rhythmic-melodic hint, repeated with a 500 ms delay (it starts at 17.250 on the left channel to repeat at 17.7500 on the right channel).</p>

                <p><strong>Time 23.700 - 33.100:</strong> Three telephone rings follow one another producing a series of upper partials clearly distinguishable from the spectrogram. The first two on the left channel, the third, masked, also on the right. The background noise masks the partials below 3700 Hz.</p>

                <div style="text-align: center; margin: 2rem 0;">
                    <img src="images/spectrograms/spectrogram_page10_0.png" alt="Spectrogram - Telephone rings" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                    <p style="font-style: italic; color: var(--text-secondary); margin-top: 0.5rem;">Telephone rings on the left channel - Background noise masks partials below 3700 Hz</p>
                </div>

                <h4>a3) Departure announcements - Time 33.100 - 1'36" (Only from the right channel)</h4>

                <p><em>Speaker's voice:</em><br>
                "Karachi, Calcutta, Bangkok, Hong Kong e Tokio. Verrà chiamato tre 5 minuti all'uscita numero cinque".<br><br>
                From the background a turbine of an engine around 3000Hz, we define these turbines as tonics that we will often find throughout the piece.</p>

                <p>Meanwhile the speaker's voice continues:<br>
                46" May i have your attention please",<br>
                49" Jal, Japan Airline inform that flight number 452<br>
                53" to Cairo, Karachi...</p>

                <p>...we hear, in the foreground and close up, the voice of a child, almost intoning a fragment of melody. <strong>"Dee dah, dee dah, de dah…de dah…de d…"</strong>. It is completely unexpected from the events that have followed so far, and creates a strong detachment from the soundscape that is taking shape. It is in the foreground and its detachment takes us very far away.</p>

                <div style="text-align: center; margin: 2rem 0;">
                    <img src="images/spectrograms/spectrogram_page11_0.png" alt="Spectrogram - Child's voice" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                    <p style="font-style: italic; color: var(--text-secondary); margin-top: 0.5rem;">Signals - The child's voice (time 56.700) with upper harmonics in clear evidence</p>
                </div>

                <p style="background: #f5f5f5; padding: 1rem; border-left: 4px solid var(--accent-blue); margin: 1rem 0;">
                <strong>Signals:</strong> The child's voice (time 56.700) with upper harmonics in clear evidence.
                </p>

                <p>New signals follow one another: the announcements continue with the voice of another speaker until giving way to turbines and engines that from tonics become soloists in a crescendo that develops between 1'06" and 1'36".</p>

                <h4>a4) Turbines and jet engines - Time 1'36" - 2'09"</h4>
                <p>Rapid crescendo of turbines and broadband engines closes section A with the tonics always present in the background. The ignition of an engine starts a new glissando of turbines that rapidly rise in frequency and intensity ending abruptly with a sharp cut. The ascending glissando of turbines and engines, first of exponential type then of logarithmic type, with an intensity increase reaching -7 dB.</p>

                <div style="text-align: center; margin: 2rem 0;">
                    <img src="images/spectrograms/spectrogram_page12_0.png" alt="Spectrogram - Turbine and engine glissando" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                    <p style="font-style: italic; color: var(--text-secondary); margin-top: 0.5rem;">The ascending glissando of turbines and engines with intensity increase up to -7 dB</p>
                </div>

                <h4>a5) Airplanes in flight. Calm. - Time 2'09" - 2'30"</h4>
                <p>A fall into the void arrives at the end of the long previous crescendo. Suddenly only the engines remain, which now, with constant movement, seem calm and silent to us. A brief moment of tranquility with only the tonics until the appearance of new signals. The calmest phase with the engine tonics always present. A very dark and stable sound with a center band around 170 Hz and an intensity of -19 dB.</p>

                <div style="text-align: center; margin: 2rem 0;">
                    <img src="images/spectrograms/spectrogram_page12_1.png" alt="Spectrogram - Calm phase" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                    <p style="font-style: italic; color: var(--text-secondary); margin-top: 0.5rem;">The calmest phase - Dark and stable sound with center band at 170 Hz and intensity of -19 dB</p>
                </div>

                <h4>a6) Jerry Kearns pilot's voice - Time 2.30 - 3'12"</h4>

                <p>2'32" Pilot's welcome message: <em>"good evening ladies and gentlemen this is your pilot speaking, i trust that your departure from L.A. was a comfortable one"</em>. In the background the tonic, airplane engine in flight, with constant movement.</p>

                <p>2'38" Pilot's radio communications: <em>"Ah, we're looking forward to a very pleasant flight tonight, as we check the weather, we see no foreseeable problems as far as turbulence goes"</em></p>

                <p>2'48" <em>"Our flight to Albuquerque should take approximately an hour and a half, to an hour and thirty-five minutes"</em></p>

                <p>2'55" <em>"Ah, we hope you can settle in and relax and enjoy the trip. Please undo your seat belts."</em></p>

                <p>3'01" <em>"I will cut back in later if any interesting sites - ah pass by - ah below us as we continue our journey".</em></p>

                <p style="background: #f5f5f5; padding: 1rem; border-left: 4px solid var(--accent-purple); margin: 1rem 0;">
                Jerry Kearns, visual artist and friend of John Heineman, recorded these dialogues at the American Academy. "Kearns spontaneously was able to imitate a typical American mid-western accent (perfect for the piot's intervention on board a plane that I was looking for)" email from Heineman. "That recording helped to shape the direction of the piece, triggering the idea of psychedelic effects - of variable speed, break-up of his speech (use of filters etc.) suggesting various contrapuntal voice-over techniques (the settle-in and relax and enjoy the trip - triggering psychedelic effects idea - the comic-like effect of his voice slowed down to mimic an inebriated pilot)."
                </p>

                <hr style="margin: 3rem 0; border: 1px solid var(--border-color);">

                <!-- SECTION B -->
                <h3 style="color: var(--accent-purple); font-size: 1.5rem;">SECTION B - In Flight. Pilots, Control Tower, Aerobatics, Sonic Boom</h3>

                <p><em>Tonics: engines, turbines, automobiles</em><br>
                <em>Signals: voices of pilots in flight, voices from control tower, looped voices, sonic boom</em></p>

                <p>This section is a dreamlike journey of man in a kaleidoscope of speed. The voices of pilots in flight that chase each other in swirling canons will gradually give way to turbines and jet engines alternating calm sonic events with very hectic and violent events such as the sonic booms of breaking the sound barrier. We are at the mercy of the events that follow one another, phases of rest alternate with psychedelic dreams that transport the listener beyond the usual.</p>

                <h4>b1) Time 3'12" - 3'18"</h4>
                <p>New brief moment of tranquility with only the tonics of engines in flight.</p>

                <h4>b2) Signals. 4-voice imitation - Time 3'18" - 3'39</h4>
                <p>Looped pilots' voices create vortices in crescendo. Above the constant background of airplane engines, the voices move quickly creating a swirling movement, a psychedelic reference in contrast to the stability of airplane engines in flight.</p>

                <div style="text-align: center; margin: 2rem 0;">
                    <img src="images/spectrograms/spectrogram_page15_0.png" alt="Spectrogram - Looped voices" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                    <p style="font-style: italic; color: var(--text-secondary); margin-top: 0.5rem;">Looped pilots' voices with engines in flight - Swirling psychedelic vortices</p>
                </div>

                <div style="text-align: center; margin: 2rem 0;">
                    <img src="images/spectrograms/spectrogram_page15_1.png" alt="Spectrogram - Voice details" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                    <p style="font-style: italic; color: var(--text-secondary); margin-top: 0.5rem;">Alternating events of tonics and voices - Narrowband signals in descending glissandi</p>
                </div>

                <h4>b3-b6) Time 3'39" - 4'23"</h4>
                <p>Events of only tonics (engines in flight) and returns of looped pilots' voices alternate. The last episode of this alternation culminates with: <em>"……Settle in and relax and enjoy the trip"</em>. Clear narrowband signals can be seen from the spectrogram moving in descending glissandi (from 4800Hz to 4350Hz).</p>

                <h4>b7) Time 4'23" - 4'33"</h4>
                <p>Very intense engine tonics in flight at low frequencies.</p>

                <h4>b8) Military alphabet - Time 4'33 - 5'24"</h4>

                <p><em>"Roger fox baker baker dog Quinn, you are clear to descend to two thousand feet…and check your finny fox fox one zero one seven point two".</em></p>

                <p>Communications between pilots and control tower in military alphabet follow one another. <em>"Give us a call when 3 miles out, over.ah c"</em><br>
                Second voice: <em>"…Roger, Fox, Baker, Baker Dog Quinn…"</em></p>

                <p>The voice signals of the pilots can be distinguished, repeating in loops and overlapping in canon, with the characteristic broadband hiss of radio communications.</p>

                <p>5'10" <em>"Check your Finny FOX FOX 1017.2"</em><br>
                <em>"Give us a call when 3 miles out, over".</em></p>

                <p>At 5'12" a very intense tonic while communications between pilots and control tower continue.</p>

                <h4>b9) turbines, jet engines - Time 5'24" - 5'46"</h4>
                <p>Strong narrowband signals, in multiple descending glissandi. Turbine signals with very intense engine tonics (-7 dB)</p>

                <div style="text-align: center; margin: 2rem 0;">
                    <img src="images/spectrograms/spectrogram_page18_0.png" alt="Spectrogram - Turbines and jet engines" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                    <p style="font-style: italic; color: var(--text-secondary); margin-top: 0.5rem;">Turbines and jet engines - Descending glissandi with intensity of -7 dB</p>
                </div>

                <h4>b10) Performance by the Frecce Tricolori of the Aeronautica Militare - Time 5'46" 6'04"</h4>

                <p>A speaker communicates from loudspeakers in an open place: <em>"E' già sul campo la pattuglia italiana"… "…sta per eseguire una virata di tipo Schneider…si portano nuovamente sul campo per eseguire una virata tipo Schneider".</em></p>

                <p style="background: #f5f5f5; padding: 1rem; border-left: 4px solid var(--accent-yellow); margin: 1rem 0;">
                The Schneider-type turn is a particular maneuver performed by a passage of the so-called "soloist", imprinting an undulating movement on the airplane. The maneuver is generally performed in landing configuration and at speeds close to stall. In the formation each aircraft has a very specific role, which each pilot will observe for the safety and success of the evolution. (Note the analogies between the terminology used in aerial acrobatics and musical terminology. The formation, the soloist, looping, sonic boom, cardioid formation).
                </p>

                <p>The very rapid passages of the airplanes create broadband spectra that grow and decay rapidly. From the spectrogram we can clearly identify three passages between 5'55" and 6'04.</p>

                <div style="text-align: center; margin: 2rem 0;">
                    <img src="images/spectrograms/spectrogram_page19_0.png" alt="Spectrogram - Frecce Tricolori" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                    <p style="font-style: italic; color: var(--text-secondary); margin-top: 0.5rem;">Aerial maneuvers of the Frecce Tricolori - Broadband spectra with three identifiable passages</p>
                </div>

                <div style="text-align: center; margin: 2rem 0;">
                    <img src="images/spectrograms/spectrogram_page19_1.png" alt="Spectrogram - Schneider turn" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                    <p style="font-style: italic; color: var(--text-secondary); margin-top: 0.5rem;">Schneider-type turn - Rapid crescendo and decrescendo of aerial passages</p>
                </div>

                <h4>b11) Sonic boom - Time 6'04" - 6'11"</h4>
                <p><em>"Attenzione, fra poco udremo il bang che si verifica quando avviene il superamento della barriera sonica"</em>. Instead of the sonic boom we hear however a not too intense roar of brief duration.</p>

                <h4>b12) Pilots control tower - Time 6'12" - 6'35"</h4>

                <p>Engines in flight, dialogues between control tower and pilots that overlap:</p>
                <p><em>"..i'll be over in about, ah, 3 minutes, 4 minutes, over"<br>
                "…Able Dog Charlie, Roger, we are standing by waiting your call when reaching Cittavecchia, over"<br>
                "ah, my position is ? ah' ventuno decon, over"<br>
                "Roma approach 119.1, over"<br>
                "Request your altitude, also, over"<br>
                "Altitude 4,500 feet"<br>
                "ah, Fox, Baker, baker, dog"</em></p>

                <h4>b13) Time 6'35" - 7'02"</h4>

                <p><em>"Hanno compiuto il primo looping"</em> - voice of a commentator commenting on the aerial maneuvers of the Frecce Tricolori and announcement of a new very strong sonic boom in a band between 40Hz and 180Hz with intensity up to -6 dB.</p>

                <p><em>"…jet 84F effetteranno la superamento della barriera del suono"<br>
                "… e fra poco udremo il bang…secondo bang".</em></p>

                <p>This violent phase closes with the sound of turbines that pass by us quickly creating brief descending glissandi of strong intensity.</p>

                <h4>b14) Time 7'02" - 7'46"</h4>
                <p>A scene opens with only engines as protagonists. These are engines of different types, and helicopter rotors. As can be clearly seen from the spectrogram, the sound of the propeller is described by dense vertical broadband lines. At low frequencies always the very intense engine tonics.</p>

                <h4>b15) Time 7'46" - 8'29"</h4>

                <p>Moments of relaxation alternate with episodes with engines of different types, but no longer supersonic aircraft. At 8'03" a woman's voice laughing on the left channel only and developing into a fragmented, hysterical and compulsive laugh that, mixed with the engines, evolves into a melodic fragment closing the long section B.</p>

                <p>The voice on the left channel that closes section B with a repeated rhythmic melodic fragment: <strong>"Keep singin' keep singin'"</strong>. This is the voice of Candy Wechsler who takes us into a transitional phase projecting us, from the dark and menacing scene that is concluding, to the shining final scene.</p>

                <hr style="margin: 3rem 0; border: 1px solid var(--border-color);">

                <!-- SECTION C -->
                <h3 style="color: var(--accent-purple); font-size: 1.5rem;">SECTION C - Electronics and Author's Voice</h3>

                <p>In the third scene linear, defined and constant electronic sounds contrast with the scenario seen in the first two scenes. Here are brief voice loops remnants of the previous scene in a sort of brief ostinato. After the long journey it is a return to reality. A return that initially takes shape with almost pure sounds and then evolves into more complex spectra, accompanied by the author's voice that thanks and accompanies the closing of the curtain. A landing on more conventional territories. The dimension that is created in the last scene takes us back to reality.</p>

                <h4>c1) Synket - Time 8'30" - 10'44"</h4>

                <p>The sounds of the Synket open the scenario joining the voice loop that repeats <em>"Keep singin' keep singin'"</em>. At time 8'53" the voice loop ends and also on the right channel the sounds of the Synthesizer begin. An increasingly dense weave of sounds creates melodic lines and beats, intermittencies, chords and clusters that evolve and intersect.</p>

                <div style="text-align: center; margin: 2rem 0;">
                    <img src="images/spectrograms/spectrogram_page21_0.png" alt="Spectrogram - Synket" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                    <p style="font-style: italic; color: var(--text-secondary); margin-top: 0.5rem;">Entrance of the Synket - Linear and constant electronic sounds</p>
                </div>

                <div style="text-align: center; margin: 2rem 0;">
                    <img src="images/spectrograms/spectrogram_page21_1.png" alt="Spectrogram - Voice loops" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                    <p style="font-style: italic; color: var(--text-secondary); margin-top: 0.5rem;">Voice loop "Keep singin'" with electronic synthesis - Dense weave of sounds</p>
                </div>

                <div style="text-align: center; margin: 2rem 0;">
                    <img src="images/spectrograms/spectrogram_page22_0.png" alt="Spectrogram - Complex synthesis" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                    <p style="font-style: italic; color: var(--text-secondary); margin-top: 0.5rem;">Melodic lines and beats - Chords and sonic clusters of the synthesizer</p>
                </div>

                <h4>c2) You can hear it now - Time 10'44" - 11'13"</h4>
                <p>A woman's voice repeats in a loop <em>"you can hear it now"</em> and that of a man overlaps responding <em>"hear what?"</em>.</p>

                <h4>c3) Time 11'13" - 11'35"</h4>
                <p>The woman's voice pronounces <em>"the Jet"</em> and a background previously seen opens up, that of jet engines. A dejavu that brings us back to an already lived experience, a new brief dreamlike relapse.</p>

                <h4>c4) Time 11.35" - 12'23"</h4>
                <p>A melody arriving from afar flows anticipating the falling of the curtain. A delay and a reverb move this simple and melancholic melody in D minor that grows, moves, chases itself with the last memories of airplane engines. The light aircraft seem to circle in harmony with the melody in the background, a reference to Fellini's cinema.</p>

                <h4>c5) End credits - Time 12'23" - 13'08"</h4>

                <p>Like the credits of a visual work, the Author's voice enters. It is the farewell after this beautiful long journey in which moments of military lucidity alternated with dreamlike scenes.</p>

                <div style="text-align: center; margin: 2rem 0;">
                    <img src="images/spectrograms/spectrogram_page24_0.png" alt="Spectrogram - Author's voice" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                    <p style="font-style: italic; color: var(--text-secondary); margin-top: 0.5rem;">End credits - John Heineman's voice thanking the audience</p>
                </div>

                <blockquote style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem; border-radius: 10px; font-style: italic; margin: 2rem 0;">
                "Good evening ladies and gentlemen, ah, this is your composer speaking, ah, we hope you've enjoyed the composition, ah, as much as the technician and I have enjoyed doing it. I'd like to thank you very much for your participation here tonight ah, would just like to wish you a very good evening and a very pleasant journey ahead, Thank you".
                </blockquote>

                <p style="text-align: center; font-size: 1.2rem; margin-top: 3rem; color: var(--accent-purple);">
                <strong>A piece that opens up new compositional styles, maintaining within it clear matrices of traditional musical stamp that make it a Musical Theater Sound Fantasy.</strong>
                </p>

            </div>
        </section>

        <!-- MEDIA SECTION -->
        <section id="media" class="section">
            <div class="card">
                <h2>📸 Media Gallery</h2>
                <p>Visual documentation of the project: Max/MSP patch screenshots, performance images, and dynamic score indications.</p>

                <h3>Screenshots & Performance</h3>
                <div class="gallery" id="gallery">
                    <div class="gallery-item modal-trigger" data-src="images/patch.jpg">
                        <img src="images/patch.jpg" alt="Max/MSP Patch">
                        <div class="gallery-caption">
                            John Heineman
                        </div>
                    </div>
                    
                    <div class="gallery-item modal-trigger" data-src="images/performance1.jpg">
                        <img src="images/performance1.jpg" alt="Performance 1">
                        <div class="gallery-caption">
                            John Heineman e Frederic Rzewski
                        </div>
                    </div>
                    
                    <div class="gallery-item modal-trigger" data-src="images/performance2.jpg">
                        <img src="images/performance2.jpg" alt="Performance 2">
                        <div class="gallery-caption">
                            Gruppo di Improvvisazione Nuova Consonanza
                        </div>
                    </div>
                    
                    <div class="gallery-item modal-trigger" data-src="images/performance3.jpg">
                        <img src="images/performance3.jpg" alt="Performance 3">
                        <div class="gallery-caption">
                            
                        </div>
                    </div>
                    
                    <div class="gallery-item modal-trigger" data-src="images/analysis.jpg">
                        <img src="images/analysis.jpg" alt="Spectral Analysis">
                        <div class="gallery-caption">
                            
                        </div>
                    </div>
                    
                    <div class="gallery-item modal-trigger" data-src="images/text.jpg">
                        <img src="images/text.jpg" alt="Text Generation">
                        <div class="gallery-caption">
                            "I remember?" - Text generation via Markov chains
                        </div>
                    </div>
                </div>

                <h3>Video Documentation</h3>
                <div class="video-container">
                    <iframe src="https://www.youtube.com/embed/PYq9oTtsibQ" allowfullscreen></iframe>
                </div>
                
                <div style="margin-top: 1rem;">
                    <div class="video-container">
                        <iframe src="https://www.youtube.com/embed/-KO_oYgZrn8" allowfullscreen></iframe>
                    </div>
                </div>
            </div>
        </section>

        <!-- LABORATORY SECTION -->
        <section id="lab" class="section">
            <div class="card">
                <h2>🧪 Interactive Laboratory</h2>
                <p>Experiment with the core algorithms of the work: Markov generation, spectral audio analysis, and integrated performance mode.</p>
            </div>

            <!-- Markov Generator -->
            <div class="card" id="markovSection">
                <h3>🎤 Professional Markov Text Generator</h3>
                <p>Enter text and the algorithm will generate variations based on Markov chains. Choose different orders to explore how context depth affects text generation.</p>

                <div class="lab-container">
                    <textarea
                        class="text-input"
                        id="markovInput"
                        placeholder="Enter your base text here (try with Very Beautiful phrases or any text of your choice)..."
                    >Very beautiful. You speak English? Very very beautiful. I remember everything. You don't remember? I don't remember. Oh, you speak Italian? Very beautiful. I like Rome. Very very beautiful. Beautiful Rome. I remember. Do you remember?</textarea>

                    <!-- Markov Order Selector -->
                    <div style="margin: 1.5rem 0; padding: 1.2rem; background: rgba(72, 219, 251, 0.05); border-radius: 10px; border: 1px solid rgba(72, 219, 251, 0.2);">
                        <label style="display: block; margin-bottom: 0.8rem; font-weight: 600; color: var(--accent-blue);">
                            🔗 Chain Order (Context Depth):
                        </label>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 0.8rem;">
                            <button class="markov-order-btn" data-order="1">
                                Order 1<br>
                                <small style="font-size: 0.75rem; opacity: 0.8;">Chaotic</small>
                            </button>
                            <button class="markov-order-btn" data-order="2">
                                Order 2<br>
                                <small style="font-size: 0.75rem; opacity: 0.8;">Fragmented</small>
                            </button>
                            <button class="markov-order-btn active" data-order="3">
                                Order 3<br>
                                <small style="font-size: 0.75rem; opacity: 0.8;">Balanced</small>
                            </button>
                            <button class="markov-order-btn" data-order="4">
                                Order 4<br>
                                <small style="font-size: 0.75rem; opacity: 0.8;">Coherent</small>
                            </button>
                        </div>
                        <div id="orderDescription" style="margin-top: 1rem; padding: 0.8rem; background: rgba(255,255,255,0.5); border-radius: 6px; font-size: 0.9rem; color: #555;">
                            <strong>Order 3 (Balanced):</strong> Uses 3-word context. Maintains grammatical coherence while introducing creative variations. Best balance between originality and readability. Ideal for most texts.
                        </div>
                    </div>

                    <div class="controls">
                        <button class="btn" id="generateMarkovBtn">✨ Generate Variation</button>
                        <button class="btn btn-secondary" id="autoMarkovBtn">🔄 Auto Generate</button>
                        <div class="status" id="markovStatus">Ready</div>
                    </div>

                    <div class="output-box" id="markovOutput">
                        <em style="color: #888;">Generated variations will appear here...</em>
                    </div>
                </div>

                <!-- Educational explanation -->
                <div style="margin-top: 1.5rem; padding: 1.5rem; background: linear-gradient(135deg, rgba(72, 219, 251, 0.08) 0%, rgba(254, 202, 87, 0.08) 100%); border-radius: 12px; border-left: 4px solid #48dbfb;">
                    <h4 style="margin-top: 0; color: #48dbfb;">📚 Understanding Markov Chain Orders</h4>

                    <div style="margin-bottom: 1.2rem;">
                        <strong style="color: #666;">What are Markov Chains?</strong>
                        <p style="font-size: 0.95rem; line-height: 1.6; color: #555; margin: 0.5rem 0 0 0;">
                            Markov chains are mathematical models that predict the next element in a sequence based on previous elements.
                            In text generation, they analyze word patterns and create new sentences by probabilistically choosing words
                            that naturally follow what came before.
                        </p>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem; margin-top: 1.2rem;">
                        <div style="background: white; padding: 1rem; border-radius: 8px; border-left: 3px solid #e17055;">
                            <strong style="color: #e17055;">🎲 Order 1 (Chaotic)</strong>
                            <p style="font-size: 0.85rem; margin: 0.5rem 0 0 0; line-height: 1.5;">
                                Uses <strong>1-word context</strong> with automatic fallback to weighted random selection. Creates highly unpredictable text with unexpected word combinations. The algorithm respects word frequencies from the source but allows maximum chaos.
                                <br><strong>Best for:</strong> Experimental poetry, absurdist art, Dadaist performances, maximum unpredictability.
                                <br><strong>Technical:</strong> Bigram model with unigram fallback. High entropy, low coherence.
                            </p>
                        </div>

                        <div style="background: white; padding: 1rem; border-radius: 8px; border-left: 3px solid #fdcb6e;">
                            <strong style="color: #e17055;">🌱 Order 2 (Fragmented)</strong>
                            <p style="font-size: 0.85rem; margin: 0.5rem 0 0 0; line-height: 1.5;">
                                Uses <strong>2-word context</strong> with hierarchical backoff. Creates fragmented but somewhat grammatical text with frequent topic jumps. Better than Order 1 at maintaining local coherence.
                                <br><strong>Best for:</strong> Stream of consciousness, fragmented narratives, minimalist experimental writing.
                                <br><strong>Technical:</strong> Trigram model with bigram→unigram fallback. Medium entropy.
                            </p>
                        </div>

                        <div style="background: white; padding: 1rem; border-radius: 8px; border-left: 3px solid #48dbfb;">
                            <strong style="color: #0984e3;">⚖️ Order 3 (Balanced) - Recommended</strong>
                            <p style="font-size: 0.85rem; margin: 0.5rem 0 0 0; line-height: 1.5;">
                                Uses <strong>3-word context</strong> with full hierarchical backoff (3→2→1→0). Perfect balance between creativity and coherence. Maintains grammatical structure while introducing creative variations. Never gets stuck thanks to robust fallback chain.
                                <br><strong>Best for:</strong> Literary texts, poetry, artistic prose, theatrical scripts, most creative writing tasks.
                                <br><strong>Technical:</strong> Tetragram model with complete backoff hierarchy.
                            </p>
                        </div>

                        <div style="background: white; padding: 1rem; border-radius: 8px; border-left: 3px solid #00b894;">
                            <strong style="color: #00b894;">🎯 Order 4 (Coherent)</strong>
                            <p style="font-size: 0.85rem; margin: 0.5rem 0 0 0; line-height: 1.5;">
                                Uses <strong>4-word context</strong> with full backoff chain (4→3→2→1→0). Produces highly coherent text that closely mirrors the original style. Best with longer source texts that provide enough 5-grams for statistical learning.
                                <br><strong>Best for:</strong> Long source texts (3+ paragraphs), novels, essays, maintaining consistent voice and style.
                                <br><strong>Technical:</strong> 5-gram model with complete hierarchical smoothing.
                            </p>
                        </div>
                    </div>

                    <div style="margin-top: 1.2rem; padding: 1rem; background: rgba(254, 202, 87, 0.15); border-radius: 8px;">
                        <strong style="color: #d63031;">⚠️ Important Note:</strong>
                        <p style="font-size: 0.9rem; margin: 0.5rem 0 0 0; line-height: 1.6;">
                            Higher orders (3-4) require <strong>more input text</strong> to work well. With short texts, the algorithm may repeat
                            original phrases or struggle to generate variations. For best results with Order 3-4, provide at least 3-4 paragraphs of text.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Motion Detection with Recording -->
            <div class="card" id="motionSection">
                <h3>🎥 Advanced Motion Detection with Recording</h3>
                <p>The webcam detects your movements and transforms the text in real-time. Record your performance with synchronized audio!  - First activate camera - </p>

                <!-- Text Generation Controls -->
                <div style="padding: 1.2rem; background: rgba(254, 202, 87, 0.08); border-radius: 10px; margin-bottom: 1rem; border: 1px solid rgba(254, 202, 87, 0.2);">
                    <strong style="color: var(--accent-yellow); font-size: 1.1rem;">📝 Text Generation Controls</strong>

                    <div style="margin-top: 1rem;">
                        <label style="display: block; margin-bottom: 0.3rem; color: var(--text-secondary); font-size: 0.9rem;">
                            <strong>Slow Motion Update Speed</strong> <span id="slowSpeedValue" style="color: var(--accent-yellow);">3.0s</span>
                        </label>
                        <input type="range" id="slowSpeedSlider" min="1000" max="8000" step="200" value="3000"
                               style="width: 100%; cursor: pointer;">
                        <p style="font-size: 0.75rem; margin: 0.3rem 0 0 0; color: #888; line-height: 1.3;">
                            ⏱️ How often text changes during slow movements. Higher = text stays longer (more readable).
                        </p>
                    </div>

                    <div style="margin-top: 1rem;">
                        <label style="display: block; margin-bottom: 0.3rem; color: var(--text-secondary); font-size: 0.9rem;">
                            <strong>Fast Motion Update Speed</strong> <span id="fastSpeedValue" style="color: var(--accent-yellow);">1.5s</span>
                        </label>
                        <input type="range" id="fastSpeedSlider" min="300" max="4000" step="100" value="1500"
                               style="width: 100%; cursor: pointer;">
                        <p style="font-size: 0.75rem; margin: 0.3rem 0 0 0; color: #888; line-height: 1.3;">
                            ⚡ How often text changes during fast movements. Lower = rapid word changes.
                        </p>
                    </div>

                    <div style="margin-top: 1rem;">
                        <label style="display: block; margin-bottom: 0.3rem; color: var(--text-secondary); font-size: 0.9rem;">
                            <strong>Glitch Character Probability</strong> <span id="glitchIntensityValue" style="color: var(--accent-yellow);">8%</span>
                        </label>
                        <input type="range" id="glitchIntensitySlider" min="0" max="50" step="2" value="8"
                               style="width: 100%; cursor: pointer;">
                        <p style="font-size: 0.75rem; margin: 0.3rem 0 0 0; color: #888; line-height: 1.3;">
                            🎲 Chance each character becomes punctuation (.,!?-) during abrupt movements. 0% = clean text.
                        </p>
                    </div>

                    <div style="margin-top: 1rem;">
                        <label style="display: block; margin-bottom: 0.3rem; color: var(--text-secondary); font-size: 0.9rem;">
                            <strong>Text Size Range</strong> <span id="textSizeRangeValue" style="color: var(--accent-yellow);">0.8rem → 6.0rem</span>
                        </label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                            <div>
                                <label style="font-size: 0.75rem; color: #888;">Min Size</label>
                                <input type="range" id="minTextSizeSlider" min="0.5" max="2.0" step="0.1" value="0.8"
                                       style="width: 100%; cursor: pointer;">
                            </div>
                            <div>
                                <label style="font-size: 0.75rem; color: #888;">Max Size</label>
                                <input type="range" id="maxTextSizeSlider" min="2.0" max="10.0" step="0.5" value="6.0"
                                       style="width: 100%; cursor: pointer;">
                            </div>
                        </div>
                        <p style="font-size: 0.75rem; margin: 0.3rem 0 0 0; color: #888; line-height: 1.3;">
                            📏 Text grows from min (slow motion) to max (fast/abrupt motion). Try min=0.5, max=8 for dramatic effect!
                        </p>
                    </div>

                    <p style="font-size: 0.8rem; margin: 1rem 0 0 0; color: var(--text-secondary); font-style: italic; padding: 0.5rem; background: rgba(0,0,0,0.2); border-radius: 5px;">
                        💡 <strong>Quick Test:</strong> Move slowly → text changes every few seconds. Move fast → text grows larger and changes faster. Move abruptly → glitch effect!
                    </p>
                </div>
                
                <div class="lab-container">
                    <div style="position: relative; width: 100%; max-width: 640px; margin: 0 auto; height: 480px; background: #000; border-radius: 15px; overflow: hidden; border: 2px solid var(--border-color);">
                        <video id="motionVideo" autoplay muted style="display: none;"></video>
                        <canvas id="motionCanvas" style="width: 100%; height: 100%; display: block; border-radius: 15px;"></canvas>
                        <div id="motionTextOverlay" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 1.5rem; color: #fff; text-shadow: 2px 2px 8px rgba(0,0,0,0.9), 0 0 15px rgba(255,255,255,0.8); pointer-events: none; white-space: normal; font-weight: bold; z-index: 10; text-align: center; max-width: 85%; line-height: 1.4; padding: 0 1rem;"></div>
                    </div>
                    
                    <div class="controls" style="margin-top: 1.5rem;">
                        <button class="btn" id="startMotionBtn">🎬 Activate Camera</button>
                        <button class="btn btn-secondary" id="stopMotionBtn" disabled>⏹ Stop</button>
                        <button class="btn btn-record" id="recordBtn" disabled>⏺ Start Recording</button>
                        <button class="btn btn-secondary" id="downloadBtn" style="display: none;">💾 Download Video</button>
                        <div class="status" id="motionStatus">Camera inactive</div>
                        <div class="status" id="recordStatus" style="display: none;">Ready to record</div>
                    </div>

                    <!-- NUOVO: Preset di Sensibilità -->
                    <div class="sensitivity-presets" style="margin-top: 1.5rem;">
                        <span class="preset-label">🌙 Sensitivity:</span>
                        <button class="preset-btn" id="presetDark" disabled>🌑 Dark Room</button>
                        <button class="preset-btn active" id="presetNormal" disabled>☀️ Normal</button>
                        <button class="preset-btn" id="presetBright" disabled>💡 Bright Light</button>
                    </div>

                    <div style="padding: 1rem; background: rgba(72, 219, 251, 0.05); border-radius: 10px; margin-top: 1rem;">
                        <strong style="color: var(--accent-blue);">ℹ️ Sensitivity Info:</strong>
                        <p style="font-size: 0.9rem; margin: 0.5rem 0 0 0; color: var(--text-secondary);">
                            <strong>🌑 Dark Room:</strong> Maximum sensitivity for low-light environments. Increases brightness and detects subtle movements.<br>
                            <strong>☀️ Normal:</strong> Balanced settings for standard indoor lighting conditions.<br>
                            <strong>💡 Bright Light:</strong> Reduced sensitivity for very bright environments. Prevents over-detection.
                        </p>
                    </div>

                    <!-- Alert box per messaggi -->
                    <div id="recordingAlert" class="alert-box" style="display: none;">
                        <strong>ℹ️ Browser Info:</strong> <span id="alertMessage"></span>
                    </div>

                    <div id="motionInfo" style="display: none;">
                        <div class="info-grid" style="margin-top: 1rem;">
                            <div class="info-box">
                                <strong>Movement Type</strong>
                                <p id="movementType" style="font-size: 1.3rem; color: var(--accent-yellow);">--</p>
                            </div>
                            <div class="info-box">
                                <strong>Motion Intensity</strong>
                                <p id="motionIntensity" style="font-size: 1.3rem; color: var(--accent-yellow);">0%</p>
                            </div>
                            <div class="info-box">
                                <strong>Visible Area</strong>
                                <p id="visibleArea" style="font-size: 1.3rem; color: var(--accent-yellow);">0%</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Hidden audio player for background music -->
                    <audio id="motionAudio" loop style="display: none;" crossorigin="anonymous">
                        <source src="audio/VB_Flauto.mp3" type="audio/mpeg">
                    </audio>
                </div>

                <div style="margin-top: 1.5rem; padding: 1.2rem; background: rgba(254, 202, 87, 0.1); border-radius: 10px; border-left: 3px solid #feca57;">
                    <strong>🎨 How it works:</strong><br>
                     • <strong>First activate camera</strong> → Adjust the brightness according to your environment<br>
                    • <strong>No movement</strong> → Black screen, waiting for motion<br>
                    • <strong>Movement detected</strong> → Moving areas reveal with luminous glow<br>
                    • <strong>Movement intensity</strong> → Controls text generation and visual effects<br>
                    • <strong>Four modes</strong> → Still (repetition), Slow (trail), Fast (fragment), Abrupt (glitch)<br>
                    • <strong>🎵 Audio</strong> → VB_Flauto.mp3 plays automatically when camera activates<br>
                    • <strong>🎬 Recording</strong> → Click "Start Recording" to capture screen + audio performance<br>
                    • <strong>🌐 Browser Support</strong> → Best on Chrome/Firefox desktop. Safari/iOS has limited recording support.
                </div>
            </div>
        </section>

        <!-- DOCUMENTATION SECTION -->
        <section id="docs" class="section">
            <!-- John Heineman -->
            <div class="card">
                <h2>👤 John Heineman</h2>
                <div class="bio-container">
                    <div>
                        <div style="background: linear-gradient(135deg, #2d3561, #1a1f3a); padding: 3rem; border-radius: 15px; text-align: center; font-size: 4rem;">
                            🎼
                        </div>
                    </div>
                    <div class="bio-text">
                        <h3>Composer and Pioneer of Electroacoustic Music</h3>
                        <p>
                            John Heineman (New York, 1939) is a central figure in the history of Italian and international experimental music. After studies in the United States with Elias Tanenbaum and Jack Beeson, he moved to Italy in 1962 seeking a less academic environment.
                        </p>
                        
                        <h4>Training and Influences</h4>
                        <ul>
                            <li>Studies with Elias Tanenbaum (student of Bohuslav Martinů)</li>
                            <li>Mannes College of Music, Manhattan</li>
                            <li>Columbia University - composition degree</li>
                            <li>Direct experience of avant-garde jazz (Charlie Parker, Clifford Brown, John Coltrane)</li>
                            <li>Advanced studies with Boris Porena and Goffredo Petrassi (Accademia di Santa Cecilia, 1965-66)</li>
                        </ul>

                        <h4>Gruppo di Improvvisazione Nuova Consonanza</h4>
                        <p>
                            Among the founders of GINC (1964) together with Ennio Morricone, Franco Evangelisti, and Mario Bertoncini. Concert activity throughout Europe (1965-1970), with performances at Venice Contemporary Music Festival (1968) and various recordings.
                        </p>

                        <h4>Major Works</h4>
                        <ul>
                            <li><strong>Consequents</strong> (1966) - Accademia di Santa Cecilia Orchestra</li>
                            <li><strong>Air Piece</strong> (1970) - Electroacoustic conceptual work</li>
                            <li><strong>Very Beautiful</strong> (1973) - Experimental musical theatre</li>
                        </ul>

                        <h4>Recognition</h4>
                        <ul>
                            <li>Composers Award - Broadcast Music Inc. (1965)</li>
                            <li>Rome Prize Fellowship - American Academy (1967-69)</li>
                            <li>Archive at Fondazione Isabella Scelsi, Rome (Fondo 7)</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Francesco Mariano -->
            <div class="card">
                <h2>👨‍💻 Francesco Mariano</h2>
                <div class="bio-container">
                    <div>
                        <div style="background: linear-gradient(135deg, #1a1f3a, #2d3561); padding: 3rem; border-radius: 15px; text-align: center; font-size: 4rem;">
                            🎨
                        </div>
                    </div>
                    <div class="bio-text">
                        <h3>Multimedia Artist and Musician</h3>
                        <p>
                            Born October 31, 1973. Sound artist and educator with over 15 years of experience in audiovisual, multimedia, and musical design and teaching. His research focuses on electroacoustic composition, immersive sound space design, and interactive installation creation.
                        </p>

                        <h4>Current Academic Positions</h4>
                        <ul>
                            <li><strong>Accademia di Belle Arti di Macerata</strong> 
                                <br>Visual and multimedia communication
                                
                            </li>
                            <li><strong>Accademia di Belle Arti di Catania</strong> 
                                <br>Interaction Design
                            </li>
                        </ul>

                        

                        <h4>Research and Publications</h4>
                        <p>
                            <strong>Essay: "Air Piece: From Ecoacoustics of the Soundscape to Sound Fantasy of Musical Theatre"</strong><br>
                            ISBN: 9780244560393 (2020)<br>
                            In-depth musicological analysis of John Heineman's work<br>
                            Recognition: Fondazione Isabella Scelsi, Rome
                        </p>

                        <h4>Current Project</h4>
                        <p>
                            <strong>Very Beautiful</strong> - Interactive Audiovisual Installation<br>
                            Digital reinterpretation of Heineman's work developed in Max/MSP/Jitter<br>
                            Integrated system of spectral analysis, Markov chains, and computer vision
                        </p>

                        <div class="info-box" style="margin-top: 1rem; background: linear-gradient(135deg, rgba(72, 219, 251, 0.1), rgba(254, 202, 87, 0.1));">
                            <strong>🎨 Concept, Development & Implementation</strong>
                            <p>
                                Francesco Mariano is the creator of the Very Beautiful interactive application: 
                                from conceptualization and musicological research to Max/MSP/Jitter programming, 
                                web development, and complete system design. The project synthesizes over 15 years 
                                of experience in sound art, interactive installations, and multimedia teaching.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Historical Timeline -->
            <div class="card">
                <h2>📅 Historical Timeline</h2>
                <div class="timeline">
                    <div class="timeline-item">
                        <div class="timeline-year">1939</div>
                        <div class="timeline-content">
                            <strong>Birth of John Heineman</strong>
                            <p>New York, United States. Beginning of musical studies with particular interest in jazz improvisation.</p>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-year">1962</div>
                        <div class="timeline-content">
                            <strong>Move to Italy</strong>
                            <p>Heineman moves to Rome seeking a less academic and more experimental compositional environment.</p>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-year">1964</div>
                        <div class="timeline-content">
                            <strong>Foundation of GINC</strong>
                            <p>Gruppo di Improvvisazione Nuova Consonanza with Morricone, Evangelisti, and Bertoncini. Beginning of European concert activity.</p>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-year">1970</div>
                        <div class="timeline-content">
                            <strong>Air Piece</strong>
                            <p>Creation of electroacoustic work based on Fiumicino airport soundscape. First performance in Rome on February 15, 1970.</p>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-year">1973</div>
                        <div class="timeline-content">
                            <strong>Very Beautiful (original version)</strong>
                            <p>Composition of the conceptual work that would become the basis for the 2024 interactive project.</p>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-year">2020</div>
                        <div class="timeline-content">
                            <strong>Musicological Essay Publication</strong>
                            <p>Francesco Mariano publishes "Air Piece: From Ecoacoustics of the Soundscape to Sound Fantasy of Musical Theatre" (ISBN 9780244560393).</p>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-year">2024-25</div>
                        <div class="timeline-content">
                            <strong>Very Beautiful - Interactive Installation</strong>
                            <p>Francesco Mariano develops complete digital reinterpretation in Max/MSP with audio analysis, Markov chains, and computer vision system.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Archives & Resources -->
            <div class="card">
                <h2>📚 Archives and Resources</h2>
                
                <h3>Fondazione Isabella Scelsi</h3>
                <p>
                    The John Heineman archive is preserved at the Fondazione Isabella Scelsi in Rome (Fondo 7). The foundation is dedicated to contemporary musicological research and preservation of Italian experimental music heritage.
                </p>
                <div class="info-box" style="margin: 1rem 0;">
                    <strong>Archive Information</strong>
                    <p>
                        Type: Fondo<br>
                        Definitive numbering: No. 7<br>
                        Consistency: 6 folders<br>
                        Content: Correspondence, press reviews, concert programs, unpublished scores, tapes, digital documents (pdf, audio, video)
                    </p>
                </div>

                <h3>Scientific Publications</h3>
                <div class="info-grid">
                    <div class="info-box">
                        <strong>Air Piece (2020)</strong>
                        <p>
                            Musicological essay by Francesco Mariano<br>
                            ISBN: 9780244560393<br>
                            In-depth analysis of Heineman's work focusing on ecoacoustics and musical theatre
                        </p>
                    </div>
                    <div class="info-box">
                        <strong>Very Beautiful Documentation</strong>
                        <p>
                            Technical sheets, Max/MSP patch screenshots, spectral analysis, annotated timelines available in Media and Technical sections
                        </p>
                    </div>
                </div>

               
            </div>
        </section>

        <!-- TECHNICAL SECTION -->
        <section id="tech" class="section">
            <div class="card">
                <div style="background: rgba(255, 107, 107, 0.1); border: 2px solid rgba(255, 107, 107, 0.3); border-radius: 10px; padding: 1.5rem; margin-bottom: 2rem;">
                    <h3 style="color: var(--accent-red); margin: 0 0 1rem 0;">Developer & Researcher Section</h3>
                    <p style="margin: 0; color: var(--text-secondary);">
                        This section contains <strong>technical documentation</strong> for developers, musicians, and researchers interested in understanding or replicating the Max/MSP implementation. 
                        If you're just exploring the interactive experience, you can skip this section and focus on the <strong>Laboratory</strong> page for hands-on experimentation.
                    </p>
                </div>

                <h2>🛠️ Technical Architecture</h2>
                <p>Implementation details of the Max/MSP/Jitter system and modular software architecture.</p>

                <h3>Technology Stack</h3>
                <div class="info-grid">
                    <div class="info-box">
                        <strong>Max/MSP 8.0+</strong>
                        <p>Main development environment for real-time audio/video processing and visual programming</p>
                    </div>
                    <div class="info-box">
                        <strong>Jitter</strong>
                        <p>Library for video processing, 3D graphics, and computer vision integrated in Max</p>
                    </div>
                    <div class="info-box">
                        <strong>ZSA Libraries</strong>
                        <p>Toolkit for advanced spectral analysis (bark scale, MEL frequency, descriptors)</p>
                    </div>
                    <div class="info-box">
                        <strong>BACH</strong>
                        <p>Library for musical notation and complex data structures</p>
                    </div>
                </div>

                <h3>Core System Modules</h3>
                
                <h4>1. Spectral Audio Analysis</h4>
                <div style="background: rgba(0, 0, 0, 0.3); padding: 1.5rem; border-radius: 10px; margin: 1rem 0;">
                    <code style="color: var(--accent-yellow);">
                        [sfplay~] → [pfft~] → [zsa.abs_bark_mel~ 1024 4]<br>
                        &nbsp;&nbsp;↓<br>
                        [spectral mapping] → [color modulation] → [jit.gl.videoplane]
                    </code>
                </div>
                <p>
                    The audio signal is analyzed through <strong>pfft~</strong> (Fast Fourier Transform) and processed by <strong>zsa.abs_bark_mel~</strong> to obtain a perceptually relevant representation of the spectrum (Bark scale). Spectral data controls visual parameters in real-time.
                </p>

                <h4>2. Computer Vision and Luminance Analysis</h4>
                <div style="background: rgba(0, 0, 0, 0.3); padding: 1.5rem; border-radius: 10px; margin: 1rem 0;">
                    <code style="color: var(--accent-blue);">
                        [jit.grab] → [jit.rgb2luma] → [cv.jit.opticalflow]<br>
                        &nbsp;&nbsp;↓<br>
                        [luminance analysis] → [audio-driven modulation] → [visual output]
                    </code>
                </div>
                <p>
                    Webcam captures video through <strong>jit.grab</strong>. Image is converted to luminance with <strong>jit.rgb2luma</strong>, then analyzed for movement via <strong>cv.jit.opticalflow</strong>. Audio signal intensity modulates analysis sensitivity, creating audio-visual coupling.
                </p>

                <h4>3. Text Generation - Markov Chains</h4>
                <div style="background: rgba(0, 0, 0, 0.3); padding: 1.5rem; border-radius: 10px; margin: 1rem 0;">
                    <code style="color: var(--accent-red);">
                        [text corpus] → [markov_chain_3rd_order]<br>
                        &nbsp;&nbsp;↓<br>
                        [trigram analysis] → [probabilistic generation] → [jit.gl.text]
                    </code>
                </div>
                <p>
                    <strong>3rd-order Markov chain</strong> algorithm (trigrams) that analyzes original text corpus and generates new sequences maintaining stylistic coherence. Generated words are rendered with <strong>jit.gl.text</strong> with visual attributes (font, size, position, color) controlled by audio analysis.
                </p>

                <h4>4. Dynamic Generative Score</h4>
                <div style="background: rgba(0, 0, 0, 0.3); padding: 1.5rem; border-radius: 10px; margin: 1rem 0;">
                    <code style="color: var(--accent-yellow);">
                        [performance analysis] → [instruction database]<br>
                        &nbsp;&nbsp;↓<br>
                        [trigger system] → [dynamic score display] → [performer feedback]
                    </code>
                </div>
                <p>
                    System that generates real-time performance instructions based on performance analysis. Multiple implementations: predefined score (from <strong>text/coll</strong>), Markov-generated (algorithmically processed instructions), or completely aleatory (weighted random selection).
                </p>

                <h3>Modular Architecture</h3>
                <p>
                    The system is designed with modular architecture allowing easy reconfiguration:
                </p>
                <ul style="margin: 1rem 0; padding-left: 1.5rem; color: var(--text-secondary);">
                    <li>Independent modules for audio, video analysis and text generation</li>
                    <li>Standardized interfaces between modules (OSC messages)</li>
                    <li>Mappable and configurable parameters via GUI</li>
                    <li>Possibility of source substitution (live microphone, audio file, MIDI input)</li>
                    <li>Adaptability to different performative and instrumental setups</li>
                </ul>

                <h3>System Requirements</h3>
                <div class="info-grid">
                    <div class="info-box">
                        <strong>Hardware</strong>
                        <p>
                            • Computer with Max/MSP 8.0+<br>
                            • HD Webcam (720p+)<br>
                            • Professional audio interface<br>
                            • HD projector or high-resolution monitor<br>
                            • Stereo/multichannel audio diffusion system
                        </p>
                    </div>
                    <div class="info-box">
                        <strong>Software</strong>
                        <p>
                            • Max/MSP 8.0 or higher<br>
                            • Libraries: ZSA, BACH<br>
                            • OpenCV for computer vision<br>
                            • ASIO/CoreAudio audio drivers<br>
                            • OS: macOS 10.14+ or Windows 10+
                        </p>
                    </div>
                </div>

                <h3>Future Developments</h3>
                <ul style="margin: 1rem 0; padding-left: 1.5rem; color: var(--text-secondary);">
                    <li><strong>Machine Learning:</strong> Integration of neural networks for autonomous algorithmic evolution</li>
                    <li><strong>Advanced Gestural Analysis:</strong> Computer vision with posture and 3D movement recognition</li>
                    <li><strong>OSC Control:</strong> Integration with external devices (tablets, IMU sensors, MIDI controllers)</li>
                    <li><strong>VR/AR:</strong> Versions for virtual and augmented reality for total immersion</li>
                    <li><strong>Multi-Ensemble Versions:</strong> Adaptations for variable formations and different instruments</li>
                    <li><strong>Site-Specific Installations:</strong> Variants for particular architectural environments</li>
                </ul>
            </div>

            <div class="card">
                <h2>📊 Flow Diagram</h2>
                <div style="background: rgba(0, 0, 0, 0.5); padding: 2rem; border-radius: 15px; font-family: monospace; overflow-x: auto;">
                    <pre style="color: var(--text-primary); margin: 0; line-height: 1.8;">
┌───────────────────────────────────────────────────────────┐
│                    VERY BEAUTIFUL SYSTEM                        │
│                   Interactive Architecture                      │
└───────────────────────────────────────────────────────────┘

┌──────────────────     ┌──────────────────     ┌──────────────────
│   AUDIO INPUT    │     │   VIDEO INPUT    │     │   TEXT CORPUS    │
│   (sfplay~/adc~) │     │   (jit.grab)     │     │   (text/coll)    │
└────────┬─────────┘     └────────┬─────────┘     └────────┬─────────┘
         │                        │                         │
         ▼                        ▼                         ▼
┌──────────────────     ┌──────────────────     ┌──────────────────
│  SPECTRAL        │     │  LUMINANCE       │     │  MARKOV CHAIN    │
│  ANALYSIS        │     │  ANALYSIS        │     │  ORDER 3         │
│  (pfft~+bark)    │     │  (rgb2luma)      │     │  (trigramms)     │
└────────┬─────────┘     └────────┬─────────┘     └────────┬─────────┘
         │                        │                         │
         │    ┌───────────────────┼─────────────────────────┤
         │    │                   │                     │   │
         ▼    ▼                   ▼                     ▼   ▼
    ┌─────────────────    ┌─────────────────    ┌─────────────────
    │  COLOR          │    │  VISIBILITY     │    │  TEXT           │
    │  MODULATION     │    │  MODULATION     │    │  GENERATION     │
    │  (RGB mapping)  │    │  (alpha blend)  │    │  (probabilistic)│
    └────────┬────────┘    └────────┬────────┘    └────────┬────────┘
             │                      │                       │
             └──────────────────────┼───────────────────────┘
                                    │
                                    ▼
                          ┌──────────────────
                          │  jit.gl.render   │
                          │  OUTPUT WINDOW   │
                          └──────────────────┘
                                    │
                                    ▼
                          ┌──────────────────
                          │  PROJECTOR /     │
                          │  DISPLAY         │
                          └──────────────────┘

┌───────────────────────────────────────────────────────────┐
│  FEEDBACK LOOP: Audio energy → Visual modulation → Performer   │
│                 Performer gesture → Luminance → Text generation │
└───────────────────────────────────────────────────────────┘
                    </pre>
                </div>
            </div>
        </section>
    </div>

    <!-- Footer -->
    <footer>
        <p>
            <strong>Very Beautiful</strong> - Interactive Audiovisual Experience<br>
            John Heineman • Francesco Mariano <br>
            Developed with Max/MSP • Markov Chains • Computer Vision<br><br>
            © 2024-2025 - Fondazione Isabella Scelsi Archive (Fondo 7)<br>
            <em style="font-size: 0.85rem;">Educational and artistic purposes</em>
        </p>
    </footer>

    <!-- Image Modal -->
    <!-- FOOTER WITH SOCIAL AND DONATION BUTTONS -->
    <footer style="background: linear-gradient(135deg, var(--darker-bg) 0%, var(--dark-bg) 100%); padding: 3rem 1rem; margin-top: 4rem; border-top: 2px solid var(--border-color);">
        <div style="max-width: 1200px; margin: 0 auto; text-align: center;">
            <h3 style="color: var(--text-primary); margin-bottom: 1.5rem; font-size: 1.5rem;">Share this project</h3>

            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; margin-bottom: 2rem;">
                <!-- WhatsApp Share Button -->
                <a href="https://wa.me/?text=Discover%20Very%20Beautiful%20-%20An%20interactive%20audiovisual%20experience%20by%20John%20Heineman%20and%20Francesco%20Mariano%20https://francmo.github.io/very-beautiful-pwa/"
                   target="_blank"
                   rel="noopener noreferrer"
                   style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.8rem 1.5rem; background: #25D366; color: white; text-decoration: none; border-radius: 8px; font-weight: bold; transition: transform 0.2s, box-shadow 0.2s; box-shadow: 0 4px 12px rgba(37, 211, 102, 0.3);"
                   onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(37, 211, 102, 0.4)';"
                   onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(37, 211, 102, 0.3)';">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                        <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
                    </svg>
                    WhatsApp
                </a>

                <!-- Facebook Share Button -->
                <a href="https://www.facebook.com/sharer/sharer.php?u=https://francmo.github.io/very-beautiful-pwa/"
                   target="_blank"
                   rel="noopener noreferrer"
                   style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.8rem 1.5rem; background: #1877F2; color: white; text-decoration: none; border-radius: 8px; font-weight: bold; transition: transform 0.2s, box-shadow 0.2s; box-shadow: 0 4px 12px rgba(24, 119, 242, 0.3);"
                   onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(24, 119, 242, 0.4)';"
                   onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(24, 119, 242, 0.3)';">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                        <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                    </svg>
                    Facebook
                </a>
            </div>

            <!-- PayPal Donation Button -->
            <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--border-color);">
                <h4 style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 1.1rem;">Support this project</h4>
                <form action="https://www.paypal.com/donate" method="post" target="_blank" style="display: inline-block;">
                    <input type="hidden" name="business" value="francescomariano@gmail.com" />
                    <input type="hidden" name="no_recurring" value="0" />
                    <input type="hidden" name="item_name" value="Support for Very Beautiful project - Francesco Mariano" />
                    <input type="hidden" name="currency_code" value="EUR" />
                    <button type="submit"
                            style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.8rem 1.5rem; background: #0070BA; color: white; border: none; border-radius: 8px; font-weight: bold; font-size: 1rem; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; box-shadow: 0 4px 12px rgba(0, 112, 186, 0.3);"
                            onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(0, 112, 186, 0.4)';"
                            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0, 112, 186, 0.3)';">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                            <path d="M7.076 21.337H2.47a.641.641 0 0 1-.633-.74L4.944.901C5.026.382 5.474 0 5.998 0h7.46c2.57 0 4.578.543 5.69 1.81 1.01 1.15 1.304 2.42 1.012 4.287-.023.143-.047.288-.077.437-.983 5.05-4.349 6.797-8.647 6.797h-2.19c-.524 0-.968.382-1.05.9l-1.12 7.106zm14.146-14.42a3.35 3.35 0 0 0-.607-.541c-.013.076-.026.175-.041.254-.93 4.778-4.005 7.201-9.138 7.201h-2.19a.563.563 0 0 0-.556.479l-1.187 7.527h-.506L9.28 14.31h2.19c5.21 0 9.139-2.118 10.452-8.393z"/>
                        </svg>
                        Donate with PayPal
                    </button>
                </form>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 1rem;">Your contribution helps support research and development of artistic and musicological projects.</p>
            </div>

            <!-- Credits -->
            <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--border-color); color: var(--text-secondary); font-size: 0.9rem;">
                <p>Very Beautiful © 2024 - Francesco Mariano</p>
                <p>Opera originale: John Heineman (1973)</p>
            </div>
        </div>
    </footer>

    <div id="imageModal" class="modal">
        <span class="modal-close" id="modalClose">&times;</span>
        <img class="modal-content" id="modalImage">
    </div>

    <script>
        // ===== FIX iOS: Debounce per evitare double-firing degli eventi =====
        let lastEventTime = 0;
        const DEBOUNCE_DELAY = 500;
        
        function debounce(callback, delay = DEBOUNCE_DELAY) {
            return function(...args) {
                const now = Date.now();
                if (now - lastEventTime < delay) {
                    console.log('⏭️ Skipping duplicate event (iOS fix)');
                    return;
                }
                lastEventTime = now;
                callback.apply(this, args);
            };
        }

        // ===== SENSITIVITY PRESETS CONFIGURATION =====
        const SENSITIVITY_PRESETS = {
            dark: {
                name: 'Dark Room',
                motionThreshold: 45,           // Molto sensibile
                dilationRadius: 12,            // Area espansa
                brightnessBoost: 5.5,          // Aumento luminosità
                contrastBoost: 1.5,            // Aumento contrasto
                minMotionPercent: 1.2          // Soglia bassa per attivazione
            },
            normal: {
                name: 'Normal',
                motionThreshold: 80,           // Sensibilità media
                dilationRadius: 8,             // Area normale
                brightnessBoost: 1.0,          // Nessun boost
                contrastBoost: 1.0,            // Nessun boost
                minMotionPercent: 2.0          // Soglia normale
            },
            bright: {
                name: 'Bright Light',
                motionThreshold: 120,          // Meno sensibile
                dilationRadius: 6,             // Area ridotta
                brightnessBoost: 0.75,         // Riduzione luminosità
                contrastBoost: 1.2,            // Leggero aumento contrasto
                minMotionPercent: 3.5          // Soglia più alta
            }
        };

        let currentPreset = SENSITIVITY_PRESETS.normal;

        // ===== NAVIGATION SYSTEM - iOS OPTIMIZED =====
        const navBtns = document.querySelectorAll('.nav-btn');
        const sections = document.querySelectorAll('.section');
        const logoBtn = document.getElementById('logoBtn');

        function showSection(sectionId, scrollToElement = null) {
            console.log('🔍 Navigating to:', sectionId);
            
            navBtns.forEach(btn => {
                btn.classList.remove('active');
            });
            
            sections.forEach(section => {
                section.classList.remove('active');
            });
            
            const activeBtn = document.querySelector(`[data-section="${sectionId}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }
            
            const activeSection = document.getElementById(sectionId);
            if (activeSection) {
                activeSection.classList.add('active');
            }
            
            if (window.innerWidth <= 1024) {
                closeMenu();
            }
            
            setTimeout(() => {
                if (scrollToElement) {
                    const element = document.getElementById(scrollToElement);
                    if (element) {
                        element.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                } else {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            }, 100);
        }

        const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

        const handleNavClick = debounce(function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            const sectionId = this.dataset.section;
            if (sectionId) {
                showSection(sectionId);
            }
        });

        navBtns.forEach(btn => {
            if (isTouchDevice) {
                btn.addEventListener('touchend', handleNavClick, { passive: false });
            } else {
                btn.addEventListener('click', handleNavClick, { passive: false });
            }
        });

        if (logoBtn) {
            const logoHandler = debounce(function() {
                showSection('home');
            });
            
            if (isTouchDevice) {
                logoBtn.addEventListener('touchend', logoHandler, { passive: false });
            } else {
                logoBtn.addEventListener('click', logoHandler);
            }
        }

        // ===== FEATURE CARDS NAVIGATION =====
        const featureCards = document.querySelectorAll('.feature-card');
        
        featureCards.forEach(card => {
            const navigateHandler = debounce(function(e) {
                e.preventDefault();
                const target = this.dataset.navigate;
                
                if (target === 'audio') {
                    showSection('audio');
                } else if (target === 'lab-markov') {
                    showSection('lab', 'markovSection');
                } else if (target === 'lab-motion') {
                    showSection('lab', 'motionSection');
                } else if (target === 'opera') {
                    showSection('opera');
                }
            });
            
            if (isTouchDevice) {
                card.addEventListener('touchend', navigateHandler, { passive: false });
            } else {
                card.addEventListener('click', navigateHandler);
            }
        });

        // ===== CLICKABLE INFO BOXES NAVIGATION (includes interactive-system-box) =====
        const clickableBoxes = document.querySelectorAll('.clickable-box, .interactive-system-box');

        clickableBoxes.forEach(box => {
            const boxNavigateHandler = debounce(function(e) {
                e.preventDefault();
                const target = this.dataset.navigate;
                
                if (target === 'audio') {
                    showSection('audio');
                } else if (target === 'lab-markov') {
                    showSection('lab', 'markovSection');
                } else if (target === 'lab-motion') {
                    showSection('lab', 'motionSection');
                } else if (target) {
                    showSection(target);
                }
            });
            
            if (isTouchDevice) {
                box.addEventListener('touchend', boxNavigateHandler, { passive: false });
            } else {
                box.addEventListener('click', boxNavigateHandler);
            }
        });

        // ===== MENU HAMBURGER FUNCTIONALITY =====
        const menuToggle = document.getElementById('menuToggle');
        const navLinks = document.getElementById('navLinks');
        const menuOverlay = document.getElementById('menuOverlay');
        const menuIcon = document.getElementById('menuIcon');

        function openMenu() {
            navLinks.classList.add('active');
            menuOverlay.classList.add('active');
            menuToggle.classList.add('active');
            menuIcon.textContent = '✕';
            document.body.style.overflow = 'hidden';
        }

        function closeMenu() {
            navLinks.classList.remove('active');
            menuOverlay.classList.remove('active');
            menuToggle.classList.remove('active');
            menuIcon.textContent = '☰';
            document.body.style.overflow = '';
        }

        function toggleMenu() {
            if (navLinks.classList.contains('active')) {
                closeMenu();
            } else {
                openMenu();
            }
        }

        const menuToggleHandler = debounce(toggleMenu);
        
        if (isTouchDevice) {
            menuToggle.addEventListener('touchend', function(e) {
                e.preventDefault();
                menuToggleHandler();
            }, { passive: false });
        } else {
            menuToggle.addEventListener('click', menuToggleHandler);
        }
        
        const overlayHandler = debounce(closeMenu);
        
        if (isTouchDevice) {
            menuOverlay.addEventListener('touchend', function(e) {
                e.preventDefault();
                overlayHandler();
            }, { passive: false });
        } else {
            menuOverlay.addEventListener('click', overlayHandler);
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && navLinks.classList.contains('active')) {
                closeMenu();
            }
        });

        window.addEventListener('resize', () => {
            if (window.innerWidth > 1024) {
                closeMenu();
            }
        });

        // ===== SENSITIVITY PRESET BUTTONS =====
        const presetDarkBtn = document.getElementById('presetDark');
        const presetNormalBtn = document.getElementById('presetNormal');
        const presetBrightBtn = document.getElementById('presetBright');

        function setPreset(presetType) {
            currentPreset = SENSITIVITY_PRESETS[presetType];
            
            // Aggiorna UI
            presetDarkBtn.classList.remove('active');
            presetNormalBtn.classList.remove('active');
            presetBrightBtn.classList.remove('active');
            
            if (presetType === 'dark') {
                presetDarkBtn.classList.add('active');
            } else if (presetType === 'normal') {
                presetNormalBtn.classList.add('active');
            } else if (presetType === 'bright') {
                presetBrightBtn.classList.add('active');
            }
            
            console.log('🌙 Preset changed to:', currentPreset.name);
            console.log('  - Motion Threshold:', currentPreset.motionThreshold);
            console.log('  - Dilation Radius:', currentPreset.dilationRadius);
            console.log('  - Brightness Boost:', currentPreset.brightnessBoost);
        }

        presetDarkBtn.addEventListener('click', () => setPreset('dark'));
        presetNormalBtn.addEventListener('click', () => setPreset('normal'));
        presetBrightBtn.addEventListener('click', () => setPreset('bright'));

        // ===== LIVE SPECTROGRAM =====
        const timelineAudio = document.getElementById('timelineAudio');
        const spectrogramCanvas = document.getElementById('spectrogramCanvas');
        const spectrogramContainer = document.getElementById('spectrogramContainer');
        const playTimelineBtn = document.getElementById('playTimelineBtn');
        const resetTimelineBtn = document.getElementById('resetTimelineBtn');
        const timelineStatus = document.getElementById('timelineStatus');
        const eventBoxes = document.querySelectorAll('.event-box');

        const peakFreqDisplay = document.getElementById('peakFreq');
        const centroidFreqDisplay = document.getElementById('centroidFreq');
        const rmsAmplitudeDisplay = document.getElementById('rmsAmplitude');

        let audioContext;
        let analyser;
        let dataArray;
        let bufferLength;
        let canvasCtx;
        let animationId;
        let spectrogramHistory = [];
        const MAX_HISTORY_COLUMNS = 1000;

        function initAudioAnalyser() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                
                const source = audioContext.createMediaElementSource(timelineAudio);
                source.connect(analyser);
                analyser.connect(audioContext.destination);
                
                analyser.fftSize = 4096;
                analyser.smoothingTimeConstant = 0.8;
                bufferLength = analyser.frequencyBinCount;
                dataArray = new Uint8Array(bufferLength);
                
                canvasCtx = spectrogramCanvas.getContext('2d');
                spectrogramCanvas.width = spectrogramContainer.offsetWidth;
                spectrogramCanvas.height = spectrogramContainer.offsetHeight;
            }
        }

        function getPeakFrequency(dataArray) {
            let maxValue = -Infinity;
            let maxIndex = 0;
            
            for (let i = 0; i < dataArray.length; i++) {
                if (dataArray[i] > maxValue) {
                    maxValue = dataArray[i];
                    maxIndex = i;
                }
            }
            
            const nyquist = audioContext.sampleRate / 2;
            const frequency = (maxIndex * nyquist) / dataArray.length;
            return Math.round(frequency);
        }

        function getSpectralCentroid(dataArray) {
            let numerator = 0;
            let denominator = 0;
            
            const nyquist = audioContext.sampleRate / 2;
            
            for (let i = 0; i < dataArray.length; i++) {
                const frequency = (i * nyquist) / dataArray.length;
                const magnitude = dataArray[i];
                numerator += frequency * magnitude;
                denominator += magnitude;
            }
            
            return denominator > 0 ? Math.round(numerator / denominator) : 0;
        }

        function getRMS(dataArray) {
            let sum = 0;
            for (let i = 0; i < dataArray.length; i++) {
                sum += (dataArray[i] / 255) * (dataArray[i] / 255);
            }
            const rms = Math.sqrt(sum / dataArray.length);
            const db = 20 * Math.log10(rms + 0.0001);
            return Math.round(db);
        }

        // ===== IMPROVED COLOR MAPPING =====
        // Perceptually uniform color gradient: Black -> Blue -> Cyan -> Green -> Yellow -> Orange -> Red -> White
        function getSpectrogramColor(value) {
            // Apply dynamic range compression for better visibility of quieter frequencies
            const compressed = Math.pow(value / 255, 0.5); // Gamma correction for better perception
            const percent = compressed;

            let r, g, b;

            if (percent < 0.15) {
                // Black to dark blue
                const t = percent / 0.15;
                r = 0;
                g = 0;
                b = Math.floor(t * 80);
            } else if (percent < 0.3) {
                // Dark blue to cyan
                const t = (percent - 0.15) / 0.15;
                r = 0;
                g = Math.floor(t * 150);
                b = 80 + Math.floor(t * 175);
            } else if (percent < 0.45) {
                // Cyan to green
                const t = (percent - 0.3) / 0.15;
                r = 0;
                g = 150 + Math.floor(t * 105);
                b = 255 - Math.floor(t * 155);
            } else if (percent < 0.6) {
                // Green to yellow
                const t = (percent - 0.45) / 0.15;
                r = Math.floor(t * 255);
                g = 255;
                b = 100 - Math.floor(t * 100);
            } else if (percent < 0.75) {
                // Yellow to orange
                const t = (percent - 0.6) / 0.15;
                r = 255;
                g = 255 - Math.floor(t * 100);
                b = 0;
            } else if (percent < 0.9) {
                // Orange to red
                const t = (percent - 0.75) / 0.15;
                r = 255;
                g = 155 - Math.floor(t * 155);
                b = 0;
            } else {
                // Red to white (peaks)
                const t = (percent - 0.9) / 0.1;
                r = 255;
                g = Math.floor(t * 255);
                b = Math.floor(t * 255);
            }

            return `rgb(${r}, ${g}, ${b})`;
        }

        // ===== LOGARITHMIC FREQUENCY MAPPING =====
        // Maps linear frequency bins to logarithmic Y positions for better perception
        function getLogY(binIndex, canvasHeight) {
            const nyquist = audioContext.sampleRate / 2;
            const freq = (binIndex * nyquist) / bufferLength;

            // Logarithmic mapping: 20 Hz to Nyquist
            const minFreq = 20;
            const maxFreq = nyquist;

            if (freq < minFreq) return canvasHeight;

            const logMin = Math.log10(minFreq);
            const logMax = Math.log10(maxFreq);
            const logFreq = Math.log10(freq);

            const normalized = (logFreq - logMin) / (logMax - logMin);
            return canvasHeight - (normalized * canvasHeight);
        }

        // ===== FREQUENCY LABELS =====
        function drawFrequencyLabels() {
            const labelFreqs = [50, 100, 200, 500, 1000, 2000, 5000, 10000, 20000];
            const nyquist = audioContext.sampleRate / 2;

            canvasCtx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            canvasCtx.font = '11px monospace';
            canvasCtx.textAlign = 'right';
            canvasCtx.textBaseline = 'middle';

            labelFreqs.forEach(freq => {
                if (freq > nyquist) return;

                const binIndex = (freq / nyquist) * bufferLength;
                const y = getLogY(binIndex, spectrogramCanvas.height);

                // Draw label
                const label = freq >= 1000 ? `${freq/1000}k` : `${freq}`;
                canvasCtx.fillText(label, spectrogramCanvas.width - 5, y);

                // Draw grid line
                canvasCtx.strokeStyle = 'rgba(255, 255, 255, 0.08)';
                canvasCtx.lineWidth = 1;
                canvasCtx.beginPath();
                canvasCtx.moveTo(0, y);
                canvasCtx.lineTo(spectrogramCanvas.width - 40, y);
                canvasCtx.stroke();
            });
        }

        function drawLiveSpectrogram() {
            if (!timelineAudio || timelineAudio.paused) {
                return;
            }

            animationId = requestAnimationFrame(drawLiveSpectrogram);

            analyser.getByteFrequencyData(dataArray);

            const peakFreq = getPeakFrequency(dataArray);
            const centroidFreq = getSpectralCentroid(dataArray);
            const rmsDb = getRMS(dataArray);

            peakFreqDisplay.textContent = peakFreq + ' Hz';
            centroidFreqDisplay.textContent = centroidFreq + ' Hz';
            rmsAmplitudeDisplay.textContent = rmsDb + ' dB';

            const currentColumn = Array.from(dataArray);
            spectrogramHistory.push(currentColumn);

            if (spectrogramHistory.length > MAX_HISTORY_COLUMNS) {
                spectrogramHistory.shift();
            }

            // Clear canvas with black background
            canvasCtx.fillStyle = '#000';
            canvasCtx.fillRect(0, 0, spectrogramCanvas.width, spectrogramCanvas.height);

            const columnWidth = spectrogramCanvas.width / Math.min(spectrogramHistory.length, MAX_HISTORY_COLUMNS);

            // Draw spectrogram with logarithmic frequency scale
            for (let col = 0; col < spectrogramHistory.length; col++) {
                const column = spectrogramHistory[col];
                const x = col * columnWidth;

                // Draw each frequency bin with logarithmic Y mapping
                for (let i = 0; i < bufferLength - 1; i++) {
                    const value = column[i] || 0;
                    const nextValue = column[i + 1] || 0;

                    const y1 = getLogY(i, spectrogramCanvas.height);
                    const y2 = getLogY(i + 1, spectrogramCanvas.height);
                    const height = Math.abs(y1 - y2);

                    // Use improved color mapping
                    canvasCtx.fillStyle = getSpectrogramColor(value);
                    canvasCtx.fillRect(x, y2, columnWidth + 0.5, height + 0.5);
                }
            }

            // Draw frequency labels and grid
            drawFrequencyLabels();

            updateTimeDisplay();
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function updateTimeDisplay() {
            if (timelineAudio) {
                const currentTime = timelineAudio.currentTime;
                const duration = timelineAudio.duration || 680;
                timelineStatus.textContent = `${formatTime(currentTime)} / ${formatTime(duration)}`;
            }
        }

        if (playTimelineBtn) {
            playTimelineBtn.addEventListener('click', async () => {
                if (!timelineAudio) return;
                
                if (!audioContext) {
                    initAudioAnalyser();
                }

                if (audioContext.state === 'suspended') {
                    await audioContext.resume();
                }
                
                if (timelineAudio.paused) {
                    timelineAudio.play();
                    playTimelineBtn.innerHTML = '⏸ Pause';
                    drawLiveSpectrogram();
                } else {
                    timelineAudio.pause();
                    playTimelineBtn.innerHTML = '▶ Play';
                    if (animationId) {
                        cancelAnimationFrame(animationId);
                    }
                }
            });
        }

        if (resetTimelineBtn) {
            resetTimelineBtn.addEventListener('click', () => {
                if (timelineAudio) {
                    timelineAudio.pause();
                    timelineAudio.currentTime = 0;
                    playTimelineBtn.innerHTML = '▶ Play';
                    timelineStatus.textContent = '00:00 / 11:20';
                    spectrogramHistory = [];
                    
                    peakFreqDisplay.textContent = '-- Hz';
                    centroidFreqDisplay.textContent = '-- Hz';
                    rmsAmplitudeDisplay.textContent = '-- dB';
                    
                    if (canvasCtx) {
                        canvasCtx.fillStyle = '#000';
                        canvasCtx.fillRect(0, 0, spectrogramCanvas.width, spectrogramCanvas.height);
                    }
                    
                    if (animationId) {
                        cancelAnimationFrame(animationId);
                    }
                }
            });
        }

        // ===== INTERACTIVE TOOLTIP =====
        const spectrogramTooltip = document.getElementById('spectrogramTooltip');

        if (spectrogramContainer) {
            // Click handler for navigation
            spectrogramContainer.addEventListener('click', async (e) => {
                if (!timelineAudio) return;

                if (!audioContext) {
                    initAudioAnalyser();
                }

                const rect = spectrogramContainer.getBoundingClientRect();
                const clickX = e.clientX - rect.left;
                const percentage = clickX / rect.width;

                const duration = timelineAudio.duration || 680;
                timelineAudio.currentTime = percentage * duration;

                spectrogramHistory = [];

                if (timelineAudio.paused) {
                    if (audioContext.state === 'suspended') {
                        await audioContext.resume();
                    }
                    timelineAudio.play();
                    playTimelineBtn.innerHTML = '⏸ Pause';
                    drawLiveSpectrogram();
                }
            });

            // Mousemove handler for tooltip
            spectrogramContainer.addEventListener('mousemove', (e) => {
                if (!spectrogramTooltip || !audioContext || !spectrogramHistory.length) return;

                const rect = spectrogramContainer.getBoundingClientRect();
                const mouseX = e.clientX - rect.left;
                const mouseY = e.clientY - rect.top;

                // Calculate time from X position
                const timePercentage = mouseX / rect.width;
                const duration = timelineAudio ? (timelineAudio.duration || 680) : 680;
                const time = timePercentage * duration;
                const mins = Math.floor(time / 60);
                const secs = Math.floor(time % 60);
                const timeStr = `${mins}:${secs.toString().padStart(2, '0')}`;

                // Calculate frequency from Y position (inverse of getLogY)
                const normalizedY = 1 - (mouseY / rect.height);
                const nyquist = audioContext.sampleRate / 2;
                const minFreq = 20;
                const logMin = Math.log10(minFreq);
                const logMax = Math.log10(nyquist);
                const logFreq = logMin + normalizedY * (logMax - logMin);
                const freq = Math.pow(10, logFreq);
                const freqStr = freq >= 1000 ? `${(freq/1000).toFixed(1)}k Hz` : `${Math.round(freq)} Hz`;

                // Get amplitude from current data
                let amplitudeStr = '--';
                if (spectrogramHistory.length > 0) {
                    const colIndex = Math.floor((mouseX / rect.width) * spectrogramHistory.length);
                    if (colIndex >= 0 && colIndex < spectrogramHistory.length) {
                        const column = spectrogramHistory[colIndex];
                        const binIndex = Math.floor((freq / nyquist) * bufferLength);
                        if (binIndex >= 0 && binIndex < column.length) {
                            const value = column[binIndex];
                            const db = -60 + (value / 255) * 60; // Approximate dB scale
                            amplitudeStr = `${db.toFixed(1)} dB`;
                        }
                    }
                }

                // Update tooltip content
                spectrogramTooltip.innerHTML = `
                    <div><strong>Time:</strong> ${timeStr}</div>
                    <div><strong>Freq:</strong> ${freqStr}</div>
                    <div><strong>Level:</strong> ${amplitudeStr}</div>
                `;

                // Position tooltip
                spectrogramTooltip.style.display = 'block';
                spectrogramTooltip.style.left = (mouseX + 15) + 'px';
                spectrogramTooltip.style.top = (mouseY + 15) + 'px';

                // Keep tooltip in bounds
                const tooltipRect = spectrogramTooltip.getBoundingClientRect();
                if (mouseX + tooltipRect.width + 15 > rect.width) {
                    spectrogramTooltip.style.left = (mouseX - tooltipRect.width - 15) + 'px';
                }
                if (mouseY + tooltipRect.height + 15 > rect.height) {
                    spectrogramTooltip.style.top = (mouseY - tooltipRect.height - 15) + 'px';
                }
            });

            // Hide tooltip on mouse leave
            spectrogramContainer.addEventListener('mouseleave', () => {
                if (spectrogramTooltip) {
                    spectrogramTooltip.style.display = 'none';
                }
            });
        }

        eventBoxes.forEach(box => {
            box.addEventListener('click', async () => {
                const time = parseInt(box.getAttribute('data-time'));
                if (timelineAudio) {
                    timelineAudio.currentTime = time;
                    
                    eventBoxes.forEach(b => b.style.background = '');
                    box.style.background = 'rgba(254, 202, 87, 0.2)';
                    
                    spectrogramHistory = [];
                    
                    if (timelineAudio.paused) {
                        if (!audioContext) {
                            initAudioAnalyser();
                        }
                        if (audioContext.state === 'suspended') {
                            await audioContext.resume();
                        }
                        timelineAudio.play();
                        playTimelineBtn.innerHTML = '⏸ Pause';
                        drawLiveSpectrogram();
                    }
                    
                    spectrogramContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            });
        });

        if (timelineAudio) {
            timelineAudio.addEventListener('ended', () => {
                playTimelineBtn.innerHTML = '↻ Replay';
                if (animationId) {
                    cancelAnimationFrame(animationId);
                }
            });
            
            timelineAudio.addEventListener('loadedmetadata', () => {
                const duration = timelineAudio.duration;
                timelineStatus.textContent = `00:00 / ${formatTime(duration)}`;
            });
        }

        window.addEventListener('resize', () => {
            if (spectrogramCanvas && spectrogramContainer) {
                spectrogramCanvas.width = spectrogramContainer.offsetWidth;
                spectrogramCanvas.height = spectrogramContainer.offsetHeight;
            }
        });

        // ===== MARKOV CHAIN GENERATOR =====
        // Professional Frequency-Based Markov Chain with Hierarchical Backoff
        class MarkovChain {
            constructor(maxOrder = 4) {
                this.maxOrder = maxOrder;
                this.currentOrder = maxOrder; // Default starting order for generation

                // Frequency-based chains: Map<order, Map<state, Map<nextWord, count>>>
                this.chains = new Map();

                // Unigrams for ultimate fallback (Order 0)
                this.unigrams = new Map();

                // Starting states stored as arrays of tokens
                this.startStates = [];

                this.punctuation = ['.', '!', '?'];
            }

            /**
             * Improved tokenization with better regex
             * Handles contractions (don't, it's) and punctuation
             */
            tokenize(text) {
                // Match words (including contractions) OR punctuation
                const tokens = text.match(/[\w']+|[.,!?;:]/g);
                return tokens || [];
            }

            /**
             * Collapse runs of identical consecutive tokens
             * Example: ["very", "very", "very"] -> ["very"]
             */
            collapseRuns(tokens, collapseProb = 0.7) {
                const result = [];
                let lastToken = null;

                for (const token of tokens) {
                    // If same as previous and random check passes, skip it
                    if (token === lastToken && Math.random() < collapseProb) {
                        continue;
                    }
                    result.push(token);
                    lastToken = token;
                }

                return result;
            }

            /**
             * Train all orders with advanced anti-fossilization strategies
             * Uses frequency counts, subsampling, and run collapsing
             */
            train(text) {
                let tokens = this.tokenize(text);

                if (tokens.length < this.maxOrder * 3) {
                    console.warn(`Warning: Text may be too short for order ${this.maxOrder}`);
                }

                // STRATEGY: Collapse repetitive runs to reduce fossilization
                tokens = this.collapseRuns(tokens, 0.7);

                // Reset all data structures
                this.chains.clear();
                this.unigrams.clear();
                this.startStates = [];

                // Calculate total for subsampling frequent tokens
                const totalTokens = tokens.length;

                // Build unigram frequencies with subsampling of very frequent tokens
                for (const token of tokens) {
                    const currentCount = this.unigrams.get(token) || 0;

                    // STRATEGY: Subsample very frequent tokens (reduce their dominance)
                    // Drop probability increases with frequency
                    const dropProb = Math.min(0.85, (currentCount / totalTokens) * 8);

                    if (Math.random() > dropProb) {
                        this.unigrams.set(token, currentCount + 1);
                    }
                }

                // Train all orders from 1 to maxOrder
                for (let order = 1; order <= this.maxOrder; order++) {
                    // Initialize chain for this order
                    if (!this.chains.has(order)) {
                        this.chains.set(order, new Map());
                    }
                    const chain = this.chains.get(order);

                    for (let i = 0; i < tokens.length - order; i++) {
                        // State is an array of tokens
                        const stateArray = tokens.slice(i, i + order);
                        const stateKey = stateArray.join(' ').toLowerCase();
                        const next = tokens[i + order];

                        // Get or create transitions map for this state
                        if (!chain.has(stateKey)) {
                            chain.set(stateKey, new Map());
                        }
                        const transitions = chain.get(stateKey);

                        // Get current count
                        const currentCount = transitions.get(next) || 0;

                        // STRATEGY: Limit count for immediate repetitions to reduce loops
                        if (stateArray[stateArray.length - 1] === next) {
                            // Cap repetition transitions
                            transitions.set(next, Math.min(2, currentCount + 1));
                        } else {
                            transitions.set(next, currentCount + 1);
                        }

                        // Track sentence-starting states (only for maxOrder)
                        if (order === this.maxOrder) {
                            if (i === 0 || this.punctuation.includes(tokens[i - 1])) {
                                this.startStates.push([...stateArray]); // Store as array
                            }
                        }
                    }
                }
            }

            /**
             * Weighted random selection based on frequency counts
             * @param {Map<string, number>} transitions - Map of word -> frequency
             * @param {number} temperature - Controls randomness (default 1.0)
             * @param {boolean} favorRare - If true, inverts distribution to favor rare words (for chaos)
             */
            weightedRandom(transitions, temperature = 1.0, favorRare = false) {
                if (transitions.size === 0) {
                    return null;
                }

                // Temperature = 0: return most probable word (or least if favorRare)
                if (temperature <= 0) {
                    let targetWord = '';
                    let targetCount = favorRare ? Infinity : 0;
                    for (const [word, count] of transitions.entries()) {
                        if (favorRare ? (count < targetCount) : (count > targetCount)) {
                            targetCount = count;
                            targetWord = word;
                        }
                    }
                    return targetWord;
                }

                // Apply temperature to weights
                const adjustedWeights = new Map();
                let total = 0;

                for (const [word, count] of transitions.entries()) {
                    // INVERTED DISTRIBUTION: favor rare words when favorRare=true
                    let adjustedWeight;
                    if (favorRare) {
                        // Higher temperature = more chaos, favor rarer words
                        adjustedWeight = Math.pow(1 / count, temperature);
                    } else {
                        // Normal distribution: higher temperature = flatten distribution
                        adjustedWeight = Math.pow(count, 1 / temperature);
                    }
                    adjustedWeights.set(word, adjustedWeight);
                    total += adjustedWeight;
                }

                // Weighted random selection
                let randomWeight = Math.random() * total;

                for (const [word, weight] of adjustedWeights.entries()) {
                    if (randomWeight < weight) {
                        return word;
                    }
                    randomWeight -= weight;
                }

                // Fallback (should rarely happen)
                return adjustedWeights.keys().next().value;
            }

            /**
             * Mutate a token to create glitch/experimental variants
             * Strategies: character deletion, duplication, case change, truncation
             */
            mutateToken(token) {
                if (typeof token !== 'string' || token.length === 0) return token;

                const mutation = Math.random();

                if (mutation < 0.25 && token.length > 2) {
                    // Delete random character
                    const pos = Math.floor(Math.random() * token.length);
                    return token.slice(0, pos) + token.slice(pos + 1);
                } else if (mutation < 0.5 && token.length > 1) {
                    // Duplicate random character
                    const pos = Math.floor(Math.random() * token.length);
                    return token.slice(0, pos + 1) + token[pos] + token.slice(pos + 1);
                } else if (mutation < 0.75) {
                    // Truncate
                    const newLen = Math.max(1, Math.floor(token.length * 0.6));
                    return token.slice(0, newLen);
                } else {
                    // Case scramble
                    return token.split('').map(c =>
                        Math.random() > 0.5 ? c.toUpperCase() : c.toLowerCase()
                    ).join('');
                }
            }

            /**
             * Subsample transitions to reduce dominance of frequent words
             */
            subsampleTransitions(transitions, subsampleRate = 0.3) {
                const reduced = new Map();
                const maxCount = Math.max(...transitions.values());

                for (const [word, count] of transitions.entries()) {
                    // Higher count words get dropped more often
                    const dropProb = Math.min(0.8, (count / maxCount) * subsampleRate);

                    if (Math.random() > dropProb) {
                        // Reduce count proportionally
                        const reducedCount = Math.max(1, Math.floor(count * (1 - dropProb * 0.5)));
                        reduced.set(word, reducedCount);
                    }
                }

                return reduced.size > 0 ? reduced : transitions;
            }

            /**
             * Hierarchical backoff: tries current order, falls back to lower orders
             * @param {Array<string>} stateArray - Current state as array of tokens
             * @param {number} order - Current order to try
             * @param {number} temperature - Creativity parameter
             * @param {boolean} favorRare - Favor rare words over common ones
             */
            getNext(stateArray, order, temperature = 1.0, favorRare = false) {
                // Base case: Order 0 (unigram fallback)
                if (order === 0) {
                    return this.weightedRandom(this.unigrams, temperature, favorRare);
                }

                // Ensure we have the right state length
                const relevantState = stateArray.slice(-order);
                const stateKey = relevantState.join(' ').toLowerCase();

                // Try to find transitions for this state
                const chain = this.chains.get(order);
                if (chain && chain.has(stateKey)) {
                    const transitions = chain.get(stateKey);
                    if (transitions.size > 0) {
                        return this.weightedRandom(transitions, temperature, favorRare);
                    }
                }

                // Backoff: try lower order
                return this.getNext(stateArray, order - 1, temperature, favorRare);
            }

            /**
             * Generate text with advanced entropy and mutation strategies
             * @param {number} length - Maximum number of words to generate
             * @param {number} startOrder - Order to start generation with (default: currentOrder)
             * @param {number} temperature - Creativity control (1.0 = normal, >1 = creative, <1 = conservative)
             */
            generate(length = 50, startOrder = null, temperature = 1.0) {
                if (this.startStates.length === 0) {
                    return "Please enter more text to generate variations. The algorithm needs at least a few complete sentences.";
                }

                // Use provided order or default to current order
                const baseOrder = startOrder !== null ? startOrder : this.currentOrder;

                // Adjust behavior based on order
                const maxLength = baseOrder === 1 ? 15 : (baseOrder === 2 ? 25 : length);
                const minLength = baseOrder === 1 ? 5 : 8;

                // Pick random starting state
                const startState = this.startStates[Math.floor(Math.random() * this.startStates.length)];
                let stateArray = [...startState];
                let result = [...startState];

                // Generate tokens with dynamic strategies
                for (let i = 0; i < maxLength - baseOrder; i++) {
                    let next;

                    // STRATEGY 1: Dynamic Order Switching (20% chance to change order mid-generation)
                    let dynamicOrder = baseOrder;
                    if (Math.random() < 0.2) {
                        dynamicOrder = Math.max(1, Math.floor(Math.random() * (this.maxOrder + 1)));
                    }

                    // ORDER 1: Maximum chaos with inverted distribution
                    if (baseOrder === 1) {
                        if (Math.random() > 0.3) {
                            // 70% use inverted distribution (favor rare words)
                            next = this.weightedRandom(this.unigrams, 2.5, true);
                        } else {
                            // 30% use bigram with high temp and favor rare
                            next = this.getNext(stateArray, 1, 2.5, true);
                        }
                    }
                    // ORDER 2: Moderate chaos with some structure
                    else if (baseOrder === 2) {
                        if (Math.random() > 0.2) {
                            // 80% use normal approach with high temp
                            next = this.getNext(stateArray, dynamicOrder, 1.5, false);
                        } else {
                            // 20% inject rare word
                            next = this.weightedRandom(this.unigrams, 2.0, true);
                        }
                    }
                    // ORDER 3-4: More structured but with occasional surprises
                    else {
                        if (Math.random() > 0.1) {
                            // 90% normal hierarchical generation
                            next = this.getNext(stateArray, dynamicOrder, temperature, false);
                        } else {
                            // 10% inject unexpected element
                            next = this.weightedRandom(this.unigrams, 1.8, true);
                        }
                    }

                    if (!next) break;

                    // ADVANCED STRATEGY: Token-level mutation (glitch effect)
                    if (baseOrder === 1 && Math.random() < 0.08) {
                        next = this.mutateToken(next);
                    }

                    result.push(next);

                    // STRATEGY 2: Structured Noise Injection (mutations)
                    if (baseOrder <= 2 && Math.random() < 0.15 && result.length > 3) {
                        const mutationType = Math.random();

                        if (mutationType < 0.33) {
                            // Omission: remove a word
                            result.splice(result.length - 2, 1);
                        } else if (mutationType < 0.66) {
                            // Duplication: repeat last word
                            result.push(result[result.length - 1]);
                        } else {
                            // Insertion: add random rare word
                            result.push(this.weightedRandom(this.unigrams, 2.5, true));
                        }
                    }

                    // ADVANCED STRATEGY: Random restart (cut-up technique enhancement)
                    if (baseOrder <= 2 && Math.random() < 0.12 && this.startStates.length > 0) {
                        // Jump to a completely different state
                        stateArray = [...this.startStates[Math.floor(Math.random() * this.startStates.length)]];
                        continue;
                    }

                    // STRATEGY 3: Cut-up technique on punctuation
                    if (this.punctuation.includes(next)) {
                        // For Order 1-2: 60% chance to splice in random fragment instead of ending
                        if (baseOrder <= 2 && Math.random() < 0.6 && this.startStates.length > 0) {
                            const randomStart = this.startStates[Math.floor(Math.random() * this.startStates.length)];
                            const fragmentLength = Math.floor(Math.random() * Math.min(3, randomStart.length));
                            result.push(...randomStart.slice(0, fragmentLength));
                        }

                        // Check if should end sentence
                        if (baseOrder === 1 && result.length >= 5 && Math.random() > 0.4) {
                            break;
                        } else if (baseOrder === 2 && result.length >= 8 && Math.random() > 0.35) {
                            break;
                        } else if (baseOrder >= 3 && result.length >= minLength && Math.random() > 0.3) {
                            break;
                        }
                    }

                    // For Order 1, occasionally inject random punctuation
                    if (baseOrder === 1 && result.length >= 5 && Math.random() > 0.85) {
                        const randomPunct = this.punctuation[Math.floor(Math.random() * this.punctuation.length)];
                        result.push(randomPunct);
                        break;
                    }

                    // Update state: remove first word, add new word
                    stateArray.shift();
                    stateArray.push(next);
                }

                // Post-processing: capitalize first letter
                if (result.length > 0 && result[0]) {
                    result[0] = result[0].charAt(0).toUpperCase() + result[0].slice(1);
                }

                // Ensure proper ending punctuation
                const lastToken = result[result.length - 1];
                if (!this.punctuation.includes(lastToken)) {
                    if (baseOrder === 1) {
                        // Order 1: varied punctuation
                        const endings = ['.', '!', '?', '!', '?', '!'];
                        result.push(endings[Math.floor(Math.random() * endings.length)]);
                    } else {
                        result.push('.');
                    }
                }

                // Join and fix spacing around punctuation
                return result.join(' ').replace(/\s+([.,!?;:])/g, '$1');
            }
        }

        const markov = new MarkovChain(4); // Train all orders up to 4
        const markovInput = document.getElementById('markovInput');
        const markovOutput = document.getElementById('markovOutput');
        const generateMarkovBtn = document.getElementById('generateMarkovBtn');
        const autoMarkovBtn = document.getElementById('autoMarkovBtn');
        const markovStatus = document.getElementById('markovStatus');
        const orderDescription = document.getElementById('orderDescription');
        let autoMarkovActive = false;
        let autoMarkovInterval;

        // Order descriptions
        const orderDescriptions = {
            1: '<strong>Order 1 (Chaotic):</strong> Uses 1-word context with automatic fallback to random selection. Creates highly unpredictable, surreal text with unexpected word combinations. Perfect for experimental and Dadaist poetry.',
            2: '<strong>Order 2 (Fragmented):</strong> Uses 2-word context with fallback to unigrams. Creates fragmented but somewhat coherent text with frequent logic jumps. Good for stream-of-consciousness writing.',
            3: '<strong>Order 3 (Balanced):</strong> Uses 3-word context with hierarchical backoff. Maintains grammatical structure while introducing creative variations. Best balance between originality and coherence. <em>Recommended for most uses.</em>',
            4: '<strong>Order 4 (Coherent):</strong> Uses 4-word context with full backoff chain. Produces highly coherent text that closely mirrors the original style and structure. Best for literary texts and longer inputs.'
        };

        // Handle order button clicks
        document.querySelectorAll('.markov-order-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const newOrder = parseInt(btn.dataset.order);

                // Update active button
                document.querySelectorAll('.markov-order-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                // Update markov current order (no need to retrain - all orders already trained)
                markov.currentOrder = newOrder;

                // Update description
                if (orderDescription) {
                    orderDescription.innerHTML = orderDescriptions[newOrder];
                }

                markovStatus.textContent = `Order ${newOrder} selected - ready to generate!`;
                setTimeout(() => {
                    markovStatus.textContent = 'Ready';
                }, 1500);
            });
        });

        if (generateMarkovBtn) {
            generateMarkovBtn.addEventListener('click', () => {
                const text = markovInput.value;
                if (text.trim().length < 30) {
                    markovOutput.innerHTML = '<em style="color: #ff6b6b;">Please enter at least a few complete sentences to generate significant variations.</em>';
                    return;
                }
                
                markovStatus.innerHTML = '<span class="loading"></span> Generating...';
                
                setTimeout(() => {
                    markov.train(text);
                    const generated = markov.generate(Math.floor(Math.random() * 20) + 20);
                    markovOutput.innerHTML = generated;
                    markovStatus.textContent = 'Generated!';
                    
                    setTimeout(() => {
                        markovStatus.textContent = 'Ready';
                    }, 1500);
                }, 400);
            });
        }

        if (autoMarkovBtn) {
            autoMarkovBtn.addEventListener('click', () => {
                autoMarkovActive = !autoMarkovActive;
                
                if (autoMarkovActive) {
                    autoMarkovBtn.textContent = '⏸ Pause Auto';
                    markovStatus.innerHTML = '<span class="loading"></span> Auto-generation active';
                    markovStatus.classList.add('active');
                    
                    markov.train(markovInput.value);
                    
                    autoMarkovInterval = setInterval(() => {
                        const generated = markov.generate(Math.floor(Math.random() * 25) + 15);
                        markovOutput.innerHTML = generated;
                    }, 3500);
                } else {
                    autoMarkovBtn.textContent = '🔄 Auto Generate';
                    markovStatus.textContent = 'Ready';
                    markovStatus.classList.remove('active');
                    clearInterval(autoMarkovInterval);
                }
            });
        }

        // ===== MOTION DETECTION WITH RECORDING AND SENSITIVITY PRESETS =====
        let motionStream;
        let motionCanvas, motionCtx;
        let motionVideo;
        let previousFrame = null;
        let motionAnimationFrame;
        let motionDetectionActive = false;
        let currentMotionLevel = 0;
        let stillFrameCount = 0;
        let repetitionInterval;
        let motionHistory = [];
        const MOTION_HISTORY_SIZE = 10;
        
        let mediaRecorder;
        let recordedChunks = [];
        let isRecording = false;
        let canvasStream;
        let audioDestination;
        let recordingAudioContext;
        
        const motionWords = [
            'Very beautiful', 'You speak English?', 'Very very beautiful',
            'I remember everything', "You don't remember?", "I don't remember",
            'Oh, you speak Italian?', 'I like Rome', 'Beautiful Rome',
            'Remember?', 'Very', 'You speak?', 'Everything', 'Beautiful',
            'I remember', 'Do you remember?', 'Beautiful beautiful'
        ];

        // ===== TEXT GENERATION CONTROL =====
        let lastTextUpdate = 0;
        let currentDisplayedText = '';
        let TEXT_UPDATE_INTERVALS = {
            slow: 3000,      // 3 secondi per movimento lento
            fast: 1500,      // 1.5s per movimento veloce
            abrupt: 700      // 700ms per movimento brusco
        };
        let glitchIntensity = 0.08; // 8% default
        let minTextSize = 0.8; // rem - dimensione minima
        let maxTextSize = 6.0; // rem - dimensione massima

        // ===== SLIDERS SETUP =====
        const slowSpeedSlider = document.getElementById('slowSpeedSlider');
        const fastSpeedSlider = document.getElementById('fastSpeedSlider');
        const glitchIntensitySlider = document.getElementById('glitchIntensitySlider');
        const minTextSizeSlider = document.getElementById('minTextSizeSlider');
        const maxTextSizeSlider = document.getElementById('maxTextSizeSlider');

        function updateTextSizeDisplay() {
            const display = document.getElementById('textSizeRangeValue');
            if (display) {
                display.textContent = `${minTextSize.toFixed(1)}rem → ${maxTextSize.toFixed(1)}rem`;
            }
        }

        if (slowSpeedSlider) {
            slowSpeedSlider.addEventListener('input', (e) => {
                TEXT_UPDATE_INTERVALS.slow = parseInt(e.target.value);
                document.getElementById('slowSpeedValue').textContent = (TEXT_UPDATE_INTERVALS.slow / 1000).toFixed(1) + 's';
            });
        }

        if (fastSpeedSlider) {
            fastSpeedSlider.addEventListener('input', (e) => {
                TEXT_UPDATE_INTERVALS.fast = parseInt(e.target.value);
                document.getElementById('fastSpeedValue').textContent = (TEXT_UPDATE_INTERVALS.fast / 1000).toFixed(1) + 's';
            });
        }

        if (glitchIntensitySlider) {
            glitchIntensitySlider.addEventListener('input', (e) => {
                glitchIntensity = parseInt(e.target.value) / 100;
                document.getElementById('glitchIntensityValue').textContent = e.target.value + '%';
            });
        }

        if (minTextSizeSlider) {
            minTextSizeSlider.addEventListener('input', (e) => {
                minTextSize = parseFloat(e.target.value);
                // Assicura che min non superi max
                if (minTextSize > maxTextSize) {
                    minTextSize = maxTextSize;
                    minTextSizeSlider.value = minTextSize;
                }
                updateTextSizeDisplay();
            });
        }

        if (maxTextSizeSlider) {
            maxTextSizeSlider.addEventListener('input', (e) => {
                maxTextSize = parseFloat(e.target.value);
                // Assicura che max non sia minore di min
                if (maxTextSize < minTextSize) {
                    maxTextSize = minTextSize;
                    maxTextSizeSlider.value = maxTextSize;
                }
                updateTextSizeDisplay();
            });
        }

        // ==== FIX: Funzione per determinare il formato video supportato ====
        function getSupportedMimeType() {
            const possibleTypes = [
                'video/webm;codecs=vp9,opus',
                'video/webm;codecs=vp8,opus',
                'video/webm;codecs=h264,opus',
                'video/webm;codecs=vp9',
                'video/webm;codecs=vp8',
                'video/webm',
                'video/mp4;codecs=h264,aac',
                'video/mp4;codecs=h264',
                'video/mp4',
                'video/x-matroska;codecs=avc1',
                'video/x-matroska'
            ];
            
            for (const type of possibleTypes) {
                if (MediaRecorder.isTypeSupported(type)) {
                    console.log('✅ Supported format found:', type);
                    return type;
                }
            }
            
            return null;
        }

        // ==== Funzione per mostrare messaggi all'utente ====
        function showRecordingAlert(message, type = 'info') {
            const alertBox = document.getElementById('recordingAlert');
            const alertMessage = document.getElementById('alertMessage');
            
            alertBox.className = 'alert-box';
            if (type === 'warning') {
                alertBox.classList.add('warning');
            } else if (type === 'error') {
                alertBox.classList.add('error');
            }
            
            alertMessage.textContent = message;
            alertBox.style.display = 'block';
        }

        function hideRecordingAlert() {
            const alertBox = document.getElementById('recordingAlert');
            alertBox.style.display = 'none';
        }

        const startMotionBtn = document.getElementById('startMotionBtn');
        if (startMotionBtn) {
            startMotionBtn.addEventListener('click', async () => {
                try {
                    motionStream = await navigator.mediaDevices.getUserMedia({ 
                        video: { width: 640, height: 480 } 
                    });
                    
                    motionVideo = document.getElementById('motionVideo');
                    motionCanvas = document.getElementById('motionCanvas');
                    motionCtx = motionCanvas.getContext('2d');
                    
                    motionVideo.srcObject = motionStream;
                    motionCanvas.width = 640;
                    motionCanvas.height = 480;
                    
                    motionDetectionActive = true;
                    motionHistory = [];
                    stillFrameCount = 0;
                    
                    document.getElementById('motionStatus').innerHTML = '<span class="loading"></span> Camera active';
                    document.getElementById('motionStatus').classList.add('active');
                    document.getElementById('motionInfo').style.display = 'block';
                    document.getElementById('startMotionBtn').disabled = true;
                    document.getElementById('stopMotionBtn').disabled = false;
                    document.getElementById('recordBtn').disabled = false;
                    document.getElementById('recordStatus').style.display = 'inline-flex';
                    document.getElementById('recordStatus').textContent = 'Ready to record';
                    
                    // Abilita i preset
                    presetDarkBtn.disabled = false;
                    presetNormalBtn.disabled = false;
                    presetBrightBtn.disabled = false;
                    
                    const motionAudio = document.getElementById('motionAudio');
                    motionAudio.volume = 0.7;
                    motionAudio.play().catch(err => {
                        console.log('Audio autoplay prevented:', err);
                    });
                    
                    const supportedType = getSupportedMimeType();
                    if (!supportedType) {
                        showRecordingAlert('Recording not supported on this browser. Try Chrome desktop.', 'warning');
                    } else {
                        const browserInfo = navigator.userAgent.includes('Chrome') ? 'Chrome' : 
                                          navigator.userAgent.includes('Firefox') ? 'Firefox' : 
                                          navigator.userAgent.includes('Safari') ? 'Safari' : 'this browser';
                        showRecordingAlert(`Recording ready! Format: ${supportedType.split(';')[0]} (${browserInfo})`, 'info');
                    }
                    
                    motionVideo.addEventListener('loadeddata', () => {
                        detectMotionReveal();
                    });
                    
                } catch (err) {
                    document.getElementById('motionStatus').textContent = 'Error: permission denied';
                    document.getElementById('motionStatus').style.color = '#ff6b6b';
                    showRecordingAlert('Camera access denied. Please allow camera permissions.', 'error');
                    console.error('Camera error:', err);
                }
            });
        }

        const recordBtn = document.getElementById('recordBtn');
        if (recordBtn) {
            recordBtn.addEventListener('click', async () => {
                if (!isRecording) {
                    await startRecording();
                } else {
                    stopRecording();
                }
            });
        }

        async function startRecording() {
            try {
                hideRecordingAlert();
                
                const selectedMimeType = getSupportedMimeType();
                
                if (!selectedMimeType) {
                    showRecordingAlert('Your browser does not support video recording. Please use Chrome, Firefox, or Edge on desktop.', 'error');
                    throw new Error('No supported video format found');
                }
                
                recordedChunks = [];
                canvasStream = motionCanvas.captureStream(30);
                
                const motionAudioElement = document.getElementById('motionAudio');
                
                let audioTracks = [];
                try {
                    recordingAudioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const audioSource = recordingAudioContext.createMediaElementSource(motionAudioElement);
                    audioDestination = recordingAudioContext.createMediaStreamDestination();
                    audioSource.connect(audioDestination);
                    audioSource.connect(recordingAudioContext.destination);
                    audioTracks = audioDestination.stream.getAudioTracks();
                } catch (audioError) {
                    console.warn('Could not capture audio:', audioError);
                    showRecordingAlert('Recording video only (audio capture not available)', 'warning');
                }
                
                const tracks = [
                    ...canvasStream.getVideoTracks(),
                    ...audioTracks
                ];
                
                const combinedStream = new MediaStream(tracks);
                
                const videoBitrate = selectedMimeType.includes('vp9') ? 2500000 : 
                                    selectedMimeType.includes('vp8') ? 2000000 : 
                                    selectedMimeType.includes('h264') ? 3000000 : 2000000;
                
                const options = {
                    mimeType: selectedMimeType,
                    videoBitsPerSecond: videoBitrate
                };
                
                if (audioTracks.length > 0) {
                    options.audioBitsPerSecond = 128000;
                }
                
                mediaRecorder = new MediaRecorder(combinedStream, options);
                
                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        recordedChunks.push(event.data);
                    }
                };
                
                mediaRecorder.onstop = () => {
                    const blob = new Blob(recordedChunks, { type: selectedMimeType });
                    const url = URL.createObjectURL(blob);
                    
                    const fileExtension = selectedMimeType.includes('mp4') ? 'mp4' : 'webm';
                    
                    const downloadBtn = document.getElementById('downloadBtn');
                    downloadBtn.style.display = 'inline-block';
                    downloadBtn.onclick = () => {
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `very-beautiful-performance-${Date.now()}.${fileExtension}`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                    };
                    
                    document.getElementById('recordStatus').textContent = `Recording saved! (${fileExtension.toUpperCase()}) Click download`;
                    document.getElementById('recordStatus').classList.remove('recording');
                    showRecordingAlert(`Recording complete! File size: ${(blob.size / 1024 / 1024).toFixed(2)} MB`, 'info');
                };
                
                mediaRecorder.onerror = (event) => {
                    console.error('MediaRecorder error:', event.error);
                    showRecordingAlert(`Recording error: ${event.error.name}`, 'error');
                    isRecording = false;
                    document.getElementById('recordBtn').textContent = '⏺ Start Recording';
                    document.getElementById('recordBtn').classList.remove('recording');
                };
                
                mediaRecorder.start(100);
                isRecording = true;
                
                document.getElementById('recordBtn').textContent = '⏹ Stop Recording';
                document.getElementById('recordBtn').classList.add('recording');
                document.getElementById('recordStatus').textContent = '🔴 Recording...';
                document.getElementById('recordStatus').classList.add('recording');
                document.getElementById('downloadBtn').style.display = 'none';
                
                showRecordingAlert(`Recording started! Format: ${selectedMimeType.split(';')[0]}`, 'info');
                
            } catch (err) {
                console.error('Recording error:', err);
                showRecordingAlert(`Error: ${err.message}. Try Chrome desktop for best compatibility.`, 'error');
                isRecording = false;
            }
        }

        function stopRecording() {
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();
                isRecording = false;
                document.getElementById('recordBtn').textContent = '⏺ Start Recording';
                document.getElementById('recordBtn').classList.remove('recording');
            }
        }

        function detectMotionReveal() {
            if (!motionDetectionActive) return;
            
            if (motionVideo.readyState !== motionVideo.HAVE_ENOUGH_DATA) {
                motionAnimationFrame = requestAnimationFrame(detectMotionReveal);
                return;
            }
            
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = 640;
            tempCanvas.height = 480;
            const tempCtx = tempCanvas.getContext('2d');
            
            // APPLICAZIONE PRESET: Luminosità e Contrasto
            tempCtx.filter = `brightness(${currentPreset.brightnessBoost}) contrast(${currentPreset.contrastBoost})`;
            tempCtx.drawImage(motionVideo, 0, 0, 640, 480);
            tempCtx.filter = 'none';
            
            const currentFrame = tempCtx.getImageData(0, 0, 640, 480);
            
            motionCtx.fillStyle = '#000';
            motionCtx.fillRect(0, 0, 640, 480);
            
            if (previousFrame) {
                let motionAmount = 0;
                let motionPixels = 0;
                let visiblePixels = 0;
                
                // APPLICAZIONE PRESET: Soglia di movimento
                const MOTION_THRESHOLD = currentPreset.motionThreshold;
                
                const motionMask = new Uint8Array(640 * 480);
                
                for (let i = 0; i < currentFrame.data.length; i += 4) {
                    const diff = Math.abs(currentFrame.data[i] - previousFrame.data[i]) +
                                Math.abs(currentFrame.data[i+1] - previousFrame.data[i+1]) +
                                Math.abs(currentFrame.data[i+2] - previousFrame.data[i+2]);
                    
                    const pixelIndex = i / 4;
                    if (diff > MOTION_THRESHOLD) {
                        motionPixels++;
                        motionAmount += diff;
                        motionMask[pixelIndex] = 1;
                    } else {
                        motionMask[pixelIndex] = 0;
                    }
                }
                
                const motionPercentage = (motionPixels / (640 * 480)) * 100;
                
                motionHistory.push(motionPercentage);
                if (motionHistory.length > MOTION_HISTORY_SIZE) {
                    motionHistory.shift();
                }
                
                const avgMotion = motionHistory.reduce((a, b) => a + b, 0) / motionHistory.length;
                currentMotionLevel = avgMotion;
                
                // APPLICAZIONE PRESET: Soglia minima per attivazione
                if (avgMotion >= currentPreset.minMotionPercent) {
                    const revealedImage = tempCtx.createImageData(640, 480);
                    const dilatedMask = new Uint8Array(640 * 480);
                    
                    // APPLICAZIONE PRESET: Raggio di dilatazione
                    const dilationRadius = currentPreset.dilationRadius;
                    
                    for (let y = 0; y < 480; y++) {
                        for (let x = 0; x < 640; x++) {
                            const idx = y * 640 + x;
                            let hasMotionNearby = false;
                            
                            for (let dy = -dilationRadius; dy <= dilationRadius; dy++) {
                                for (let dx = -dilationRadius; dx <= dilationRadius; dx++) {
                                    const nx = x + dx;
                                    const ny = y + dy;
                                    if (nx >= 0 && nx < 640 && ny >= 0 && ny < 480) {
                                        const nidx = ny * 640 + nx;
                                        if (motionMask[nidx] === 1) {
                                            hasMotionNearby = true;
                                            break;
                                        }
                                    }
                                }
                                if (hasMotionNearby) break;
                            }
                            
                            if (hasMotionNearby) {
                                dilatedMask[idx] = 1;
                                visiblePixels++;
                            }
                        }
                    }
                    
                    for (let i = 0; i < currentFrame.data.length; i += 4) {
                        const pixelIndex = i / 4;
                        if (dilatedMask[pixelIndex] === 1) {
                            const x = (pixelIndex % 640);
                            const y = Math.floor(pixelIndex / 640);
                            
                            let minDist = dilationRadius + 1;
                            for (let dy = -dilationRadius; dy <= dilationRadius; dy++) {
                                for (let dx = -dilationRadius; dx <= dilationRadius; dx++) {
                                    const nx = x + dx;
                                    const ny = y + dy;
                                    if (nx >= 0 && nx < 640 && ny >= 0 && ny < 480) {
                                        const nidx = ny * 640 + nx;
                                        if (motionMask[nidx] === 1) {
                                            const dist = Math.sqrt(dx * dx + dy * dy);
                                            minDist = Math.min(minDist, dist);
                                        }
                                    }
                                }
                            }
                            
                            const glowIntensity = 1 - (minDist / dilationRadius);
                            const brightnessFactor = 1 + glowIntensity * 0.5;
                            
                            revealedImage.data[i] = Math.min(255, currentFrame.data[i] * brightnessFactor);
                            revealedImage.data[i+1] = Math.min(255, currentFrame.data[i+1] * brightnessFactor);
                            revealedImage.data[i+2] = Math.min(255, currentFrame.data[i+2] * brightnessFactor);
                            revealedImage.data[i+3] = 255;
                        } else {
                            revealedImage.data[i] = 0;
                            revealedImage.data[i+1] = 0;
                            revealedImage.data[i+2] = 0;
                            revealedImage.data[i+3] = 255;
                        }
                    }
                    
                    motionCtx.putImageData(revealedImage, 0, 0);
                    
                    motionCtx.globalCompositeOperation = 'screen';
                    motionCtx.globalAlpha = 0.3;
                    motionCtx.filter = 'blur(8px)';
                    motionCtx.putImageData(revealedImage, 0, 0);
                    motionCtx.globalCompositeOperation = 'source-over';
                    motionCtx.globalAlpha = 1;
                    motionCtx.filter = 'none';
                }
                
                const visiblePercentage = (visiblePixels / (640 * 480)) * 100;
                
                document.getElementById('motionIntensity').textContent = avgMotion.toFixed(1) + '%';
                document.getElementById('visibleArea').textContent = visiblePercentage.toFixed(1) + '%';

                const textOverlay = document.getElementById('motionTextOverlay');
                const now = Date.now();

                if (avgMotion < currentPreset.minMotionPercent) {
                    stillFrameCount++;
                    document.getElementById('movementType').textContent = 'Still';

                    if (stillFrameCount > 60) {
                        if (!repetitionInterval) {
                            let repeatCount = 0;
                            const baseWord = motionWords[Math.floor(Math.random() * 3)];

                            repetitionInterval = setInterval(() => {
                                const repetitions = Math.floor(repeatCount / 4) + 1;
                                const repeated = (baseWord + ' ').repeat(Math.min(repetitions, 3)).trim();
                                textOverlay.textContent = repeated;
                                textOverlay.style.fontSize = (1.2 + Math.sin(repeatCount * 0.2) * 0.2) + 'rem';
                                textOverlay.style.opacity = '1';
                                textOverlay.style.filter = 'none';
                                textOverlay.style.letterSpacing = '0px';
                                textOverlay.style.transform = 'translate(-50%, -50%)';
                                textOverlay.style.color = '#fff';
                                repeatCount++;

                                if (repeatCount > 16) {
                                    repeatCount = 0;
                                }
                            }, 1200); // Rallentato da 800ms a 1200ms
                        }
                    } else {
                        if (!repetitionInterval) {
                            textOverlay.textContent = 'Move to reveal...';
                            textOverlay.style.fontSize = '1.1rem';
                            textOverlay.style.opacity = '0.5';
                            textOverlay.style.filter = 'none';
                            textOverlay.style.letterSpacing = '2px';
                            textOverlay.style.transform = 'translate(-50%, -50%)';
                            textOverlay.style.color = '#888';
                        }
                    }

                } else if (avgMotion >= currentPreset.minMotionPercent && avgMotion < (currentPreset.minMotionPercent * 4)) {
                    stillFrameCount = 0;
                    clearInterval(repetitionInterval);
                    repetitionInterval = null;

                    document.getElementById('movementType').textContent = 'Slow';

                    // Aggiorna testo con intervallo configurabile
                    if (now - lastTextUpdate > TEXT_UPDATE_INTERVALS.slow) {
                        currentDisplayedText = motionWords[Math.floor(Math.random() * motionWords.length)];
                        lastTextUpdate = now;
                    }

                    // Usa la dimensione minima configurabile
                    textOverlay.textContent = currentDisplayedText;
                    textOverlay.style.fontSize = minTextSize + 'rem';
                    textOverlay.style.opacity = '1';
                    textOverlay.style.filter = 'drop-shadow(0 0 10px rgba(255,255,255,0.8))';
                    textOverlay.style.letterSpacing = '2px';
                    textOverlay.style.transform = 'translate(-50%, -50%)';
                    textOverlay.style.color = '#fff';

                } else if (avgMotion >= (currentPreset.minMotionPercent * 4) && avgMotion < (currentPreset.minMotionPercent * 10)) {
                    stillFrameCount = 0;
                    clearInterval(repetitionInterval);
                    repetitionInterval = null;

                    document.getElementById('movementType').textContent = 'Fast';

                    // Aggiorna testo con intervallo configurabile
                    if (now - lastTextUpdate > TEXT_UPDATE_INTERVALS.fast) {
                        currentDisplayedText = motionWords[Math.floor(Math.random() * motionWords.length)];
                        lastTextUpdate = now;
                    }

                    // Calcola dimensione del testo in base all'intensità del movimento
                    // Scala da minTextSize a maxTextSize
                    const normalizedMotion = Math.min(avgMotion / (currentPreset.minMotionPercent * 10), 1);
                    const calculatedSize = minTextSize + (normalizedMotion * (maxTextSize - minTextSize));

                    textOverlay.textContent = currentDisplayedText;
                    textOverlay.style.fontSize = calculatedSize + 'rem';
                    textOverlay.style.opacity = '0.95';
                    textOverlay.style.letterSpacing = '3px';
                    textOverlay.style.filter = 'drop-shadow(0 0 12px rgba(255,107,107,0.7))';
                    textOverlay.style.transform = 'translate(-50%, -50%)';
                    textOverlay.style.color = '#fff';

                } else {
                    stillFrameCount = 0;
                    clearInterval(repetitionInterval);
                    repetitionInterval = null;

                    document.getElementById('movementType').textContent = 'Abrupt';

                    // Aggiorna testo con intervallo configurabile
                    if (now - lastTextUpdate > TEXT_UPDATE_INTERVALS.abrupt) {
                        currentDisplayedText = motionWords[Math.floor(Math.random() * motionWords.length)];
                        lastTextUpdate = now;
                        applyGlitchEffect(textOverlay, currentDisplayedText, avgMotion);
                    }
                }
            }
            
            previousFrame = currentFrame;
            motionAnimationFrame = requestAnimationFrame(detectMotionReveal);
        }

        function applyGlitchEffect(element, text, motionIntensity = 0) {
            // Ridotti drasticamente i caratteri glitch - solo punteggiatura comune
            const glitchChars = '.,!?-';
            let glitchedText = '';

            // Usa il valore dello slider per l'intensità del glitch
            for (let char of text) {
                if (char !== ' ' && Math.random() < glitchIntensity) {
                    glitchedText += glitchChars[Math.floor(Math.random() * glitchChars.length)];
                } else {
                    glitchedText += char;
                }
            }

            // Calcola dimensione del testo in base all'intensità del movimento
            // Scala da minTextSize a maxTextSize in base al movimento
            const normalizedMotion = Math.min(motionIntensity / 100, 1);
            const calculatedSize = minTextSize + (normalizedMotion * (maxTextSize - minTextSize));

            element.textContent = glitchedText;
            element.style.fontSize = (calculatedSize + Math.random() * 0.3) + 'rem';
            element.style.color = `rgb(${150 + Math.random() * 105}, ${150 + Math.random() * 105}, ${255})`;
            element.style.transform = `translate(${-50 + (Math.random() - 0.5) * 5}%, ${-50 + (Math.random() - 0.5) * 5}%) rotate(${(Math.random() - 0.5) * 4}deg)`;
            element.style.filter = `hue-rotate(${Math.random() * 120}deg) blur(${Math.random() * 1}px) drop-shadow(0 0 15px rgba(72,219,251,0.7))`;
            element.style.opacity = 0.85 + Math.random() * 0.15;
            element.style.letterSpacing = (Math.random() * 4) + 'px';

            // Recupero più veloce del testo originale
            setTimeout(() => {
                element.textContent = text;
                element.style.fontSize = calculatedSize + 'rem'; // Mantieni la dimensione calcolata
                element.style.transform = 'translate(-50%, -50%)';
                element.style.filter = 'drop-shadow(0 0 10px rgba(255,255,255,0.8))';
                element.style.color = '#fff';
                element.style.letterSpacing = '2px';
            }, 100);
        }

        const stopMotionBtn = document.getElementById('stopMotionBtn');
        if (stopMotionBtn) {
            stopMotionBtn.addEventListener('click', () => {
                if (isRecording) {
                    stopRecording();
                }
                
                if (motionStream) {
                    motionStream.getTracks().forEach(track => track.stop());
                    cancelAnimationFrame(motionAnimationFrame);
                    clearInterval(repetitionInterval);
                    repetitionInterval = null;
                    motionDetectionActive = false;
                    stillFrameCount = 0;
                    previousFrame = null;
                    motionHistory = [];
                    
                    if (motionCtx) {
                        motionCtx.fillStyle = '#000';
                        motionCtx.fillRect(0, 0, 640, 480);
                    }
                    
                    const motionAudio = document.getElementById('motionAudio');
                    motionAudio.pause();
                    motionAudio.currentTime = 0;
                    
                    if (recordingAudioContext) {
                        recordingAudioContext.close();
                        recordingAudioContext = null;
                    }
                    
                    // Disabilita i preset
                    presetDarkBtn.disabled = true;
                    presetNormalBtn.disabled = true;
                    presetBrightBtn.disabled = true;
                    
                    document.getElementById('motionStatus').textContent = 'Camera inactive';
                    document.getElementById('motionStatus').classList.remove('active');
                    document.getElementById('motionInfo').style.display = 'none';
                    document.getElementById('startMotionBtn').disabled = false;
                    document.getElementById('stopMotionBtn').disabled = true;
                    document.getElementById('recordBtn').disabled = true;
                    document.getElementById('recordStatus').style.display = 'none';
                    document.getElementById('motionTextOverlay').textContent = '';
                    hideRecordingAlert();
                }
            });
        }


        // ===== IMAGE MODAL =====
        const modal = document.getElementById('imageModal');
        const modalImg = document.getElementById('modalImage');
        const modalClose = document.getElementById('modalClose');

        function openImageModal(imageSrc) {
            modal.classList.add('active');
            modalImg.src = imageSrc;
        }

        function closeImageModal() {
            modal.classList.remove('active');
        }

        document.querySelectorAll('.modal-trigger').forEach(trigger => {
            const modalHandler = debounce(function(e) {
                e.preventDefault();
                const imageSrc = this.dataset.src || this.src;
                openImageModal(imageSrc);
            });
            
            if (isTouchDevice) {
                trigger.addEventListener('touchend', modalHandler, { passive: false });
            } else {
                trigger.addEventListener('click', modalHandler);
            }
        });

        if (modalClose) {
            const closeHandler = debounce(closeImageModal);
            
            if (isTouchDevice) {
                modalClose.addEventListener('touchend', function(e) {
                    e.preventDefault();
                    closeHandler();
                }, { passive: false });
            } else {
                modalClose.addEventListener('click', closeHandler);
            }
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && modal.classList.contains('active')) {
                closeImageModal();
            }
        });

        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeImageModal();
            }
        });

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(reg => console.log('Service Worker registered!'))
                    .catch(err => console.log('Service Worker registration failed:', err));
            });
        }

        console.log('✅ Very Beautiful Interactive - Complete Version with Sensitivity Presets');
        console.log('✅ All features loaded successfully');
        console.log('📱 Device type:', isTouchDevice ? 'Touch' : 'Desktop');
        console.log('📐 Viewport:', window.innerWidth, 'x', window.innerHeight);
        console.log('🎬 Recording formats checked:', getSupportedMimeType() || 'None supported');
        console.log('🌙 Sensitivity presets available: Dark Room, Normal, Bright Light');
    </script>
</body>
</html>
